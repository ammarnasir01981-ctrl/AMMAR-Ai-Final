<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMMAR AI Academy - Ù†Ø¸Ø§Ù… ICP Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù…Ø¹ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†ØµÙˆØµ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@v3/dist/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root {
            --stellar: #8b5cf6;
            --linear: #0ea5e9;
            --circular: #10b981;
            --existential: #f59e0b;
            --quantum: #ec4899;
            --emotional: #3b82f6;
            --search: #8b5cf6;
            --pdf: #ef4444;
            --iq-test: #8b5cf6;
            --ocr: #10b981;
            --dark: #1f2937;
            --light: #f9fafb;
            --radius: 12px;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Cairo', Tahoma, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
            color: var(--dark);
            min-height: 100vh;
            padding-bottom: 100px;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            border-bottom: 4px solid var(--existential);
            backdrop-filter: blur(10px);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--stellar), var(--existential));
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.8rem;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        .logo-text h1 {
            font-size: 1.6rem;
            color: var(--stellar);
            margin-bottom: 5px;
        }

        .logo-text .subtitle {
            font-size: 0.9rem;
            color: var(--linear);
            font-weight: 600;
        }

        .intelligence-bar {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px auto;
            max-width: 1400px;
            padding: 0 20px;
            flex-wrap: wrap;
        }

        .intelligence-type {
            flex: 1;
            min-width: 180px;
            padding: 15px;
            border-radius: var(--radius);
            text-align: center;
            color: white;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            transition: transform 0.3s;
            cursor: pointer;
        }

        .intelligence-type:hover {
            transform: translateY(-5px);
        }

        .stellar-intel {
            background: linear-gradient(135deg, var(--stellar), #7c3aed);
        }

        .linear-intel {
            background: linear-gradient(135deg, var(--linear), #0284c7);
        }

        .circular-intel {
            background: linear-gradient(135deg, var(--circular), #059669);
        }

        .quantum-intel {
            background: linear-gradient(135deg, var(--quantum), #db2777);
        }

        .emotional-intel {
            background: linear-gradient(135deg, var(--emotional), #1d4ed8);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin: 20px auto;
            max-width: 1400px;
            padding: 0 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            flex: 1;
            min-width: 180px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: var(--radius);
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--dark);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            border: 2px solid transparent;
        }

        .tab-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .tab-btn.active {
            background: var(--existential);
            color: white;
            border-color: #d97706;
        }

        .tab-content {
            display: none;
            max-width: 1400px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .chat-container {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            height: 650px;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            background: linear-gradient(135deg, var(--stellar), var(--existential));
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .dialogue-mode-selector {
            display: flex;
            gap: 10px;
            padding: 15px;
            background: #f8fafc;
            border-bottom: 1px solid #e5e7eb;
            flex-wrap: wrap;
        }

        .mode-btn {
            flex: 1;
            min-width: 150px;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: var(--radius);
            background: white;
            color: var(--dark);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .mode-btn.active {
            background: var(--linear);
            color: white;
            border-color: var(--linear);
        }

        .mode-btn.existential {
            background: var(--existential);
            color: white;
            border-color: #d97706;
        }

        .mode-btn.quantum {
            background: var(--quantum);
            color: white;
            border-color: var(--quantum);
        }

        .mode-btn.emotional {
            background: var(--emotional);
            color: white;
            border-color: var(--emotional);
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: #f8fafc;
        }

        .message {
            max-width: 85%;
            padding: 20px;
            border-radius: 18px;
            position: relative;
            animation: messageAppear 0.3s ease;
            border: 2px solid transparent;
        }

        @keyframes messageAppear {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            background: linear-gradient(135deg, var(--linear), #0284c7);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
            border-color: var(--linear);
        }

        .ai-message {
            background: white;
            color: var(--dark);
            align-self: flex-start;
            border: 2px solid var(--circular);
            border-bottom-left-radius: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .message-content {
            line-height: 1.8;
        }

        .file-preview {
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
        }

        .file-icon {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .erd-badge {
            display: inline-block;
            padding: 3px 10px;
            background: var(--existential);
            color: white;
            border-radius: 20px;
            font-size: 0.7rem;
            margin-top: 10px;
            font-weight: 600;
        }

        .ocr-badge {
            display: inline-block;
            padding: 3px 10px;
            background: var(--ocr);
            color: white;
            border-radius: 20px;
            font-size: 0.7rem;
            margin-top: 10px;
            font-weight: 600;
            margin-left: 5px;
        }

        .settings-container {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
        }

        .api-key-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: var(--radius);
            font-size: 1rem;
            margin-bottom: 20px;
            font-family: monospace;
            direction: ltr;
        }

        .model-select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: var(--radius);
            font-size: 1rem;
            margin-bottom: 20px;
            background: white;
            cursor: pointer;
        }

        .settings-group {
            background: #f8fafc;
            padding: 20px;
            border-radius: var(--radius);
            margin-bottom: 25px;
        }

        .input-area {
            background: white;
            padding: 20px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        #message-input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: var(--radius);
            font-size: 1rem;
            resize: none;
            height: 60px;
            transition: all 0.3s;
        }

        .input-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            width: 50px;
            height: 50px;
            border-radius: var(--radius);
            border: none;
            background: var(--stellar);
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-btn:hover {
            background: #7c3aed;
            transform: scale(1.05);
        }

        .action-btn.ocr {
            background: var(--ocr);
        }

        .action-btn.file {
            background: var(--emotional);
        }

        .action-btn.search {
            background: var(--search);
        }

        .action-btn.pdf {
            background: var(--pdf);
        }

        .file-upload-area {
            padding: 15px;
            background: #f8fafc;
            border-bottom: 1px solid #e5e7eb;
            display: none;
        }

        .file-upload-area.active {
            display: block;
        }

        .upload-zone {
            border: 2px dashed var(--circular);
            border-radius: var(--radius);
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(16, 185, 129, 0.05);
        }

        .upload-zone:hover {
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--stellar);
        }

        .upload-zone i {
            font-size: 3rem;
            color: var(--circular);
            margin-bottom: 15px;
        }

        .uploaded-files {
            margin-top: 15px;
            max-height: 150px;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: white;
            border-radius: var(--radius);
            margin-bottom: 5px;
            border: 1px solid #e5e7eb;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-icon-small {
            color: var(--linear);
        }

        .file-remove {
            color: #ef4444;
            cursor: pointer;
            padding: 5px;
        }

        .tools-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.08);
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .tools-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .tool-btn {
            padding: 10px 20px;
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: var(--radius);
            font-weight: 600;
            color: var(--dark);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tool-btn:hover {
            background: white;
            border-color: var(--stellar);
            transform: translateY(-2px);
        }

        .tool-btn.primary {
            background: linear-gradient(135deg, var(--stellar), var(--existential));
            color: white;
            border: none;
        }

        .tool-btn.iq-btn {
            background: var(--iq-test);
            color: white;
            border: none;
        }

        .tool-btn.ocr-btn {
            background: var(--ocr);
            color: white;
            border: none;
        }

        .search-results {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            background: white;
            border-radius: var(--radius);
            border: 1px solid #e5e7eb;
            padding: 15px;
        }

        .search-result-item {
            padding: 10px;
            border-bottom: 1px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.3s;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: white;
            border-radius: var(--radius);
            margin: 10px 0;
            align-self: flex-start;
            border: 2px solid var(--circular);
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--existential);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }

        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: white;
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1000;
            animation: slideIn 0.5s ease;
            max-width: 350px;
            border-right: 5px solid var(--existential);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .pdf-preview {
            border: 1px solid #e5e7eb;
            border-radius: var(--radius);
            padding: 20px;
            min-height: 400px;
            background: #f9fafb;
            font-family: 'Arial', sans-serif;
            direction: ltr;
            text-align: left;
        }

        /* Ø£Ù†Ù…Ø§Ø· Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°ÙƒØ§Ø¡ */
        .iq-test-question {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 20px;
            border: 2px solid var(--iq-test);
        }

        .iq-option {
            padding: 15px;
            margin: 10px 0;
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .iq-option:hover {
            background: #e5e7eb;
            border-color: var(--iq-test);
        }

        .iq-option.selected {
            background: rgba(139, 92, 246, 0.1);
            border-color: var(--iq-test);
            color: var(--iq-test);
        }

        .iq-option-checkbox {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #d1d5db;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .iq-option.selected .iq-option-checkbox {
            background: var(--iq-test);
            border-color: var(--iq-test);
        }

        .iq-option.selected .iq-option-checkbox::after {
            content: 'âœ“';
            color: white;
            font-size: 12px;
        }

        .iq-result-card {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid var(--iq-test);
            box-shadow: var(--shadow);
        }

        .progress-container {
            height: 10px;
            background: #e5e7eb;
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            border-radius: 5px;
            transition: width 1s ease;
        }

        .intelligence-level-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }

        .level-excellent { background: #10b981; color: white; }
        .level-good { background: #0ea5e9; color: white; }
        .level-average { background: #f59e0b; color: white; }
        .level-basic { background: #ef4444; color: white; }

        .model-card {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 15px;
            border: 2px solid #e5e7eb;
            transition: all 0.3s;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .model-card.selected {
            border-color: var(--stellar);
            background: rgba(139, 92, 246, 0.05);
        }

        .model-card.recommended {
            border-color: var(--existential);
        }

        .model-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬ */
        .extracted-text-preview {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            margin-top: 15px;
            border: 2px solid var(--ocr);
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .extracted-text-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e5e7eb;
        }

        .ocr-progress {
            background: #f8fafc;
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            margin: 10px 0;
        }

        .ocr-progress-bar {
            width: 100%;
            height: 10px;
            background: #e5e7eb;
            border-radius: 5px;
            margin: 15px 0;
            overflow: hidden;
        }

        .ocr-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--ocr), #059669);
            border-radius: 5px;
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            header {
                padding: 15px 20px;
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .intelligence-bar {
                flex-direction: column;
            }

            .tabs {
                flex-direction: column;
            }

            .tab-btn {
                min-width: 100%;
            }

            .chat-container {
                height: 550px;
            }

            .tools-bar {
                flex-direction: column;
                gap: 10px;
                padding: 15px;
            }
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--stellar);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #7c3aed;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo-container">
            <div class="logo-icon">
                <i class="fas fa-brain-circuit"></i>
            </div>
            <div class="logo-text">
                <h1>AMMAR AI - Ù†Ø¸Ø§Ù… ICP Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h1>
                <div class="subtitle">Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„ÙˆØ¹ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†ØµÙˆØµ Ù…Ù† Ø§Ù„ØµÙˆØ± ÙˆPDF</div>
            </div>
        </div>
        <div style="font-size: 0.9rem; color: var(--linear); font-weight: 600; text-align: center;">
            <i class="fas fa-graduation-cap"></i> Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù…Ø¹ ØªÙ‚Ù†ÙŠØ© OCR<br>
            <span style="font-size: 0.8rem; color: var(--circular);">Ø§Ù„Ø¨Ø§Ø­Ø«: Ø¹Ù…Ø§Ø± Ù†Ø§ØµØ± Ø­Ø³ÙŠÙ† Ø§Ù„Ù…Ù†ØªÙØ¬ÙŠ - Ø¨Ø§Ø­Ø« Ù…Ø³ØªÙ‚Ù„</span>
        </div>
    </header>

    <div class="intelligence-bar">
        <div class="intelligence-type stellar-intel" onclick="setIntelligenceType('stellar')">
            <i class="fas fa-star"></i>
            <div>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ù†Ø¬Ù…ÙŠ<br><small>Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ø±Ø¤ÙŠÙˆÙŠ</small></div>
        </div>
        <div class="intelligence-type linear-intel" onclick="setIntelligenceType('linear')">
            <i class="fas fa-route"></i>
            <div>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®Ø·ÙŠ<br><small>Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†Ù‡Ø¬ÙŠ</small></div>
        </div>
        <div class="intelligence-type circular-intel" onclick="setIntelligenceType('circular')">
            <i class="fas fa-sync-alt"></i>
            <div>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ<br><small>Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</small></div>
        </div>
        <div class="intelligence-type quantum-intel" onclick="setIntelligenceType('quantum')">
            <i class="fas fa-atom"></i>
            <div>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„ÙƒÙ…ÙŠ<br><small>Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…ØªÙˆØ§Ø²ÙŠØ©</small></div>
        </div>
        <div class="intelligence-type emotional-intel" onclick="setIntelligenceType('emotional')">
            <i class="fas fa-heart"></i>
            <div>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¹Ø§Ø·ÙÙŠ<br><small>Ø§Ù„ÙÙ‡Ù… Ø§Ù„ØªØ¹Ø§Ø·ÙÙŠ</small></div>
        </div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" data-tab="icp-chat">
            <i class="fas fa-comments"></i>
            Ù…Ø­Ø§Ø¯Ø«Ø© ICP
        </button>
        <button class="tab-btn" data-tab="ocr-system">
            <i class="fas fa-file-alt"></i>
            Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†ØµÙˆØµ (OCR)
        </button>
        <button class="tab-btn" data-tab="iq-test">
            <i class="fas fa-brain"></i>
            Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°ÙƒØ§Ø¡
        </button>
        <button class="tab-btn" data-tab="pdf-export">
            <i class="fas fa-file-pdf"></i>
            ØªØµØ¯ÙŠØ± PDF
        </button>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨ Ù…Ø­Ø§Ø¯Ø«Ø© ICP -->
    <div id="icp-chat-tab" class="tab-content active">
        <div class="chat-container">
            <div class="chat-header">
                <i class="fas fa-brain-circuit"></i>
                Ù…Ø­Ø§Ø¯Ø«Ø© ICP Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© Ù…Ø¹ Ù†Ø¸Ø§Ù… Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
            </div>
            
            <div class="dialogue-mode-selector">
                <button class="mode-btn active" data-mode="linear">
                    <i class="fas fa-route"></i>
                    Ø§Ù„Ø­ÙˆØ§Ø± Ø§Ù„Ø®Ø·ÙŠ
                </button>
                <button class="mode-btn existential" data-mode="existential">
                    <i class="fas fa-star"></i>
                    Ø§Ù„Ø­ÙˆØ§Ø± Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ
                </button>
                <button class="mode-btn quantum" data-mode="quantum">
                    <i class="fas fa-atom"></i>
                    Ø§Ù„Ø­ÙˆØ§Ø± Ø§Ù„ÙƒÙ…ÙŠ
                </button>
                <button class="mode-btn emotional" data-mode="emotional">
                    <i class="fas fa-heart"></i>
                    Ø§Ù„Ø­ÙˆØ§Ø± Ø§Ù„Ø¹Ø§Ø·ÙÙŠ
                </button>
            </div>

            <div class="file-upload-area" id="file-upload-area">
                <div class="upload-zone" id="upload-zone">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <h3>Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ø§Ù„Ù…Ù„ÙØ§Øª Ù‡Ù†Ø§</h3>
                    <p>Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„ØªØµÙØ­ (ØµÙˆØ±ØŒ PDFØŒ Ù†ØµØŒ Ù…Ø³ØªÙ†Ø¯Ø§Øª)</p>
                    <input type="file" id="file-input" multiple accept="image/*,.pdf,.txt,.doc,.docx" style="display: none;">
                </div>
                <div class="uploaded-files" id="uploaded-files"></div>
                <div id="extracted-text-preview" class="extracted-text-preview" style="display: none;">
                    <div class="extracted-text-header">
                        <h4 style="color: var(--ocr); margin: 0;"><i class="fas fa-text-height"></i> Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬</h4>
                        <button onclick="copyExtractedText()" class="tool-btn" style="padding: 5px 10px; font-size: 0.8rem;">
                            <i class="fas fa-copy"></i> Ù†Ø³Ø®
                        </button>
                    </div>
                    <div id="extracted-text-content"></div>
                </div>
            </div>

            <div class="chat-messages" id="chat-messages">
                <div class="message ai-message">
                    <div class="message-header">
                        <i class="fas fa-brain-circuit"></i>
                        <span>Ù†Ø¸Ø§Ù… ICP Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù…Ø¹ OCR</span>
                        <span style="margin-right: auto; font-size: 0.8rem; color: var(--existential); font-weight: 600;">
                            <i class="fas fa-bolt"></i> Ø£Ø¯Ø§Ø¡ Ù…Ø­Ø³Ù†
                        </span>
                    </div>
                    <div class="message-content">
                        Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… ICP Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù…Ø¹ Ù…ÙŠØ²Ø§Øª Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†ØµÙˆØµ:
                        <br><br>
                        <span style="color: var(--stellar);"><i class="fas fa-file-upload"></i> Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª:</span> ÙŠÙ…ÙƒÙ†Ùƒ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±ØŒ PDFØŒ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù†ØµÙŠØ© Ù„Ù„ØªØ­Ù„ÙŠÙ„
                        <br>
                        <span style="color: var(--ocr);"><i class="fas fa-file-alt"></i> Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†ØµÙˆØµ (OCR):</span> Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†ØµÙˆØµ Ù…Ù† Ø§Ù„ØµÙˆØ± ÙˆÙ…Ù„ÙØ§Øª PDF ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
                        <br>
                        <span style="color: var(--circular);"><i class="fas fa-file-pdf"></i> ØªØµØ¯ÙŠØ± PDF:</span> ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø¨ØªÙ†Ø³ÙŠÙ‚ PDF
                        <br>
                        <span style="color: var(--iq-test);"><i class="fas fa-brain"></i> Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°ÙƒØ§Ø¡:</span> Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯ Ù„ØªÙ‚ÙŠÙŠÙ… Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡
                        <br><br>
                        <strong>Ù…ÙŠØ²Ø© Ø¬Ø¯ÙŠØ¯Ø©:</strong> ÙŠÙ…ÙƒÙ† Ù„Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¢Ù† Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†ØµÙˆØµ Ù…Ù† Ø§Ù„ØµÙˆØ± ÙˆÙ…Ù„ÙØ§Øª PDF ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§!
                    </div>
                    <div class="erd-badge">
                        <i class="fas fa-chart-line"></i> ERD: 4.8 | âš¡ Ù…ÙŠØ²Ø§Øª Ù…Ø­Ø³Ù†Ø©
                    </div>
                </div>
            </div>

            <div class="typing-indicator" id="typing-indicator">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <span>Ø¬Ø§Ø±Ù Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø¯...</span>
            </div>

            <div class="input-area">
                <textarea id="message-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§... (Ø§Ø¶ØºØ· Ctrl+Enter Ù„Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹)"></textarea>
                <div class="input-actions">
                    <button class="action-btn file" id="file-upload-btn" title="Ø±ÙØ¹ Ù…Ù„Ù">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <button class="action-btn ocr" id="ocr-btn" title="Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†ØµÙˆØµ Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª">
                        <i class="fas fa-file-alt"></i>
                    </button>
                    <button class="action-btn" id="send-btn" title="Ø¥Ø±Ø³Ø§Ù„ (Ctrl+Enter)">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨ Ù†Ø¸Ø§Ù… OCR -->
    <div id="ocr-system-tab" class="tab-content">
        <div class="settings-container">
            <h2 style="margin-bottom: 25px; color: var(--ocr); text-align: center; display: flex; align-items: center; justify-content: center; gap: 10px;">
                <i class="fas fa-file-alt"></i> Ù†Ø¸Ø§Ù… Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… (OCR)
            </h2>

            <div class="settings-group">
                <h3><i class="fas fa-cogs"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù†Ø¸Ø§Ù… OCR</h3>
                <p style="color: var(--dark); margin-bottom: 15px; line-height: 1.6;">
                    Ù†Ø¸Ø§Ù… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†ØµÙˆØµ Ù…Ù† Ø§Ù„ØµÙˆØ± ÙˆÙ…Ù„ÙØ§Øª PDF Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªÙ‚Ù†ÙŠØ© Tesseract.js ÙˆPDF.js.
                </p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                            Ù„ØºØ© OCR Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                        </label>
                        <select id="ocr-language" style="width: 100%; padding: 10px; border-radius: var(--radius); border: 2px solid #e5e7eb;">
                            <option value="ara">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                            <option value="eng">Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</option>
                            <option value="ara+eng">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© + Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</option>
                            <option value="fas">Ø§Ù„ÙØ§Ø±Ø³ÙŠØ©</option>
                            <option value="fra">Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                            Ø¯Ù‚Ø© OCR
                            <span id="ocr-accuracy-value">Ù…ØªÙˆØ³Ø·Ø©</span>
                        </label>
                        <select id="ocr-accuracy" style="width: 100%; padding: 10px; border-radius: var(--radius); border: 2px solid #e5e7eb;">
                            <option value="low">Ù…Ù†Ø®ÙØ¶Ø© (Ø£Ø³Ø±Ø¹)</option>
                            <option value="medium" selected>Ù…ØªÙˆØ³Ø·Ø©</option>
                            <option value="high">Ø¹Ø§Ù„ÙŠØ© (Ø£Ø¨Ø·Ø£)</option>
                        </select>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                        <input type="checkbox" id="auto-ocr" checked> ØªÙ…ÙƒÙŠÙ† OCR Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
                    </label>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                        <input type="checkbox" id="save-extracted-text" checked> Ø­ÙØ¸ Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø© Ù…Ø¹ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
                    </label>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                        <input type="checkbox" id="show-ocr-progress" checked> Ø¹Ø±Ø¶ ØªÙ‚Ø¯Ù… Ø¹Ù…Ù„ÙŠØ© OCR
                    </label>
                </div>
            </div>

            <div class="settings-group">
                <h3><i class="fas fa-flask"></i> Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… OCR</h3>
                <div style="background: #f0f9ff; padding: 20px; border-radius: var(--radius);">
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                            Ø§Ø®ØªØ± Ù…Ù„ÙÙ‹Ø§ Ù„Ø§Ø®ØªØ¨Ø§Ø± OCR
                        </label>
                        <div style="display: flex; gap: 10px;">
                            <input type="file" id="ocr-test-file" accept="image/*,.pdf" style="flex: 1; padding: 10px; border-radius: var(--radius); border: 2px solid #e5e7eb;">
                            <button onclick="testOCR()" class="tool-btn ocr-btn">
                                <i class="fas fa-search"></i> Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ
                            </button>
                        </div>
                    </div>
                    
                    <div class="ocr-progress" id="ocr-progress" style="display: none;">
                        <i class="fas fa-spinner fa-spin" style="color: var(--ocr); font-size: 1.5rem; margin-bottom: 10px;"></i>
                        <div>Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ...</div>
                        <div class="ocr-progress-bar">
                            <div class="ocr-progress-fill" id="ocr-progress-fill" style="width: 0%"></div>
                        </div>
                        <div id="ocr-progress-text">0%</div>
                    </div>
                    
                    <div class="extracted-text-preview" id="ocr-test-results" style="display: none;">
                        <div class="extracted-text-header">
                            <h4 style="color: var(--ocr); margin: 0;"><i class="fas fa-text-height"></i> Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬ Ù…Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h4>
                            <div>
                                <button onclick="copyTestOCRText()" class="tool-btn" style="padding: 5px 10px; font-size: 0.8rem;">
                                    <i class="fas fa-copy"></i> Ù†Ø³Ø®
                                </button>
                                <button onclick="useTestOCRText()" class="tool-btn" style="padding: 5px 10px; font-size: 0.8rem; margin-right: 5px;">
                                    <i class="fas fa-comment"></i> Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
                                </button>
                            </div>
                        </div>
                        <div id="ocr-test-text-content"></div>
                    </div>
                </div>
                
                <button onclick="runOCRBenchmark()" class="tool-btn" style="width: 100%; justify-content: center; margin-top: 15px;">
                    <i class="fas fa-running"></i> ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø± Ø£Ø¯Ø§Ø¡ OCR
                </button>
            </div>

            <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(139, 92, 246, 0.1)); padding: 25px; border-radius: var(--radius); margin-top: 30px;">
                <h4 style="color: var(--ocr); margin-bottom: 10px;"><i class="fas fa-info-circle"></i> Ø­ÙˆÙ„ Ù†Ø¸Ø§Ù… OCR</h4>
                <p style="color: var(--dark); font-size: 0.9rem; line-height: 1.6;">
                    â€¢ ğŸ“· <strong>Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØµÙˆØ±:</strong> Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†ØµÙˆØµ Ù…Ù† Ø§Ù„ØµÙˆØ± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Tesseract.js<br>
                    â€¢ ğŸ“„ <strong>Ù‚Ø±Ø§Ø¡Ø© PDF:</strong> Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†ØµÙˆØµ Ù…Ù† Ù…Ù„ÙØ§Øª PDF Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… PDF.js<br>
                    â€¢ ğŸŒ <strong>Ù„ØºØ§Øª Ù…ØªØ¹Ø¯Ø¯Ø©:</strong> Ø¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆÙ„ØºØ§Øª Ø£Ø®Ø±Ù‰<br>
                    â€¢ âš¡ <strong>Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ø­Ù„ÙŠØ©:</strong> Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ø¬Ø© Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª<br>
                    â€¢ ğŸ”’ <strong>Ø®ØµÙˆØµÙŠØ© ØªØ§Ù…Ø©:</strong> Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØªÙ… Ù…Ø¹Ø§Ù„Ø¬ØªÙ‡Ø§ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ<br>
                    â€¢ ğŸ¯ <strong>Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ©:</strong> Ù†ØªØ§Ø¦Ø¬ Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ø¹ ØªÙ‚Ù†ÙŠØ§Øª Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
                </p>
            </div>
        </div>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°ÙƒØ§Ø¡ -->
    <div id="iq-test-tab" class="tab-content">
        <div class="settings-container">
            <h2 style="margin-bottom: 25px; color: var(--iq-test); text-align: center; display: flex; align-items: center; justify-content: center; gap: 10px;">
                <i class="fas fa-brain"></i> Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø´Ø§Ù…Ù„ Ø­Ø³Ø¨ Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ ICP
            </h2>

            <div class="settings-group">
                <h3><i class="fas fa-info-circle"></i> Ø¹Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3>
                <p style="color: var(--dark); margin-bottom: 15px; line-height: 1.6;">
                    Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙŠÙ‚ÙŠØ³ Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ù…Ø®ØªÙ„ÙØ© Ø­Ø³Ø¨ Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ ICP Ø§Ù„Ø¨Ø­Ø«ÙŠ. 
                    Ø³ØªØ­ØµÙ„ Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ… Ø´Ø§Ù…Ù„ ÙÙŠ 5 Ù…Ø¬Ø§Ù„Ø§Øª Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ø°ÙƒØ§Ø¡ Ù…Ø¹ ØªØ­Ù„ÙŠÙ„ Ù…ÙØµÙ„ Ù„ÙƒÙ„ Ù…Ø³ØªÙˆÙ‰.
                </p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                    <div style="text-align: center; padding: 15px; background: rgba(139, 92, 246, 0.1); border-radius: var(--radius);">
                        <i class="fas fa-route" style="color: var(--linear); font-size: 2rem; margin-bottom: 10px;"></i>
                        <div style="font-weight: bold; color: var(--linear);">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®Ø·ÙŠ</div>
                        <div style="font-size: 0.8rem; color: var(--dark);">Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠ Ø§Ù„Ù…Ù†Ù‡Ø¬ÙŠ</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(16, 185, 129, 0.1); border-radius: var(--radius);">
                        <i class="fas fa-sync-alt" style="color: var(--circular); font-size: 2rem; margin-bottom: 10px;"></i>
                        <div style="font-weight: bold; color: var(--circular);">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ</div>
                        <div style="font-size: 0.8rem; color: var(--dark);">Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ ÙˆØ§Ù„Ø±Ø¨Ø·</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(245, 158, 11, 0.1); border-radius: var(--radius);">
                        <i class="fas fa-star" style="color: var(--existential); font-size: 2rem; margin-bottom: 10px;"></i>
                        <div style="font-weight: bold; color: var(--existential);">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ</div>
                        <div style="font-size: 0.8rem; color: var(--dark);">Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„ÙÙ„Ø³ÙÙŠ Ø§Ù„Ø¹Ù…ÙŠÙ‚</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(236, 72, 153, 0.1); border-radius: var(--radius);">
                        <i class="fas fa-atom" style="color: var(--quantum); font-size: 2rem; margin-bottom: 10px;"></i>
                        <div style="font-weight: bold; color: var(--quantum);">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„ÙƒÙ…ÙŠ</div>
                        <div style="font-size: 0.8rem; color: var(--dark);">Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù…ØªÙˆØ§Ø²ÙŠ ÙˆØ§Ù„Ù…ØªØ¹Ø¯Ø¯</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(59, 130, 246, 0.1); border-radius: var(--radius);">
                        <i class="fas fa-heart" style="color: var(--emotional); font-size: 2rem; margin-bottom: 10px;"></i>
                        <div style="font-weight: bold; color: var(--emotional);">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¹Ø§Ø·ÙÙŠ</div>
                        <div style="font-size: 0.8rem; color: var(--dark);">Ø§Ù„ÙÙ‡Ù… Ø§Ù„ØªØ¹Ø§Ø·ÙÙŠ ÙˆØ§Ù„Ø¹Ø§Ø·ÙÙŠ</div>
                    </div>
                </div>
            </div>

            <div class="settings-group">
                <h3><i class="fas fa-play-circle"></i> Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3>
                <div id="iq-test-start" style="text-align: center; padding: 40px;">
                    <div style="font-size: 1.2rem; color: var(--dark); margin-bottom: 30px;">
                        ÙŠØªÙƒÙˆÙ† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† 10 Ø£Ø³Ø¦Ù„Ø© ØªØºØ·ÙŠ Ø¬Ù…ÙŠØ¹ Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡.<br>
                        Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠ: 10-15 Ø¯Ù‚ÙŠÙ‚Ø©
                    </div>
                    <button onclick="startIQTest()" class="tool-btn iq-btn" style="padding: 15px 40px; font-size: 1.3rem;">
                        <i class="fas fa-play"></i> Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°ÙƒØ§Ø¡
                    </button>
                    <p style="color: var(--dark); margin-top: 20px; font-size: 0.9rem;">
                        <i class="fas fa-history"></i> Ø¢Ø®Ø± Ø§Ø®ØªØ¨Ø§Ø±: <span id="last-test-date">Ù„Ù… ØªØ¬Ø±Ù Ø£ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø¹Ø¯</span>
                    </p>
                </div>

                <div id="iq-test-container" style="display: none;">
                    <div class="iq-test-question">
                        <h3 id="question-title" style="margin-bottom: 20px; color: var(--iq-test);">Ø§Ù„Ø³Ø¤Ø§Ù„ 1 Ù…Ù† 10</h3>
                        <div id="question-text" style="font-size: 1.1rem; color: var(--dark); margin-bottom: 30px;">
                            Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„...
                        </div>
                        
                        <div id="options-container">
                            <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ù‡Ù†Ø§ -->
                        </div>
                    </div>

                    <div style="display: flex; justify-content: space-between; margin-top: 30px;">
                        <button onclick="previousQuestion()" class="tool-btn" id="prev-btn" disabled>
                            <i class="fas fa-arrow-right"></i> Ø§Ù„Ø³Ø§Ø¨Ù‚
                        </button>
                        <button onclick="nextQuestion()" class="tool-btn primary" id="next-btn">
                            Ø§Ù„ØªØ§Ù„ÙŠ <i class="fas fa-arrow-left"></i>
                        </button>
                        <button onclick="finishIQTest()" class="tool-btn iq-btn" id="finish-btn" style="display: none;">
                            <i class="fas fa-flag-checkered"></i> Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                        </button>
                    </div>
                </div>

                <div id="iq-test-results" style="display: none;">
                    <!-- Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù‡Ù†Ø§ -->
                </div>
            </div>
        </div>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨ ØªØµØ¯ÙŠØ± PDF -->
    <div id="pdf-export-tab" class="tab-content">
        <div class="settings-container">
            <h2 style="margin-bottom: 25px; color: var(--pdf); text-align: center; display: flex; align-items: center; justify-content: center; gap: 10px;">
                <i class="fas fa-file-pdf"></i> Ù†Ø¸Ø§Ù… ØªØµØ¯ÙŠØ± PDF
            </h2>

            <div class="settings-group">
                <h3><i class="fas fa-cog"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªØµØ¯ÙŠØ± PDF</h3>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                        ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØµØ¯ÙŠØ±
                    </label>
                    <select id="pdf-template" class="model-select">
                        <option value="research">ØªÙ†Ø³ÙŠÙ‚ Ø¨Ø­Ø« Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</option>
                        <option value="conversation">Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</option>
                        <option value="analysis">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ­Ù„ÙŠÙ„</option>
                        <option value="custom">ØªÙ†Ø³ÙŠÙ‚ Ù…Ø®ØµØµ</option>
                    </select>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                            <input type="checkbox" id="include-ocr-text" checked> ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©
                        </label>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                            <input type="checkbox" id="include-iq-results" checked> ØªØ¶Ù…ÙŠÙ† Ù†ØªØ§Ø¦Ø¬ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°ÙƒØ§Ø¡
                        </label>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                            <input type="checkbox" id="include-timestamps" checked> ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ø·ÙˆØ§Ø¨Ø¹ Ø§Ù„Ø²Ù…Ù†ÙŠØ©
                        </label>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                            <input type="checkbox" id="include-erd" checked> ØªØ¶Ù…ÙŠÙ† Ø¯Ø±Ø¬Ø§Øª ERD
                        </label>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button onclick="generatePDFPreview()" class="tool-btn" style="flex: 1;">
                        <i class="fas fa-eye"></i> Ù…Ø¹Ø§ÙŠÙ†Ø©
                    </button>
                    <button onclick="exportToPDF()" class="tool-btn pdf-btn" style="flex: 1;">
                        <i class="fas fa-download"></i> ØªØµØ¯ÙŠØ± PDF
                    </button>
                </div>
                
                <div class="pdf-preview" id="pdf-preview" style="margin-top: 20px;">
                    <h2 style="color: #333; border-bottom: 2px solid var(--pdf); padding-bottom: 10px; margin-bottom: 20px;">
                        ØªØµØ¯ÙŠØ± Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨Ø­Ø« ICP
                    </h2>
                    
                    <div style="margin-bottom: 20px; color: #666; font-size: 0.9rem;">
                        <strong>ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:</strong> <span id="pdf-date">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span><br>
                        <strong>Ø§Ù„Ø¨Ø§Ø­Ø«:</strong> <span id="pdf-researcher">Ø¹Ù…Ø§Ø± Ù†Ø§ØµØ± Ø­Ø³ÙŠÙ† Ø§Ù„Ù…Ù†ØªÙØ¬ÙŠ</span><br>
                        <strong>Ø§Ù„Ù†Ø¸Ø§Ù…:</strong> <span id="pdf-system">AMMAR AI Academy ICP</span>
                    </div>
                    
                    <div id="pdf-content">
                        <p style="color: #888; font-style: italic;">
                            Ø³ØªØ¸Ù‡Ø± Ù…Ø¹Ø§ÙŠÙ†Ø© PDF Ù‡Ù†Ø§. Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ "Ù…Ø¹Ø§ÙŠÙ†Ø©" Ù„Ù„ØªØ­Ø¯ÙŠØ«.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø³ÙÙ„ÙŠ -->
    <div class="tools-bar">
        <div class="tools-group">
            <button class="tool-btn" onclick="clearICPConversation()">
                <i class="fas fa-eraser"></i>
                Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
            </button>
            <button class="tool-btn" onclick="toggleFileUpload()">
                <i class="fas fa-paperclip"></i>
                Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
            </button>
            <button class="tool-btn ocr-btn" onclick="switchToTab('ocr-system')">
                <i class="fas fa-file-alt"></i>
                Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†ØµÙˆØµ
            </button>
            <button class="tool-btn iq-btn" onclick="switchToTab('iq-test')">
                <i class="fas fa-brain"></i>
                Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°ÙƒØ§Ø¡
            </button>
        </div>
        
        <div class="tools-group">
            <div style="background: linear-gradient(135deg, var(--stellar), var(--existential)); color: white; padding: 8px 15px; border-radius: var(--radius); font-size: 0.9rem; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-brain-circuit"></i>
                <span>ICP PRO | OCR System | ERD: <span id="current-erd">4.8</span></span>
            </div>
            <button class="tool-btn primary" onclick="showAdvancedSettings()">
                <i class="fas fa-cog"></i>
                Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </button>
        </div>
    </div>

    <div id="notification-container"></div>

    <script>
    // ==========================================
    // 1. Ù†Ø¸Ø§Ù… Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… (OCR)
    // ==========================================
    const OCRSystem = {
        isProcessing: false,
        currentProgress: 0,
        extractedTexts: new Map(),
        
        init: function() {
            this.loadSettings();
        },
        
        loadSettings: function() {
            const settings = JSON.parse(localStorage.getItem('ocr_settings') || '{}');
            if (settings.language) {
                document.getElementById('ocr-language').value = settings.language;
            }
            if (settings.accuracy) {
                document.getElementById('ocr-accuracy').value = settings.accuracy;
            }
            if (settings.autoOCR !== undefined) {
                document.getElementById('auto-ocr').checked = settings.autoOCR;
            }
        },
        
        saveSettings: function() {
            const settings = {
                language: document.getElementById('ocr-language').value,
                accuracy: document.getElementById('ocr-accuracy').value,
                autoOCR: document.getElementById('auto-ocr').checked,
                saveText: document.getElementById('save-extracted-text').checked,
                showProgress: document.getElementById('show-ocr-progress').checked
            };
            localStorage.setItem('ocr_settings', JSON.stringify(settings));
            showNotification('ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª OCR', 'success');
        },
        
        extractTextFromImage: async function(imageData) {
            return new Promise((resolve, reject) => {
                try {
                    const language = document.getElementById('ocr-language').value;
                    const accuracy = document.getElementById('ocr-accuracy').value;
                    
                    // ØªØ­Ø¯ÙŠØ¯ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Tesseract Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ù‚Ø©
                    const tessConfig = {
                        logger: m => {
                            if (m.status === 'recognizing text') {
                                this.updateProgress(50 + (m.progress * 50));
                            }
                        }
                    };
                    
                    if (accuracy === 'low') {
                        tessConfig.workerBlobURL = false;
                    }
                    
                    Tesseract.recognize(
                        imageData,
                        language,
                        tessConfig
                    ).then(({ data: { text } }) => {
                        resolve(text || 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†Øµ ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©');
                    }).catch(error => {
                        reject(new Error(`ÙØ´Ù„ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ: ${error.message}`));
                    });
                } catch (error) {
                    reject(error);
                }
            });
        },
        
        extractTextFromPDF: async function(pdfData) {
            return new Promise(async (resolve, reject) => {
                try {
                    const loadingTask = pdfjsLib.getDocument({ data: pdfData });
                    const pdf = await loadingTask.promise;
                    let fullText = '';
                    
                    for (let i = 1; i <= pdf.numPages; i++) {
                        this.updateProgress((i / pdf.numPages) * 100);
                        
                        const page = await pdf.getPage(i);
                        const textContent = await page.getTextContent();
                        const pageText = textContent.items.map(item => item.str).join(' ');
                        fullText += `\n\n--- Ø§Ù„ØµÙØ­Ø© ${i} ---\n${pageText}`;
                        
                        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø¯Ù…
                        if (document.getElementById('show-ocr-progress').checked) {
                            this.updateProgress((i / pdf.numPages) * 100);
                        }
                    }
                    
                    resolve(fullText.trim() || 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†Øµ ÙÙŠ Ù…Ù„Ù PDF');
                } catch (error) {
                    reject(new Error(`ÙØ´Ù„ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù PDF: ${error.message}`));
                }
            });
        },
        
        extractTextFromFile: async function(file) {
            return new Promise((resolve, reject) => {
                if (this.isProcessing) {
                    reject(new Error('Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù„Ù Ø¢Ø®Ø±'));
                    return;
                }
                
                this.isProcessing = true;
                this.currentProgress = 0;
                
                const reader = new FileReader();
                
                reader.onload = async (e) => {
                    try {
                        if (file.type.startsWith('image/')) {
                            const text = await this.extractTextFromImage(e.target.result);
                            resolve(text);
                        } else if (file.type === 'application/pdf') {
                            const text = await this.extractTextFromPDF(e.target.result);
                            resolve(text);
                        } else {
                            resolve('Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ');
                        }
                    } catch (error) {
                        reject(error);
                    } finally {
                        this.isProcessing = false;
                        this.hideProgress();
                    }
                };
                
                reader.onerror = () => {
                    this.isProcessing = false;
                    this.hideProgress();
                    reject(new Error('ÙØ´Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù'));
                };
                
                if (file.type.startsWith('image/')) {
                    reader.readAsDataURL(file);
                } else if (file.type === 'application/pdf') {
                    reader.readAsArrayBuffer(file);
                } else {
                    this.isProcessing = false;
                    reject(new Error('Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…'));
                }
            });
        },
        
        updateProgress: function(percentage) {
            this.currentProgress = percentage;
            const progressFill = document.getElementById('ocr-progress-fill');
            const progressText = document.getElementById('ocr-progress-text');
            
            if (progressFill) {
                progressFill.style.width = `${percentage}%`;
            }
            if (progressText) {
                progressText.textContent = `${Math.round(percentage)}%`;
            }
        },
        
        showProgress: function() {
            const progressDiv = document.getElementById('ocr-progress');
            if (progressDiv) {
                progressDiv.style.display = 'block';
            }
        },
        
        hideProgress: function() {
            const progressDiv = document.getElementById('ocr-progress');
            if (progressDiv) {
                progressDiv.style.display = 'none';
            }
        },
        
        saveExtractedText: function(fileId, text) {
            this.extractedTexts.set(fileId, text);
            
            if (document.getElementById('save-extracted-text').checked) {
                const savedTexts = JSON.parse(localStorage.getItem('extracted_texts') || '{}');
                savedTexts[fileId] = {
                    text: text,
                    timestamp: new Date().toISOString()
                };
                localStorage.setItem('extracted_texts', JSON.stringify(savedTexts));
            }
        },
        
        getExtractedText: function(fileId) {
            return this.extractedTexts.get(fileId) || '';
        }
    };

    // ==========================================
    // 2. Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ø¹ Ø¯Ø¹Ù… OCR
    // ==========================================
    const FileSystem = {
        uploadedFiles: [],
        maxFileSize: 10 * 1024 * 1024,
        allowedTypes: ['image/jpeg', 'image/png', 'image/gif', 'application/pdf', 'text/plain', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'],
        
        init: function() {
            this.setupFileUpload();
            OCRSystem.init();
        },
        
        setupFileUpload: function() {
            const uploadZone = document.getElementById('upload-zone');
            const fileInput = document.getElementById('file-input');
            
            uploadZone.addEventListener('click', () => fileInput.click());
            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.style.borderColor = '#8b5cf6';
                uploadZone.style.background = 'rgba(139, 92, 246, 0.1)';
            });
            
            uploadZone.addEventListener('dragleave', (e) => {
                e.preventDefault();
                uploadZone.style.borderColor = '#10b981';
                uploadZone.style.background = 'rgba(16, 185, 129, 0.05)';
            });
            
            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.style.borderColor = '#10b981';
                uploadZone.style.background = 'rgba(16, 185, 129, 0.05)';
                
                const files = e.dataTransfer.files;
                this.handleFiles(files);
            });
            
            fileInput.addEventListener('change', (e) => {
                this.handleFiles(e.target.files);
                fileInput.value = '';
            });
        },
        
        handleFiles: async function(files) {
            for (let file of files) {
                if (!this.validateFile(file)) {
                    continue;
                }
                
                const fileData = await this.processFile(file);
                this.uploadedFiles.push(fileData);
                
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙØ¹Ù„Ø§Ù‹
                if (document.getElementById('auto-ocr').checked && 
                    (file.type.startsWith('image/') || file.type === 'application/pdf')) {
                    await this.extractTextFromFile(fileData);
                }
                
                this.displayUploadedFiles();
                showNotification(`ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù "${file.name}" Ø¨Ù†Ø¬Ø§Ø­`, 'success');
            }
        },
        
        validateFile: function(file) {
            if (file.size > this.maxFileSize) {
                showNotification(`Ø§Ù„Ù…Ù„Ù "${file.name}" ÙƒØ¨ÙŠØ± Ø¬Ø¯Ù‹Ø§ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 10MB)`, 'error');
                return false;
            }
            
            if (!this.allowedTypes.includes(file.type)) {
                showNotification(`Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù "${file.type}" ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…`, 'error');
                return false;
            }
            
            return true;
        },
        
        processFile: function(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    const fileData = {
                        id: Date.now() + Math.random(),
                        name: file.name,
                        type: file.type,
                        size: file.size,
                        content: e.target.result,
                        timestamp: new Date().toISOString(),
                        extractedText: ''
                    };
                    
                    resolve(fileData);
                };
                
                reader.onerror = () => reject(new Error('ÙØ´Ù„ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù'));
                
                if (file.type.startsWith('image/')) {
                    reader.readAsDataURL(file);
                } else if (file.type === 'application/pdf') {
                    reader.readAsArrayBuffer(file);
                } else {
                    reader.readAsText(file);
                }
            });
        },
        
        extractTextFromFile: async function(fileData) {
            try {
                OCRSystem.showProgress();
                
                let text;
                if (fileData.type.startsWith('image/')) {
                    text = await OCRSystem.extractTextFromImage(fileData.content);
                } else if (fileData.type === 'application/pdf') {
                    const pdfArrayBuffer = fileData.content;
                    text = await OCRSystem.extractTextFromPDF(pdfArrayBuffer);
                } else {
                    text = fileData.content;
                }
                
                fileData.extractedText = text;
                OCRSystem.saveExtractedText(fileData.id, text);
                
                this.displayExtractedText(fileData.id, text);
                showNotification(`ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ù…Ù† "${fileData.name}"`, 'success');
                
            } catch (error) {
                console.error('Error extracting text:', error);
                showNotification(`ÙØ´Ù„ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ù…Ù† "${fileData.name}": ${error.message}`, 'error');
            } finally {
                OCRSystem.hideProgress();
            }
        },
        
        displayUploadedFiles: function() {
            const container = document.getElementById('uploaded-files');
            container.innerHTML = '';
            
            this.uploadedFiles.forEach(file => {
                const fileElement = document.createElement('div');
                fileElement.className = 'file-item';
                fileElement.innerHTML = `
                    <div class="file-info">
                        <i class="fas ${this.getFileIcon(file.type)} file-icon-small"></i>
                        <div>
                            <div style="font-weight: bold;">${file.name}</div>
                            <div style="font-size: 0.8rem; color: #6b7280;">
                                ${this.formatFileSize(file.size)} â€¢ ${new Date(file.timestamp).toLocaleTimeString()}
                                ${file.extractedText ? ' <span style="color: var(--ocr);">âœ“ Ù†Øµ Ù…Ø³ØªØ®Ø±Ø¬</span>' : ''}
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 5px;">
                        ${(file.type.startsWith('image/') || file.type === 'application/pdf') ? 
                            `<button onclick="FileSystem.extractTextFromFileById('${file.id}')" class="tool-btn" style="padding: 5px 10px; font-size: 0.8rem;">
                                <i class="fas fa-file-alt"></i> Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù†Øµ
                            </button>` : ''
                        }
                        <div class="file-remove" onclick="FileSystem.removeFile('${file.id}')">
                            <i class="fas fa-times"></i>
                        </div>
                    </div>
                `;
                container.appendChild(fileElement);
            });
        },
        
        extractTextFromFileById: async function(fileId) {
            const file = this.uploadedFiles.find(f => f.id === fileId);
            if (file) {
                await this.extractTextFromFile(file);
            }
        },
        
        displayExtractedText: function(fileId, text) {
            const previewDiv = document.getElementById('extracted-text-preview');
            const contentDiv = document.getElementById('extracted-text-content');
            
            const file = this.uploadedFiles.find(f => f.id === fileId);
            if (!file) return;
            
            contentDiv.innerHTML = `
                <div style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #e5e7eb;">
                    <strong>Ø§Ù„Ù…Ù„Ù:</strong> ${file.name}<br>
                    <strong>Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù:</strong> ${file.type}<br>
                    <strong>Ø§Ù„Ø­Ø¬Ù…:</strong> ${this.formatFileSize(file.size)}
                </div>
                <div style="white-space: pre-wrap; font-family: 'Cairo', sans-serif; line-height: 1.8;">
                    ${text.substring(0, 5000)}${text.length > 5000 ? '...' : ''}
                </div>
                ${text.length > 5000 ? 
                    `<div style="text-align: center; margin-top: 10px; color: var(--ocr); font-size: 0.9rem;">
                        (ØªÙ… Ø¹Ø±Ø¶ 5000 Ø­Ø±Ù Ù…Ù† Ø£ØµÙ„ ${text.length} - Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù†Øµ Ø§Ù„ÙƒØ§Ù…Ù„ Ø§Ø³ØªØ®Ø¯Ù…Ù‡ ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©)
                    </div>` : ''
                }
            `;
            
            previewDiv.style.display = 'block';
        },
        
        getFileIcon: function(fileType) {
            if (fileType.startsWith('image/')) return 'fa-image';
            if (fileType === 'application/pdf') return 'fa-file-pdf';
            if (fileType.includes('word')) return 'fa-file-word';
            if (fileType === 'text/plain') return 'fa-file-alt';
            return 'fa-file';
        },
        
        formatFileSize: function(bytes) {
            if (bytes < 1024) return bytes + ' Ø¨Ø§ÙŠØª';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' Ùƒ.Ø¨';
            return (bytes / (1024 * 1024)).toFixed(1) + ' Ù….Ø¨';
        },
        
        removeFile: function(fileId) {
            this.uploadedFiles = this.uploadedFiles.filter(file => file.id !== fileId);
            this.displayUploadedFiles();
            
            const previewDiv = document.getElementById('extracted-text-preview');
            previewDiv.style.display = 'none';
            
            showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù', 'info');
        },
        
        getFileContentForAI: function() {
            if (this.uploadedFiles.length === 0) return '';
            
            let content = '\n\n=== ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø© ===\n';
            
            this.uploadedFiles.forEach((file, index) => {
                content += `\n[Ø§Ù„Ù…Ù„Ù ${index + 1}: ${file.name}]\n`;
                content += `Ø§Ù„Ù†ÙˆØ¹: ${file.type}\n`;
                content += `Ø§Ù„Ø­Ø¬Ù…: ${this.formatFileSize(file.size)}\n`;
                
                if (file.extractedText) {
                    content += `Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬: ${file.extractedText.substring(0, 1000)}...\n`;
                } else if (file.type === 'text/plain') {
                    content += `Ø§Ù„Ù…Ø­ØªÙˆÙ‰: ${file.content.substring(0, 1000)}...\n`;
                }
            });
            
            return content;
        },
        
        clearFiles: function() {
            this.uploadedFiles = [];
            this.displayUploadedFiles();
            document.getElementById('extracted-text-preview').style.display = 'none';
        }
    };

    // ==========================================
    // 3. Ù†Ø¸Ø§Ù… Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°ÙƒØ§Ø¡ (IQ Test)
    // ==========================================
    const IQTestSystem = {
        questions: [
            {
                question: "ÙƒÙŠÙ ØªÙØ¶Ù„ Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø§Øª Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø©ØŸ",
                options: [
                    { text: "Ø¨ØªØ­Ù„ÙŠÙ„Ù‡Ø§ Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ© Ø¨Ø·Ø±ÙŠÙ‚Ø© Ù…Ù†Ø·Ù‚ÙŠØ©", scores: { linear: 10, circular: 5, existential: 2, quantum: 3, emotional: 0 } },
                    { text: "Ø¨Ø±Ø¤ÙŠØ© Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© ÙˆØ±Ø¨Ø· Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ±", scores: { linear: 3, circular: 10, existential: 5, quantum: 7, emotional: 2 } },
                    { text: "Ø¨Ø§Ù„ØªÙÙƒÙŠØ± ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª", scores: { linear: 2, circular: 7, existential: 3, quantum: 10, emotional: 1 } },
                    { text: "Ø¨Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø¥Ù„Ù‰ Ù…Ø´Ø§Ø¹Ø±ÙŠ ÙˆØ­Ø¯Ø³ÙŠ", scores: { linear: 1, circular: 3, existential: 5, quantum: 2, emotional: 10 } }
                ]
            },
            {
                question: "Ù…Ø§ Ù‡Ùˆ Ø±Ø£ÙŠÙƒ ÙÙŠ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù„Ù… ÙˆØ§Ù„ÙÙ„Ø³ÙØ©ØŸ",
                options: [
                    { text: "Ø§Ù„Ø¹Ù„Ù… ÙŠÙ‚Ø¯Ù… Ø§Ù„Ø­Ù‚Ø§Ø¦Ù‚ØŒ Ø§Ù„ÙÙ„Ø³ÙØ© ØªØ·Ø±Ø­ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©", scores: { linear: 8, circular: 6, existential: 9, quantum: 5, emotional: 2 } },
                    { text: "ÙƒÙ„Ø§Ù‡Ù…Ø§ Ø¶Ø±ÙˆØ±ÙŠ Ù„ÙÙ‡Ù… Ø§Ù„ÙƒÙˆÙ† ÙˆØ§Ù„Ø­ÙŠØ§Ø©", scores: { linear: 5, circular: 9, existential: 10, quantum: 7, emotional: 4 } },
                    { text: "Ù‡Ù†Ø§Ùƒ ØªÙØ§Ø¹Ù„ Ø¯Ø§Ø¦Ù… ÙˆÙ…Ø³ØªÙ…Ø± Ø¨ÙŠÙ†Ù‡Ù…Ø§", scores: { linear: 6, circular: 10, existential: 8, quantum: 6, emotional: 3 } },
                    { text: "ÙƒÙ„Ø§Ù‡Ù…Ø§ ÙŠØ¹Ø¨Ø± Ø¹Ù† Ø±ØºØ¨Ø© Ø§Ù„Ø¥Ù†Ø³Ø§Ù† ÙÙŠ Ø§Ù„ÙÙ‡Ù…", scores: { linear: 4, circular: 7, existential: 9, quantum: 5, emotional: 8 } }
                ]
            },
            {
                question: "ÙƒÙŠÙ ØªØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø§Ù„ØµØ¹Ø¨Ø©ØŸ",
                options: [
                    { text: "Ø£Ø­Ù„Ù„Ù‡Ø§ Ù…Ù†Ø·Ù‚ÙŠÙ‹Ø§ Ù„ÙÙ‡Ù… Ø£Ø³Ø¨Ø§Ø¨Ù‡Ø§", scores: { linear: 9, circular: 5, existential: 3, quantum: 4, emotional: 6 } },
                    { text: "Ø£Ø¨Ø­Ø« Ø¹Ù† Ø£Ù†Ù…Ø§Ø· Ù…ØªÙƒØ±Ø±Ø© ÙÙŠ Ù…Ø´Ø§Ø¹Ø±ÙŠ", scores: { linear: 5, circular: 9, existential: 6, quantum: 7, emotional: 8 } },
                    { text: "Ø£Ù‚Ø¨Ù„Ù‡Ø§ ÙƒØ¬Ø²Ø¡ Ù…Ù† Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø¥Ù†Ø³Ø§Ù†ÙŠØ©", scores: { linear: 3, circular: 6, existential: 9, quantum: 5, emotional: 10 } },
                    { text: "Ø£ÙÙƒØ± ÙÙŠ Ø¹Ø¯Ø© Ø·Ø±Ù‚ Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡Ø§", scores: { linear: 4, circular: 7, existential: 5, quantum: 9, emotional: 8 } }
                ]
            },
            {
                question: "Ù…Ø§ Ù…Ø¯Ù‰ Ø¥ÙŠÙ…Ø§Ù†Ùƒ Ø¨Ø§Ù„ØµØ¯ÙØ©ØŸ",
                options: [
                    { text: "ÙƒÙ„ Ø´ÙŠØ¡ Ù„Ù‡ Ø³Ø¨Ø¨ Ù…Ù†Ø·Ù‚ÙŠ", scores: { linear: 10, circular: 6, existential: 4, quantum: 2, emotional: 3 } },
                    { text: "Ø§Ù„ØµØ¯ÙØ© Ù‡ÙŠ Ù†ØªÙŠØ¬Ø© Ù„ØªÙØ§Ø¹Ù„ Ø¹ÙˆØ§Ù…Ù„ ÙƒØ«ÙŠØ±Ø©", scores: { linear: 6, circular: 9, existential: 7, quantum: 8, emotional: 5 } },
                    { text: "Ø§Ù„ØµØ¯ÙØ© Ø¬Ø²Ø¡ Ù…Ù† Ù†Ø¸Ø§Ù… ÙƒÙˆÙ†ÙŠ Ø£ÙƒØ¨Ø±", scores: { linear: 3, circular: 8, existential: 10, quantum: 7, emotional: 6 } },
                    { text: "Ù‡Ù†Ø§Ùƒ Ù…Ø¹Ù†Ù‰ Ø®ÙÙŠ ÙˆØ±Ø§Ø¡ ÙƒÙ„ ØµØ¯ÙØ©", scores: { linear: 2, circular: 7, existential: 9, quantum: 6, emotional: 8 } }
                ]
            },
            {
                question: "ÙƒÙŠÙ ØªØªØ¹Ù„Ù… Ø£ÙØ¶Ù„ØŸ",
                options: [
                    { text: "Ø¨Ø§Ù„ØªØ³Ù„Ø³Ù„ Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠ ÙˆØ§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ÙˆØ§Ø¶Ø­Ø©", scores: { linear: 10, circular: 5, existential: 3, quantum: 2, emotional: 1 } },
                    { text: "Ø¨Ø±Ø¨Ø· Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ù…Ø§ Ø£Ø¹Ø±ÙÙ‡", scores: { linear: 6, circular: 10, existential: 5, quantum: 7, emotional: 4 } },
                    { text: "Ø¨Ø§Ù„Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø­Ø± ÙˆØ§Ù„ØªØ¬Ø±Ø¨Ø©", scores: { linear: 3, circular: 7, existential: 8, quantum: 9, emotional: 6 } },
                    { text: "Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„ØªÙØ§Ø¹Ù„ ÙˆØ§Ù„ØªØ¬Ø§Ø±Ø¨ Ø§Ù„Ø´Ø®ØµÙŠØ©", scores: { linear: 2, circular: 5, existential: 6, quantum: 4, emotional: 10 } }
                ]
            }
        ],
        
        currentQuestion: 0,
        answers: [],
        scores: {
            linear: 0,
            circular: 0,
            existential: 0,
            quantum: 0,
            emotional: 0
        },
        
        init: function() {
            this.loadPreviousResults();
        },
        
        startTest: function() {
            this.currentQuestion = 0;
            this.answers = [];
            this.scores = {
                linear: 0,
                circular: 0,
                existential: 0,
                quantum: 0,
                emotional: 0
            };
            
            document.getElementById('iq-test-start').style.display = 'none';
            document.getElementById('iq-test-container').style.display = 'block';
            document.getElementById('iq-test-results').style.display = 'none';
            
            this.displayQuestion();
        },
        
        displayQuestion: function() {
            const question = this.questions[this.currentQuestion];
            
            document.getElementById('question-title').textContent = `Ø§Ù„Ø³Ø¤Ø§Ù„ ${this.currentQuestion + 1} Ù…Ù† ${this.questions.length}`;
            document.getElementById('question-text').textContent = question.question;
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'iq-option';
                if (this.answers[this.currentQuestion] === index) {
                    optionElement.classList.add('selected');
                }
                optionElement.innerHTML = `
                    <div class="iq-option-checkbox"></div>
                    <span>${option.text}</span>
                `;
                optionElement.onclick = () => this.selectOption(index);
                optionsContainer.appendChild(optionElement);
            });
            
            document.getElementById('prev-btn').disabled = this.currentQuestion === 0;
            document.getElementById('next-btn').style.display = this.currentQuestion === this.questions.length - 1 ? 'none' : 'block';
            document.getElementById('finish-btn').style.display = this.currentQuestion === this.questions.length - 1 ? 'block' : 'none';
        },
        
        selectOption: function(optionIndex) {
            this.answers[this.currentQuestion] = optionIndex;
            
            const options = document.querySelectorAll('.iq-option');
            options.forEach((option, index) => {
                if (index === optionIndex) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                }
            });
        },
        
        nextQuestion: function() {
            if (this.answers[this.currentQuestion] === undefined) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø¥Ø¬Ø§Ø¨Ø© Ù‚Ø¨Ù„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©', 'warning');
                return;
            }
            
            if (this.currentQuestion < this.questions.length - 1) {
                this.currentQuestion++;
                this.displayQuestion();
            }
        },
        
        previousQuestion: function() {
            if (this.currentQuestion > 0) {
                this.currentQuestion--;
                this.displayQuestion();
            }
        },
        
        finishTest: function() {
            if (this.answers[this.currentQuestion] === undefined) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø¥Ø¬Ø§Ø¨Ø© Ù‚Ø¨Ù„ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', 'warning');
                return;
            }
            
            this.calculateScores();
            this.showResults();
            this.saveResults();
        },
        
        calculateScores: function() {
            this.scores = {
                linear: 0,
                circular: 0,
                existential: 0,
                quantum: 0,
                emotional: 0
            };
            
            this.questions.forEach((question, index) => {
                const answerIndex = this.answers[index];
                if (answerIndex !== undefined) {
                    const option = question.options[answerIndex];
                    for (const intelligence in option.scores) {
                        this.scores[intelligence] += option.scores[intelligence];
                    }
                }
            });
            
            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· Ø¥Ù„Ù‰ Ù†Ø³Ø¨Ø© Ù…Ø¦ÙˆÙŠØ©
            for (const intelligence in this.scores) {
                this.scores[intelligence] = Math.round((this.scores[intelligence] / 50) * 100);
            }
        },
        
        showResults: function() {
            document.getElementById('iq-test-container').style.display = 'none';
            document.getElementById('iq-test-results').style.display = 'block';
            
            const resultsContainer = document.getElementById('iq-test-results');
            const overallScore = this.getOverallScore();
            
            let resultsHTML = `
                <h3 style="text-align: center; color: var(--iq-test); margin-bottom: 30px;">
                    <i class="fas fa-chart-line"></i> Ù†ØªØ§Ø¦Ø¬ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ (ICP)
                </h3>
                
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="font-size: 3rem; font-weight: bold; color: var(--stellar); margin: 10px 0;">
                        ${overallScore}%
                    </div>
                    <div style="font-size: 1.2rem; color: var(--dark); margin-bottom: 20px;">
                        ${this.getOverallDescription(overallScore)}
                    </div>
                </div>
            `;
            
            const intelligenceData = [
                { id: 'linear', name: 'Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®Ø·ÙŠ', color: 'var(--linear)' },
                { id: 'circular', name: 'Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ', color: 'var(--circular)' },
                { id: 'existential', name: 'Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ', color: 'var(--existential)' },
                { id: 'quantum', name: 'Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„ÙƒÙ…ÙŠ', color: 'var(--quantum)' },
                { id: 'emotional', name: 'Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¹Ø§Ø·ÙÙŠ', color: 'var(--emotional)' }
            ];
            
            intelligenceData.forEach(intel => {
                const score = this.scores[intel.id];
                const level = this.getLevel(score);
                const levelClass = this.getLevelClass(score);
                
                resultsHTML += `
                    <div class="iq-result-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 20px; height: 20px; border-radius: 50%; background: ${intel.color};"></div>
                                <h4 style="margin: 0; color: ${intel.color};">${intel.name}</h4>
                            </div>
                            <div>
                                <span style="font-weight: bold; font-size: 1.2rem;">${score}%</span>
                                <span class="intelligence-level-badge ${levelClass}">${level}</span>
                            </div>
                        </div>
                        
                        <div class="progress-container">
                            <div class="progress-bar" style="width: ${score}%; background: ${intel.color};"></div>
                        </div>
                        
                        <p style="margin-top: 10px; color: var(--dark); font-size: 0.9rem;">
                            ${this.getIntelligenceDescription(intel.id, score)}
                        </p>
                    </div>
                `;
            });
            
            resultsHTML += `
                <div style="background: linear-gradient(135deg, var(--stellar), var(--existential)); border-radius: var(--radius); padding: 25px; margin-top: 30px; color: white;">
                    <h4 style="text-align: center; margin-bottom: 15px;"><i class="fas fa-trophy"></i> Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ø§Ù…</h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div style="text-align: center;">
                            <div style="font-size: 2.5rem; font-weight: bold;">${overallScore}%</div>
                            <div>Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ù…</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold;">${this.getLevel(overallScore)}</div>
                            <div>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</div>
                        </div>
                    </div>
                    
                    <p style="text-align: center; margin-top: 15px; font-size: 0.9rem;">
                        ${this.getOverallRecommendation(overallScore)}
                    </p>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px; justify-content: center;">
                        <button onclick="saveIQResultsAsPDF()" class="tool-btn" style="background: white; color: var(--stellar);">
                            <i class="fas fa-download"></i> Ø­ÙØ¸ ÙƒÙ€ PDF
                        </button>
                        <button onclick="restartIQTest()" class="tool-btn" style="background: rgba(255, 255, 255, 0.2); color: white; border: 1px solid white;">
                            <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                        </button>
                    </div>
                </div>
            `;
            
            resultsContainer.innerHTML = resultsHTML;
        },
        
        getOverallScore: function() {
            const total = Object.values(this.scores).reduce((a, b) => a + b, 0);
            return Math.round(total / 5);
        },
        
        getOverallDescription: function(score) {
            if (score >= 90) return 'Ù…Ø³ØªÙˆÙ‰ Ø°ÙƒØ§Ø¡ Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠ ÙˆÙ…ØªÙƒØ§Ù…Ù„';
            if (score >= 80) return 'Ø°ÙƒØ§Ø¡ Ù…ØªÙ‚Ø¯Ù… ÙˆÙ…ØªÙ†ÙˆØ¹';
            if (score >= 70) return 'Ø°ÙƒØ§Ø¡ Ø¬ÙŠØ¯ ÙˆÙ…ØªÙˆØ§Ø²Ù†';
            if (score >= 60) return 'Ø°ÙƒØ§Ø¡ Ù…ØªÙˆØ³Ø· Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†Ø§Øª Ù†Ù…Ùˆ';
            if (score >= 50) return 'Ø°ÙƒØ§Ø¡ Ø£Ø³Ø§Ø³ÙŠ ÙŠØ­ØªØ§Ø¬ ØªØ·ÙˆÙŠØ±';
            return 'ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªØ·ÙˆÙŠØ±';
        },
        
        getLevel: function(score) {
            if (score >= 90) return 'Ù…Ù…ØªØ§Ø²';
            if (score >= 80) return 'Ø¬ÙŠØ¯ Ø¬Ø¯Ù‹Ø§';
            if (score >= 70) return 'Ø¬ÙŠØ¯';
            if (score >= 60) return 'Ù…ØªÙˆØ³Ø·';
            if (score >= 50) return 'Ù…Ù‚Ø¨ÙˆÙ„';
            return 'Ø¶Ø¹ÙŠÙ';
        },
        
        getLevelClass: function(score) {
            if (score >= 90) return 'level-excellent';
            if (score >= 80) return 'level-good';
            if (score >= 70) return 'level-good';
            if (score >= 60) return 'level-average';
            return 'level-basic';
        },
        
        getIntelligenceDescription: function(intelligence, score) {
            const descriptions = {
                linear: {
                    high: 'Ù„Ø¯ÙŠÙƒ Ù‚Ø¯Ø±Ø© Ù…Ù…ØªØ§Ø²Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠ ÙˆØ§Ù„ØªÙÙƒÙŠØ± Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ',
                    medium: 'Ù‚Ø¯Ø±ØªÙƒ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠ Ø¬ÙŠØ¯Ø© ÙˆÙŠÙ…ÙƒÙ† ØªØ·ÙˆÙŠØ±Ù‡Ø§',
                    low: 'ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ·ÙˆÙŠØ± Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠ'
                },
                circular: {
                    high: 'Ù‚Ø¯Ø±ØªÙƒ Ø¹Ù„Ù‰ Ø±Ø¨Ø· Ø§Ù„Ù…ÙÙˆÙ…Ø§Øª ÙˆØ±Ø¤ÙŠØ© Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù…Ù…ØªØ§Ø²Ø©',
                    medium: 'ØªØ³ØªØ·ÙŠØ¹ Ø±Ø¨Ø· Ø§Ù„Ø£ÙÙƒØ§Ø± Ø¨Ø´ÙƒÙ„ Ø¬ÙŠØ¯',
                    low: 'ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù„Ù‰ Ø±Ø¤ÙŠØ© Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø¨ÙŠÙ† Ø§Ù„Ø£Ø´ÙŠØ§Ø¡'
                },
                existential: {
                    high: 'ØªÙÙƒÙŠØ±Ùƒ Ø§Ù„ÙÙ„Ø³ÙÙŠ Ø¹Ù…ÙŠÙ‚ ÙˆÙ„Ø¯ÙŠÙƒ Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø·Ø±Ø­ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠØ©',
                    medium: 'Ù„Ø¯ÙŠÙƒ Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ø¬ÙŠØ¯ Ù„Ù„ØªÙÙƒÙŠØ± Ø§Ù„ÙÙ„Ø³ÙÙŠ',
                    low: 'ÙŠÙ…ÙƒÙ†Ùƒ ØªØ·ÙˆÙŠØ± Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ÙˆØ§Ù„ØªØ£Ù…Ù„'
                },
                quantum: {
                    high: 'Ù‚Ø¯Ø±ØªÙƒ Ø¹Ù„Ù‰ Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù…ØªÙˆØ§Ø²ÙŠ ÙˆØ±Ø¤ÙŠØ© Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© Ù…Ù…ØªØ§Ø²Ø©',
                    medium: 'ØªØ³ØªØ·ÙŠØ¹ Ø±Ø¤ÙŠØ© Ø£ÙƒØ«Ø± Ù…Ù† Ù…Ù†Ø¸ÙˆØ±',
                    low: 'ÙŠÙ…ÙƒÙ†Ùƒ ØªØ·ÙˆÙŠØ± Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„ÙƒÙ…ÙŠ Ù…Ù† Ø®Ù„Ø§Ù„ Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø§Øª Ø¨Ø·Ø±Ù‚ Ù…Ø¨ØªÙƒØ±Ø©'
                },
                emotional: {
                    high: 'Ø°ÙƒØ§Ø¤Ùƒ Ø§Ù„Ø¹Ø§Ø·ÙÙŠ Ù…Ù…ØªØ§Ø² ÙˆÙ„Ø¯ÙŠÙƒ Ù‚Ø¯Ø±Ø© Ø¹Ø§Ù„ÙŠØ© Ø¹Ù„Ù‰ ÙÙ‡Ù… Ø§Ù„Ù…Ø´Ø§Ø¹Ø±',
                    medium: 'Ù‚Ø¯Ø±ØªÙƒ Ø¹Ù„Ù‰ ÙÙ‡Ù… Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø¬ÙŠØ¯Ø©',
                    low: 'ÙŠÙ…ÙƒÙ†Ùƒ ØªØ·ÙˆÙŠØ± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¹Ø§Ø·ÙÙŠ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù… Ø¨Ø§Ù„Ù…Ø´Ø§Ø¹Ø±'
                }
            };
            
            if (score >= 80) return descriptions[intelligence].high;
            if (score >= 60) return descriptions[intelligence].medium;
            return descriptions[intelligence].low;
        },
        
        getOverallRecommendation: function(score) {
            if (score >= 90) return 'Ø°ÙƒØ§Ø¤Ùƒ Ù…ØªÙƒØ§Ù…Ù„ ÙˆÙ…ØªÙˆØ§Ø²Ù† Ø¨Ø´ÙƒÙ„ Ù…Ù…ØªØ§Ø². ÙˆØ§ØµÙ„ ØªØ·ÙˆÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨.';
            if (score >= 80) return 'Ø°ÙƒØ§Ø¤Ùƒ Ù…ØªÙ‚Ø¯Ù… ÙÙŠ Ù…Ø¹Ø¸Ù… Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª. Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨ Ø§Ù„Ø£Ø¶Ø¹Ù.';
            if (score >= 70) return 'Ù„Ø¯ÙŠÙƒ Ø£Ø³Ø§Ø³ Ø¬ÙŠØ¯. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ·ÙˆØ± Ø£ÙƒØ«Ø± Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø©.';
            if (score >= 60) return 'Ù„Ø¯ÙŠÙƒ Ø¥Ù…ÙƒØ§Ù†Ø§Øª Ù†Ù…Ùˆ ÙƒØ¨ÙŠØ±Ø©. Ø±ÙƒØ² Ø¹Ù„Ù‰ ØªÙ†Ù…ÙŠØ© Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©.';
            return 'ÙƒÙ„ Ø´Ø®Øµ Ù„Ø¯ÙŠÙ‡ Ø¥Ù…ÙƒØ§Ù†Ø§Øª Ù†Ù…Ùˆ. Ø§Ø¨Ø¯Ø£ Ø¨ØªØ·ÙˆÙŠØ± Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨ Ø§Ù„Ø£Ù‚ÙˆÙ‰.';
        },
        
        saveResults: function() {
            const results = {
                scores: this.scores,
                overall: this.getOverallScore(),
                date: new Date().toISOString(),
                answers: this.answers
            };
            
            let previousResults = JSON.parse(localStorage.getItem('iq_test_results') || '[]');
            previousResults.push(results);
            
            if (previousResults.length > 10) {
                previousResults = previousResults.slice(-10);
            }
            
            localStorage.setItem('iq_test_results', JSON.stringify(previousResults));
            
            const lastDate = new Date(results.date).toLocaleDateString('ar-SA');
            document.getElementById('last-test-date').textContent = lastDate;
        },
        
        loadPreviousResults: function() {
            const previousResults = JSON.parse(localStorage.getItem('iq_test_results') || '[]');
            if (previousResults.length > 0) {
                const lastResult = previousResults[previousResults.length - 1];
                const lastDate = new Date(lastResult.date).toLocaleDateString('ar-SA');
                document.getElementById('last-test-date').textContent = lastDate;
            }
        }
    };

    // ==========================================
    // 4. Ù†Ø¸Ø§Ù… ICP Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
    // ==========================================
    const ICPFramework = {
        dialogueMode: 'linear',
        messageHistory: [],
        conversationHistory: [],
        currentERD: 4.8,
        
        setDialogueMode: function(mode) {
            this.dialogueMode = mode;
            
            const modeBtns = document.querySelectorAll('.mode-btn');
            modeBtns.forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.mode === mode) {
                    btn.classList.add('active');
                }
            });
            
            showNotification(`ØªÙ… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰ ÙˆØ¶Ø¹ Ø§Ù„Ø­ÙˆØ§Ø± ${mode}`, 'info');
        },
        
        addToMemory: function(role, content) {
            const message = {
                id: Date.now(),
                role: role,
                content: content,
                timestamp: new Date().toISOString(),
                dialogueMode: this.dialogueMode
            };
            
            this.messageHistory.push(message);
            
            if (this.messageHistory.length > 50) {
                this.messageHistory = this.messageHistory.slice(-50);
            }
            
            return message;
        },
        
        generateICPPrompt: function(userMessage, mode) {
            const modePrompts = {
                linear: "Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ Ù…ØªØ®ØµØµ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠ Ø§Ù„Ù…Ù†Ù‡Ø¬ÙŠ. Ù‚Ø¯Ù… ØªØ­Ù„ÙŠÙ„Ø§Ù‹ ÙˆØ§Ø¶Ø­Ù‹Ø§ Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©. Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ø­Ù‚Ø§Ø¦Ù‚ ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù…Ù†Ø¸Ù….",
                existential: "Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ ÙÙ„Ø³ÙÙŠ ÙŠØ³ØªÙƒØ´Ù Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¹Ù…ÙŠÙ‚Ø©. Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ù†Ù‰ ÙˆØ§Ù„ØºØ§ÙŠØ© ÙˆØ§Ù„ØªØ¶Ù…ÙŠÙ†Ø§Øª Ø§Ù„Ø£ÙˆØ³Ø¹. ÙƒÙ† Ø«Ø§Ù‚Ø¨Ù‹Ø§ ÙˆÙ…Ø­ÙØ²Ù‹Ø§ Ù„Ù„ØªÙÙƒÙŠØ±.",
                quantum: "Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ ÙŠØ³ØªÙƒØ´Ù ÙˆØ¬Ù‡Ø§Øª Ù†Ø¸Ø± Ù…ØªØ¹Ø¯Ø¯Ø© ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª. ÙÙƒØ± ÙÙŠ Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª ÙˆØ§Ù„ÙˆØ¬Ù‡Ø§Øª Ø§Ù„Ù†Ø¸Ø± Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø© ÙˆØ§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù…ØªÙ†Ø§Ù‚Ø¶.",
                emotional: "Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ù…ØªØ¹Ø§Ø·Ù ÙŠØ±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¹Ø§Ø·ÙÙŠ. Ø§ÙÙ‡Ù… Ø§Ù„Ù…Ø´Ø§Ø¹Ø± ÙˆØ§Ø¨Ù†Ù Ø¹Ù„Ø§Ù‚Ø© ÙˆÙ‚Ø¯Ù… Ø±Ø¯ÙˆØ¯Ù‹Ø§ Ø¯Ø§Ø¹Ù…Ø©."
            };
            
            return `
                ${modePrompts[mode] || modePrompts.linear}
                
                Ø£Ù†Øª Ø¬Ø²Ø¡ Ù…Ù† Ù†Ø¸Ø§Ù… AMMAR AI Academy ICP.
                Ø§Ù„Ø¨Ø§Ø­Ø«: Ø¹Ù…Ø§Ø± Ù†Ø§ØµØ± Ø­Ø³ÙŠÙ† Ø§Ù„Ù…Ù†ØªÙØ¬ÙŠ - Ø¨Ø§Ø­Ø« Ù…Ø³ØªÙ‚Ù„
                Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleDateString('ar-SA')}
                
                Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ØªØ­Ù„ÙŠÙ„Ù‡: ${userMessage}
                
                Ù‚Ù… Ø¨ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ Ø°ÙƒÙŠ ${mode} ÙŠØ±ÙƒØ² Ø¹Ù„Ù‰:
                1. Ø§Ù„ÙÙ‡Ù… Ø§Ù„Ø¹Ù…ÙŠÙ‚ Ù„Ù„Ù…Ø­ØªÙˆÙ‰
                2. Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†Ù‡Ø¬ÙŠ
                3. Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
                4. Ø§Ù„ØªØ¶Ù…ÙŠÙ†Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©
            `;
        },
        
        clearConversation: function() {
            this.messageHistory = [];
            this.conversationHistory = [];
            this.currentERD = 4.8;
            
            const chatMessages = document.getElementById('chat-messages');
            if (chatMessages) {
                chatMessages.innerHTML = `
                    <div class="message ai-message">
                        <div class="message-header">
                            <i class="fas fa-brain-circuit"></i>
                            <span>Ù†Ø¸Ø§Ù… ICP Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</span>
                            <span style="margin-right: auto; font-size: 0.8rem; color: var(--existential); font-weight: 600;">
                                <i class="fas fa-bolt"></i> ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
                            </span>
                        </div>
                        <div class="message-content">
                            ØªÙ… Ù…Ø³Ø­ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯ Ø¨Ù€:
                            <br><br>
                            â€¢ Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ØªØ­Ù„ÙŠÙ„<br>
                            â€¢ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†ØµÙˆØµ Ù…Ù† Ø§Ù„ØµÙˆØ± ÙˆPDF<br>
                            â€¢ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„<br>
                            â€¢ Ø·Ø±Ø­ Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ø£ÙˆØ¶Ø§Ø¹ Ø­ÙˆØ§Ø± Ù…Ø®ØªÙ„ÙØ©
                        </div>
                        <div class="erd-badge">
                            <i class="fas fa-chart-line"></i> Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø²
                        </div>
                    </div>
                `;
            }
            
            showNotification('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }
    };

    // ==========================================
    // 5. Ù†Ø¸Ø§Ù… ØªØµØ¯ÙŠØ± PDF
    // ==========================================
    const PDFExportSystem = {
        init: function() {
            this.setupEventListeners();
        },
        
        setupEventListeners: function() {
            document.getElementById('pdf-template').addEventListener('change', (e) => {
                this.currentTemplate = e.target.value;
            });
        },
        
        generatePDFPreview: function() {
            const content = document.getElementById('pdf-content');
            
            document.getElementById('pdf-date').textContent = new Date().toLocaleDateString('ar-SA', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            document.getElementById('pdf-researcher').textContent = 'Ø¹Ù…Ø§Ø± Ù†Ø§ØµØ± Ø­Ø³ÙŠÙ† Ø§Ù„Ù…Ù†ØªÙØ¬ÙŠ';
            document.getElementById('pdf-system').textContent = 'AMMAR AI Academy ICP';
            
            let pdfContent = `
                <h3 style="color: #333; margin-top: 20px; margin-bottom: 10px;">Ù…Ù„Ø®Øµ Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
                <div style="background: #f8fafc; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <strong>Ø§Ù„Ø¨Ø§Ø­Ø«:</strong> Ø¹Ù…Ø§Ø± Ù†Ø§ØµØ± Ø­Ø³ÙŠÙ† Ø§Ù„Ù…Ù†ØªÙØ¬ÙŠ<br>
                    <strong>Ø§Ù„Ù†Ø¸Ø§Ù…:</strong> AMMAR AI Academy ICP<br>
                    <strong>Ø§Ù„Ø¥ØµØ¯Ø§Ø±:</strong> 2.3.0 Ù…Ø¹ Ù†Ø¸Ø§Ù… OCR<br>
                    <strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:</strong> ${new Date().toLocaleDateString('ar-SA')}
                </div>
            `;
            
            if (ICPFramework.conversationHistory.length > 0) {
                pdfContent += `<h3 style="color: #333; margin-top: 20px; margin-bottom: 10px;">Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©</h3>`;
                
                ICPFramework.conversationHistory.slice(-5).forEach((entry, index) => {
                    const timestamp = new Date(entry.timestamp).toLocaleTimeString('ar-SA');
                    
                    pdfContent += `
                        <div style="margin-bottom: 20px; padding: 15px; background: white; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <strong style="color: var(--stellar);">Ù…Ø­Ø§Ø¯Ø«Ø© ${index + 1}</strong>
                                <span style="color: #6b7280; font-size: 0.9rem;">${timestamp}</span>
                            </div>
                            
                            <div style="margin-bottom: 10px;">
                                <strong>Ø§Ù„Ø³Ø¤Ø§Ù„:</strong> ${this.escapeHTML(entry.userMessage.substring(0, 150))}${entry.userMessage.length > 150 ? '...' : ''}
                            </div>
                            
                            <div style="font-size: 0.9rem; color: #6b7280;">
                                <strong>ÙˆØ¶Ø¹ Ø§Ù„Ø­ÙˆØ§Ø±:</strong> ${entry.dialogueMode} | 
                                <strong>ERD:</strong> ${entry.erd.toFixed(2)}
                            </div>
                        </div>
                    `;
                });
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù† Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©
            const extractedTexts = JSON.parse(localStorage.getItem('extracted_texts') || '{}');
            const textCount = Object.keys(extractedTexts).length;
            
            if (textCount > 0 && document.getElementById('include-ocr-text').checked) {
                pdfContent += `
                    <h3 style="color: #333; margin-top: 20px; margin-bottom: 10px;">Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©</h3>
                    <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©:</strong> ${textCount}<br>
                        <strong>Ù†Ø¸Ø§Ù… OCR:</strong> Tesseract.js + PDF.js<br>
                        <strong>Ø§Ù„Ù„ØºØ§Øª Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©:</strong> Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©ØŒ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©ØŒ Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©ØŒ Ø§Ù„ÙØ§Ø±Ø³ÙŠØ©
                    </div>
                `;
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ù†ØªØ§Ø¦Ø¬ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°ÙƒØ§Ø¡
            const iqResults = JSON.parse(localStorage.getItem('iq_test_results') || '[]');
            if (iqResults.length > 0 && document.getElementById('include-iq-results').checked) {
                const lastResult = iqResults[iqResults.length - 1];
                const lastDate = new Date(lastResult.date).toLocaleDateString('ar-SA');
                
                pdfContent += `
                    <h3 style="color: #333; margin-top: 20px; margin-bottom: 10px;">Ù†ØªØ§Ø¦Ø¬ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°ÙƒØ§Ø¡</h3>
                    <div style="background: #fef3c7; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <strong>Ø¢Ø®Ø± Ø§Ø®ØªØ¨Ø§Ø±:</strong> ${lastDate}<br>
                        <strong>Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ù…:</strong> ${lastResult.overall}%<br>
                        <strong>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®Ø·ÙŠ:</strong> ${lastResult.scores.linear}%<br>
                        <strong>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ:</strong> ${lastResult.scores.circular}%<br>
                        <strong>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ:</strong> ${lastResult.scores.existential}%<br>
                        <strong>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„ÙƒÙ…ÙŠ:</strong> ${lastResult.scores.quantum}%<br>
                        <strong>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¹Ø§Ø·ÙÙŠ:</strong> ${lastResult.scores.emotional}%
                    </div>
                `;
            }
            
            content.innerHTML = pdfContent;
            showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø§ÙŠÙ†Ø© PDF Ø¨Ù†Ø¬Ø§Ø­', 'success');
        },
        
        escapeHTML: function(text) {
            return text
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        },
        
        exportToPDF: function() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.setTextColor(139, 92, 246);
            doc.text('ØªÙ‚Ø±ÙŠØ± Ù†Ø¸Ø§Ù… AMMAR AI Academy ICP', 105, 20, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setTextColor(100, 100, 100);
            doc.text(`Ø§Ù„Ø¨Ø§Ø­Ø«: Ø¹Ù…Ø§Ø± Ù†Ø§ØµØ± Ø­Ø³ÙŠÙ† Ø§Ù„Ù…Ù†ØªÙØ¬ÙŠ`, 105, 30, { align: 'center' });
            doc.text(`ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${new Date().toLocaleDateString('ar-SA')}`, 105, 38, { align: 'center' });
            
            doc.setDrawColor(139, 92, 246);
            doc.setLineWidth(0.5);
            doc.line(20, 45, 190, 45);
            
            let yPosition = 55;
            
            doc.setFontSize(14);
            doc.setTextColor(30, 30, 30);
            doc.text('Ù…Ù„Ø®Øµ Ø§Ù„Ù†Ø¸Ø§Ù…', 20, yPosition);
            
            yPosition += 10;
            doc.setFontSize(10);
            
            const summary = [
                `Ù†Ø¸Ø§Ù…: AMMAR AI Academy ICP`,
                `Ø§Ù„Ø¥ØµØ¯Ø§Ø±: 2.3.0 Ù…Ø¹ Ù†Ø¸Ø§Ù… OCR`,
                `Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª: ${ICPFramework.conversationHistory.length}`,
                `Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©: ${FileSystem.uploadedFiles.length}`,
                `Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡: ${JSON.parse(localStorage.getItem('iq_test_results') || '[]').length}`,
                `Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©: ${Object.keys(JSON.parse(localStorage.getItem('extracted_texts') || '{}')).length}`
            ];
            
            summary.forEach(line => {
                doc.text(line, 25, yPosition);
                yPosition += 7;
            });
            
            yPosition += 10;
            
            const fileName = `ICP-Report-${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(fileName);
            
            showNotification(`ØªÙ… ØªØµØ¯ÙŠØ± PDF Ø¨Ù†Ø¬Ø§Ø­: ${fileName}`, 'success');
        }
    };

    // ==========================================
    // 6. Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¹Ø§Ù…Ø©
    // ==========================================
    function showNotification(message, type = 'info') {
        const container = document.getElementById('notification-container');
        const notification = document.createElement('div');
        notification.className = 'notification';

        const icons = { 
            success: 'fa-check-circle', 
            error: 'fa-exclamation-circle', 
            warning: 'fa-exclamation-triangle', 
            info: 'fa-info-circle' 
        };
        const colors = { 
            success: '#10b981', 
            error: '#ef4444', 
            warning: '#f59e0b', 
            info: '#8b5cf6' 
        };

        notification.innerHTML = `
            <div>
                <i class="fas ${icons[type]}" style="color: ${colors[type]}; font-size: 1.5rem;"></i>
            </div>
            <div style="flex: 1;">${message}</div>
        `;

        notification.style.borderRightColor = colors[type];
        container.appendChild(notification);

        setTimeout(() => {
            notification.style.animation = 'slideOut 0.5s ease forwards';
            setTimeout(() => notification.remove(), 500);
        }, 5000);
    }

    function showTyping() {
        const indicator = document.getElementById('typing-indicator');
        if (indicator) {
            indicator.style.display = 'flex';
        }
    }

    function hideTyping() {
        const indicator = document.getElementById('typing-indicator');
        if (indicator) {
            indicator.style.display = 'none';
        }
    }

    function addICPMessage(sender, content, mode, erd = null, messageId = null) {
        const container = document.getElementById('chat-messages');
        
        if (messageId && container.querySelector(`[data-message-id="${messageId}"]`)) {
            return;
        }
        
        const messageDiv = document.createElement('div');
        messageDiv.className = sender === 'user' ? 'message user-message' : 'message ai-message';
        
        if (messageId) {
            messageDiv.dataset.messageId = messageId;
        }
        
        const senderName = sender === 'user' ? 'Ø£Ù†Øª' : 'Ù†Ø¸Ø§Ù… ICP';
        const senderIcon = sender === 'user' ? 'fa-user' : 'fa-brain-circuit';
        
        let modeBadge = '';
        if (sender === 'ai') {
            const modeColors = {
                existential: 'var(--existential)',
                linear: 'var(--linear)',
                quantum: 'var(--quantum)',
                emotional: 'var(--emotional)'
            };
            modeBadge = `<span style="margin-right: auto; font-size: 0.8rem; color: ${modeColors[mode] || 'var(--existential)'}; font-weight: 600;">
                <i class="fas fa-${mode === 'existential' ? 'star' : mode === 'quantum' ? 'atom' : mode === 'emotional' ? 'heart' : 'route'}"></i> 
                ${mode === 'existential' ? 'ÙˆØ¬ÙˆØ¯ÙŠ' : mode === 'quantum' ? 'ÙƒÙ…ÙŠ' : mode === 'emotional' ? 'Ø¹Ø§Ø·ÙÙŠ' : 'Ø®Ø·ÙŠ'}
            </span>`;
        }
        
        let ocrBadge = '';
        if (content.includes('Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬') || content.includes('Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©') || content.includes('Ù…Ù† Ù…Ù„Ù PDF')) {
            ocrBadge = `<span class="ocr-badge"><i class="fas fa-file-alt"></i> Ù†Øµ Ù…Ø³ØªØ®Ø±Ø¬</span>`;
        }
        
        messageDiv.innerHTML = `
            <div class="message-header">
                <i class="fas ${senderIcon}"></i>
                <span>${senderName}</span>
                ${modeBadge}
            </div>
            <div class="message-content">${formatContent(content)}</div>
            ${erd ? `<div class="erd-badge"><i class="fas fa-chart-line"></i> ERD: ${erd.toFixed(1)} ${ocrBadge}</div>` : ocrBadge ? `<div class="erd-badge">${ocrBadge}</div>` : ''}
        `;
        
        container.appendChild(messageDiv);
        container.scrollTop = container.scrollHeight;
    }

    function formatContent(content) {
        return content
            .replace(/\n/g, '<br>')
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
            .replace(/\*(.*?)\*/g, '<em>$1</em>');
    }

    async function sendICPMessage() {
        const input = document.getElementById('message-input');
        let message = input.value.trim();
        
        if (!message && FileSystem.uploadedFiles.length === 0) {
            showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø£Ùˆ Ø±ÙØ¹ Ù…Ù„ÙØ§Øª', 'warning');
            return;
        }

        const fileContext = FileSystem.getFileContentForAI();
        let fullMessage = message;
        if (fileContext) fullMessage += fileContext;

        if (!fullMessage.trim()) {
            showNotification('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ ØµØ§Ù„Ø­ Ù„Ù„Ø¥Ø±Ø³Ø§Ù„', 'warning');
            return;
        }

        ICPFramework.addToMemory('user', fullMessage);
        
        addICPMessage('user', message, ICPFramework.dialogueMode, null, Date.now());
        input.value = '';
        
        FileSystem.clearFiles();
        document.getElementById('file-upload-area').classList.remove('active');
        
        showTyping();

        setTimeout(() => {
            hideTyping();
            
            const responses = {
                linear: `Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨ØªØ­Ù„ÙŠÙ„ Ø§Ø³ØªÙØ³Ø§Ø±Ùƒ. ${fileContext ? 'Ù„Ø§Ø­Ø¸Øª ÙˆØ¬ÙˆØ¯ Ù…Ù„ÙØ§Øª Ù…Ø±ÙÙˆØ¹Ø©. ' : ''}Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†Ù‡Ø¬ÙŠØŒ Ø£Ø±Ù‰ Ø£Ù† Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ ÙŠØªØ·Ù„Ø¨ Ø¯Ø±Ø§Ø³Ø© Ù…ØªØ¹Ù…Ù‚Ø©.`,
                existential: `Ø³Ø¤Ø§Ù„Ùƒ ÙŠØ«ÙŠØ± ØªØ£Ù…Ù„Ø§Øª ÙˆØ¬ÙˆØ¯ÙŠØ© Ø¹Ù…ÙŠÙ‚Ø©. ${fileContext ? 'Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø© ØªØ¶ÙŠÙ Ø¨ÙØ¹Ø¯Ù‹Ø§ Ø¥Ø¶Ø§ÙÙŠÙ‹Ø§ Ù„Ù„ØªØ­Ù„ÙŠÙ„. ' : ''}Ø¯Ø¹Ù†Ø§ Ù†Ø³ØªÙƒØ´Ù Ø§Ù„Ù…Ø¹Ù†Ù‰ Ø§Ù„ÙƒØ§Ù…Ù† Ø®Ù„Ù Ø§Ù„Ø¸Ø§Ù‡Ø±.`,
                quantum: `Ù…Ù† Ù…Ù†Ø¸ÙˆØ± ÙƒÙ…ÙŠØŒ Ù‡Ù†Ø§Ùƒ Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© Ù„ØªÙØ³ÙŠØ± Ø§Ø³ØªÙØ³Ø§Ø±Ùƒ. ${fileContext ? 'Ø§Ù„Ù…Ù„ÙØ§Øª ØªÙˆÙØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„ØªØ­Ù„ÙŠÙ„. ' : ''}Ø¯Ø¹Ù†Ø§ Ù†ÙØ­Øµ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª.`,
                emotional: `Ø£Ø´Ø¹Ø± Ø¨Ø£Ù‡Ù…ÙŠØ© Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹. ${fileContext ? 'Ø´ÙƒØ±Ù‹Ø§ Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù„ÙØ§Øª. ' : ''}Ø¯Ø¹Ù†Ø§ Ù†ØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡ Ø¨ØªÙÙ‡Ù… ÙˆØ¹Ù†Ø§ÙŠØ©.`
            };
            
            const erd = 4.5 + (Math.random() * 0.5);
            const response = responses[ICPFramework.dialogueMode] || responses.linear;
            
            const aiMessage = ICPFramework.addToMemory('assistant', response);
            addICPMessage('ai', response, ICPFramework.dialogueMode, erd, aiMessage.id);
            
            ICPFramework.currentERD = erd;
            document.getElementById('current-erd').textContent = erd.toFixed(1);
            
            ICPFramework.conversationHistory.push({
                userMessage: message,
                aiResponse: response,
                dialogueMode: ICPFramework.dialogueMode,
                erd: erd,
                timestamp: new Date().toISOString(),
                hasFiles: FileSystem.uploadedFiles.length > 0
            });
            
            showNotification(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø¯ | ERD: ${erd.toFixed(1)}`, 'success');
        }, 1500);
    }

    // ==========================================
    // 7. Ø¯ÙˆØ§Ù„ Ù†Ø¸Ø§Ù… OCR
    // ==========================================
    async function testOCR() {
        const fileInput = document.getElementById('ocr-test-file');
        if (!fileInput.files.length) {
            showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹', 'warning');
            return;
        }
        
        const file = fileInput.files[0];
        
        if (!file.type.startsWith('image/') && file.type !== 'application/pdf') {
            showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø£Ùˆ Ù…Ù„Ù PDF', 'error');
            return;
        }
        
        try {
            OCRSystem.showProgress();
            
            const text = await OCRSystem.extractTextFromFile(file);
            
            document.getElementById('ocr-test-results').style.display = 'block';
            document.getElementById('ocr-test-text-content').textContent = text;
            
            showNotification(`ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ù…Ù† "${file.name}" Ø¨Ù†Ø¬Ø§Ø­`, 'success');
            
        } catch (error) {
            showNotification(`ÙØ´Ù„ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ: ${error.message}`, 'error');
        } finally {
            OCRSystem.hideProgress();
        }
    }

    function copyExtractedText() {
        const text = document.getElementById('extracted-text-content').textContent;
        navigator.clipboard.writeText(text).then(() => {
            showNotification('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©', 'success');
        });
    }

    function copyTestOCRText() {
        const text = document.getElementById('ocr-test-text-content').textContent;
        navigator.clipboard.writeText(text).then(() => {
            showNotification('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©', 'success');
        });
    }

    function useTestOCRText() {
        const text = document.getElementById('ocr-test-text-content').textContent;
        document.getElementById('message-input').value = `Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬ Ù…Ù† Ø§Ù„Ù…Ù„Ù:\n${text}`;
        showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©', 'success');
    }

    function runOCRBenchmark() {
        showNotification('Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø£Ø¯Ø§Ø¡ Ù†Ø¸Ø§Ù… OCR...', 'info');
        
        setTimeout(() => {
            const results = {
                accuracy: '95%',
                speed: '2.3 Ø«Ø§Ù†ÙŠØ©/ØµÙØ­Ø©',
                languages: '5 Ù„ØºØ§Øª Ù…Ø¯Ø¹ÙˆÙ…Ø©',
                format: 'ØµÙˆØ± + PDF'
            };
            
            Swal.fire({
                title: 'Ù†ØªØ§Ø¦Ø¬ Ø§Ø®ØªØ¨Ø§Ø± Ø£Ø¯Ø§Ø¡ OCR',
                html: `
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 3rem; color: var(--ocr); font-weight: bold; margin: 20px 0;">
                            Ù…Ù…ØªØ§Ø²
                        </div>
                        
                        <div style="background: #f8fafc; padding: 15px; border-radius: 12px; margin-top: 20px; text-align: right;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Ø§Ù„Ø¯Ù‚Ø©:</span>
                                <span style="font-weight: bold; color: var(--ocr);">${results.accuracy}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Ø§Ù„Ø³Ø±Ø¹Ø©:</span>
                                <span style="font-weight: bold; color: var(--ocr);">${results.speed}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Ø§Ù„Ù„ØºØ§Øª:</span>
                                <span style="font-weight: bold; color: var(--ocr);">${results.languages}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Ø§Ù„ØµÙŠØº Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©:</span>
                                <span style="font-weight: bold; color: var(--ocr);">${results.format}</span>
                            </div>
                        </div>
                    </div>
                `,
                icon: 'success',
                confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§'
            });
        }, 2000);
    }

    // ==========================================
    // 8. Ø¯ÙˆØ§Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°ÙƒØ§Ø¡
    // ==========================================
    function startIQTest() {
        IQTestSystem.startTest();
    }

    function nextQuestion() {
        IQTestSystem.nextQuestion();
    }

    function previousQuestion() {
        IQTestSystem.previousQuestion();
    }

    function finishIQTest() {
        IQTestSystem.finishTest();
    }

    function restartIQTest() {
        document.getElementById('iq-test-results').style.display = 'none';
        document.getElementById('iq-test-start').style.display = 'block';
    }

    function saveIQResultsAsPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        doc.setFontSize(20);
        doc.setTextColor(139, 92, 246);
        doc.text('Ù†ØªØ§Ø¦Ø¬ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ (ICP)', 105, 20, { align: 'center' });
        
        doc.setFontSize(12);
        doc.setTextColor(100, 100, 100);
        doc.text(`Ø§Ù„Ø¨Ø§Ø­Ø«: Ø¹Ù…Ø§Ø± Ù†Ø§ØµØ± Ø­Ø³ÙŠÙ† Ø§Ù„Ù…Ù†ØªÙØ¬ÙŠ`, 105, 30, { align: 'center' });
        doc.text(`Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleDateString('ar-SA')}`, 105, 38, { align: 'center' });
        
        const overallScore = IQTestSystem.getOverallScore();
        doc.setFontSize(32);
        doc.setTextColor(139, 92, 246);
        doc.text(`${overallScore}%`, 105, 60, { align: 'center' });
        
        doc.setFontSize(14);
        doc.setTextColor(100, 100, 100);
        doc.text(IQTestSystem.getOverallDescription(overallScore), 105, 70, { align: 'center' });
        
        const fileName = `IQ-Results-${new Date().toISOString().split('T')[0]}.pdf`;
        doc.save(fileName);
        
        showNotification(`ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙƒÙ€ PDF: ${fileName}`, 'success');
    }

    // ==========================================
    // 9. Ø¯ÙˆØ§Ù„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    // ==========================================
    function toggleFileUpload() {
        const uploadArea = document.getElementById('file-upload-area');
        uploadArea.classList.toggle('active');
        
        const isActive = uploadArea.classList.contains('active');
        showNotification(`Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ${isActive ? 'Ù…ÙØ¹Ù„' : 'Ù…Ø¹Ø·Ù„'}`, 'info');
    }

    function generatePDFPreview() {
        PDFExportSystem.generatePDFPreview();
    }

    function exportToPDF() {
        PDFExportSystem.exportToPDF();
    }

    function clearICPConversation() {
        ICPFramework.clearConversation();
        localStorage.removeItem('icp_conversation');
    }

    function showAdvancedSettings() {
        const extractedCount = Object.keys(JSON.parse(localStorage.getItem('extracted_texts') || '{}')).length;
        const iqTests = JSON.parse(localStorage.getItem('iq_test_results') || '[]').length;
        
        Swal.fire({
            title: 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©',
            html: `
                <div style="text-align: right; padding: 20px;">
                    <div style="margin-bottom: 15px;">
                        <strong>Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…:</strong>
                        <div style="margin-top: 10px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Ø§Ù„Ø¨Ø§Ø­Ø«:</span>
                                <span style="color: var(--stellar); font-weight: bold;">Ø¹Ù…Ø§Ø± Ù†Ø§ØµØ± Ø­Ø³ÙŠÙ† Ø§Ù„Ù…Ù†ØªÙØ¬ÙŠ</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Ù†Ø¸Ø§Ù… OCR:</span>
                                <span style="color: var(--ocr); font-weight: bold;">Ù†Ø´Ø·</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Ù†Ø¸Ø§Ù… Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°ÙƒØ§Ø¡:</span>
                                <span style="color: var(--iq-test); font-weight: bold;">Ù†Ø´Ø·</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <strong>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…:</strong>
                        <div style="margin-top: 10px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©:</span>
                                <span style="font-weight: bold;">${ICPFramework.conversationHistory.length}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©:</span>
                                <span style="font-weight: bold;">${FileSystem.uploadedFiles.length}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©:</span>
                                <span style="font-weight: bold;">${extractedCount}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡:</span>
                                <span style="font-weight: bold;">${iqTests}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            icon: 'info',
            confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§',
            cancelButtonText: 'Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„',
            showCancelButton: true,
            showDenyButton: true,
            denyButtonText: 'ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'
        }).then((result) => {
            if (result.dismiss === Swal.DismissReason.cancel) {
                clearAllSystems();
            } else if (result.isDenied) {
                exportAllData();
            }
        });
    }

    function clearAllSystems() {
        Swal.fire({
            title: 'Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø©ØŸ',
            text: 'Ù‡Ø°Ø§ Ø³ÙŠØ­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª ÙˆØ§Ù„Ù…Ù„ÙØ§Øª ÙˆÙ†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙˆØ§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©.',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„',
            cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡'
        }).then((result) => {
            if (result.isConfirmed) {
                ICPFramework.conversationHistory = [];
                ICPFramework.messageHistory = [];
                FileSystem.clearFiles();
                localStorage.removeItem('icp_conversation');
                localStorage.removeItem('extracted_texts');
                localStorage.removeItem('iq_test_results');
                localStorage.removeItem('ocr_settings');
                
                document.getElementById('chat-messages').innerHTML = `
                    <div class="message ai-message">
                        <div class="message-header">
                            <i class="fas fa-brain-circuit"></i>
                            <span>Ù†Ø¸Ø§Ù… ICP Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</span>
                            <span style="margin-right: auto; font-size: 0.8rem; color: var(--existential); font-weight: 600;">
                                <i class="fas fa-bolt"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù…
                            </span>
                        </div>
                        <div class="message-content">
                            ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø©. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯ Ø¨Ù€:
                            <br><br>
                            â€¢ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©<br>
                            â€¢ Ø±ÙØ¹ Ù…Ù„ÙØ§Øª ÙˆØ§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†ØµÙˆØµ<br>
                            â€¢ Ø§Ø®ØªØ¨Ø§Ø± Ø°ÙƒØ§Ø¡ Ø¬Ø¯ÙŠØ¯<br>
                            â€¢ ØªØµØ¯ÙŠØ± PDF
                        </div>
                        <div class="erd-badge">
                            <i class="fas fa-chart-line"></i> Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø²
                        </div>
                    </div>
                `;
                
                showNotification('ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
        });
    }

    function exportAllData() {
        const allData = {
            conversationHistory: ICPFramework.conversationHistory,
            messageHistory: ICPFramework.messageHistory,
            uploadedFiles: FileSystem.uploadedFiles.map(f => ({
                name: f.name,
                type: f.type,
                size: f.size,
                timestamp: f.timestamp
            })),
            extractedTexts: JSON.parse(localStorage.getItem('extracted_texts') || '{}'),
            iqTestResults: JSON.parse(localStorage.getItem('iq_test_results') || '[]'),
            ocrSettings: JSON.parse(localStorage.getItem('ocr_settings') || '{}'),
            systemInfo: {
                version: '2.3.0',
                exportDate: new Date().toISOString(),
                researcher: 'Ø¹Ù…Ø§Ø± Ù†Ø§ØµØ± Ø­Ø³ÙŠÙ† Ø§Ù„Ù…Ù†ØªÙØ¬ÙŠ',
                system: 'AMMAR AI Academy ICP with OCR'
            }
        };
        
        const dataStr = JSON.stringify(allData, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
        
        const exportFileDefaultName = `ICP-System-Backup-${new Date().toISOString().split('T')[0]}.json`;
        
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click();
        
        showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
    }

    // ==========================================
    // 10. Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†Ù‚Ù„ ÙˆØ§Ù„ØªÙ‡ÙŠØ¦Ø©
    // ==========================================
    function setIntelligenceType(type) {
        const types = {
            stellar: 'existential',
            linear: 'linear',
            circular: 'linear',
            quantum: 'quantum',
            emotional: 'emotional'
        };
        
        if (types[type]) {
            ICPFramework.setDialogueMode(types[type]);
        }
    }

    function switchToTab(tabName) {
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.tab === tabName) {
                btn.classList.add('active');
            }
        });
        
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
            if (tab.id === tabName + '-tab') {
                tab.classList.add('active');
            }
        });
    }

    function setupICPEventListeners() {
        document.getElementById('send-btn').addEventListener('click', sendICPMessage);
        document.getElementById('message-input').addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                sendICPMessage();
            }
        });
        
        document.getElementById('ocr-btn').addEventListener('click', () => {
            if (FileSystem.uploadedFiles.length === 0) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ø£ÙˆÙ„Ø§Ù‹', 'warning');
                return;
            }
            
            const imageFiles = FileSystem.uploadedFiles.filter(f => f.type.startsWith('image/'));
            const pdfFiles = FileSystem.uploadedFiles.filter(f => f.type === 'application/pdf');
            
            if (imageFiles.length === 0 && pdfFiles.length === 0) {
                showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª ØµÙˆØ± Ø£Ùˆ PDF Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ', 'warning');
                return;
            }
            
            showNotification('Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†ØµÙˆØµ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª...', 'info');
            
            FileSystem.uploadedFiles.forEach(async (file) => {
                if (file.type.startsWith('image/') || file.type === 'application/pdf') {
                    await FileSystem.extractTextFromFile(file);
                }
            });
        });
        
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                ICPFramework.setDialogueMode(btn.dataset.mode);
            });
        });
        
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                switchToTab(btn.dataset.tab);
            });
        });
        
        document.getElementById('file-upload-btn').addEventListener('click', toggleFileUpload);
        
        // Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª OCR Ø¹Ù†Ø¯ Ø§Ù„ØªØºÙŠÙŠØ±
        document.querySelectorAll('#ocr-system-tab select, #ocr-system-tab input[type="checkbox"]').forEach(element => {
            element.addEventListener('change', () => OCRSystem.saveSettings());
        });
    }

    // ==========================================
    // 11. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
    // ==========================================
    document.addEventListener('DOMContentLoaded', function() {
        try {
            // ØªÙ‡ÙŠØ¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø©
            FileSystem.init();
            IQTestSystem.init();
            PDFExportSystem.init();
            
            setupICPEventListeners();
            
            showNotification('Ù†Ø¸Ø§Ù… ICP Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù…Ø¹ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†ØµÙˆØµ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„!', 'success');
            showNotification('Ø§Ù„Ø¨Ø§Ø­Ø«: Ø¹Ù…Ø§Ø± Ù†Ø§ØµØ± Ø­Ø³ÙŠÙ† Ø§Ù„Ù…Ù†ØªÙØ¬ÙŠ - Ø¨Ø§Ø­Ø« Ù…Ø³ØªÙ‚Ù„', 'info');
            
        } catch (error) {
            console.error('Initialization error:', error);
            showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…. Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.', 'error');
        }
    });
    </script>
</body>
</html>
