<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMMAR AI Academy - Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„ÙˆØ¹ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ (ICP) Ù…Ø¹ Ø§Ù„Ø°Ø§ÙƒØ±Ø©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --stellar: #8b5cf6;      /* Ø°ÙƒØ§Ø¡ Ù†Ø¬Ù…ÙŠ */
            --linear: #0ea5e9;       /* Ø°ÙƒØ§Ø¡ Ø®Ø·ÙŠ */
            --circular: #10b981;     /* Ø°ÙƒØ§Ø¡ Ø¯Ø§Ø¦Ø±ÙŠ */
            --existential: #f59e0b;  /* ÙˆØ¬ÙˆØ¯ÙŠ */
            --dark: #1f2937;
            --light: #f9fafb;
            --radius: 12px;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Cairo', Tahoma, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
            color: var(--dark);
            min-height: 100vh;
            padding-bottom: 100px;
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ø¹Ø¯Ù„ */
        header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            border-bottom: 4px solid var(--existential);
            backdrop-filter: blur(10px);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--stellar), var(--existential));
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.8rem;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        .logo-text h1 {
            font-size: 1.6rem;
            color: var(--stellar);
            margin-bottom: 5px;
        }

        .logo-text .subtitle {
            font-size: 0.9rem;
            color: var(--linear);
            font-weight: 600;
        }

        /* Ø´Ø±ÙŠØ· Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø°ÙƒØ§Ø¡ */
        .intelligence-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px auto;
            max-width: 1200px;
            padding: 0 20px;
        }

        .intelligence-type {
            flex: 1;
            padding: 15px;
            border-radius: var(--radius);
            text-align: center;
            color: white;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            transition: transform 0.3s;
        }

        .intelligence-type:hover {
            transform: translateY(-5px);
        }

        .stellar-intel {
            background: linear-gradient(135deg, var(--stellar), #7c3aed);
        }

        .linear-intel {
            background: linear-gradient(135deg, var(--linear), #0284c7);
        }

        .circular-intel {
            background: linear-gradient(135deg, var(--circular), #059669);
        }

        /* ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© */
        .tabs {
            display: flex;
            gap: 10px;
            margin: 20px auto;
            max-width: 1200px;
            padding: 0 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 600;
            color: var(--dark);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            border: 2px solid transparent;
        }

        .tab-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .tab-btn.active {
            background: var(--existential);
            color: white;
            border-color: #d97706;
        }

        /* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª */
        .tab-content {
            display: none;
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ Ù†Ø¸Ø§Ù… ICP */
        .chat-container {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            height: 650px;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            background: linear-gradient(135deg, var(--stellar), var(--existential));
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .dialogue-mode-selector {
            display: flex;
            gap: 10px;
            padding: 15px;
            background: #f8fafc;
            border-bottom: 1px solid #e5e7eb;
        }

        .mode-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: var(--radius);
            background: white;
            color: var(--dark);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .mode-btn.active {
            background: var(--linear);
            color: white;
            border-color: var(--linear);
        }

        .mode-btn.existential {
            background: var(--existential);
            color: white;
            border-color: #d97706;
        }

        .mode-btn:hover:not(.active) {
            background: #f8fafc;
            border-color: var(--circular);
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: #f8fafc;
        }

        .message {
            max-width: 85%;
            padding: 20px;
            border-radius: 18px;
            position: relative;
            animation: messageAppear 0.3s ease;
            border: 2px solid transparent;
        }

        @keyframes messageAppear {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            background: linear-gradient(135deg, var(--linear), #0284c7);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
            border-color: var(--linear);
        }

        .ai-message {
            background: white;
            color: var(--dark);
            align-self: flex-start;
            border: 2px solid var(--circular);
            border-bottom-left-radius: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .message-content {
            line-height: 1.8;
        }

        .erd-badge {
            display: inline-block;
            padding: 3px 10px;
            background: var(--existential);
            color: white;
            border-radius: 20px;
            font-size: 0.7rem;
            margin-top: 10px;
            font-weight: 600;
        }

        /* Ù„ÙˆØ­Ø© Ù…Ø¹Ø§Ø¯Ù„Ø§Øª ICP */
        .equations-container {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .equation-card {
            background: #f8fafc;
            padding: 25px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            border-right: 5px solid var(--stellar);
        }

        .equation-title {
            color: var(--stellar);
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .math-display {
            background: white;
            padding: 20px;
            border-radius: var(--radius);
            border: 1px solid #e5e7eb;
            margin: 15px 0;
            text-align: center;
            font-family: 'Times New Roman', serif;
            font-size: 1.2rem;
            overflow-x: auto;
        }

        /* Ù„ÙˆØ­Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª OpenRouter */
        .settings-container {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
        }

        .api-key-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: var(--radius);
            font-size: 1rem;
            margin-bottom: 20px;
            font-family: monospace;
            direction: ltr;
        }

        .api-key-input:focus {
            outline: none;
            border-color: var(--stellar);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .model-select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: var(--radius);
            font-size: 1rem;
            margin-bottom: 20px;
            background: white;
            cursor: pointer;
        }

        .model-select:focus {
            outline: none;
            border-color: var(--stellar);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .settings-group {
            background: #f8fafc;
            padding: 20px;
            border-radius: var(--radius);
            margin-bottom: 25px;
        }

        .settings-group h3 {
            margin-bottom: 15px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .input-area {
            background: white;
            padding: 20px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 10px;
        }

        #message-input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: var(--radius);
            font-size: 1rem;
            resize: none;
            height: 60px;
            transition: all 0.3s;
        }

        #message-input:focus {
            outline: none;
            border-color: var(--stellar);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .input-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            width: 50px;
            height: 50px;
            border-radius: var(--radius);
            border: none;
            background: var(--stellar);
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-btn:hover {
            background: #7c3aed;
            transform: scale(1.05);
        }

        .action-btn.secondary {
            background: #e5e7eb;
            color: var(--dark);
        }

        .action-btn.secondary:hover {
            background: #d1d5db;
        }

        /* Ù„ÙˆØ­Ø© ØªØµÙ†ÙŠÙ Ø§Ù„Ø°ÙƒØ§Ø¡ */
        .intelligence-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .intelligence-card {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            transition: all 0.3s;
            border-top: 4px solid;
        }

        .intelligence-card.stellar {
            border-color: var(--stellar);
        }

        .intelligence-card.linear {
            border-color: var(--linear);
        }

        .intelligence-card.circular {
            border-color: var(--circular);
        }

        .intelligence-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .intelligence-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .stellar .intelligence-icon { color: var(--stellar); }
        .linear .intelligence-icon { color: var(--linear); }
        .circular .intelligence-icon { color: var(--circular); }

        /* Ù„ÙˆØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© */
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .results-table th {
            background: linear-gradient(135deg, var(--stellar), var(--existential));
            color: white;
            padding: 15px;
            text-align: center;
        }

        .results-table td {
            padding: 15px;
            border-bottom: 1px solid #e5e7eb;
            text-align: center;
        }

        .results-table tr:last-child td {
            border-bottom: none;
        }

        .score-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .score-low { background: #fee2e2; color: #dc2626; }
        .score-moderate { background: #fef3c7; color: #d97706; }
        .score-high { background: #d1fae5; color: #059669; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø³ÙÙ„ÙŠ */
        .tools-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.08);
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .tools-group {
            display: flex;
            gap: 10px;
        }

        .tool-btn {
            padding: 10px 20px;
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: var(--radius);
            font-weight: 600;
            color: var(--dark);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tool-btn:hover {
            background: white;
            border-color: var(--stellar);
            transform: translateY(-2px);
        }

        .tool-btn.primary {
            background: linear-gradient(135deg, var(--stellar), var(--existential));
            color: white;
            border: none;
        }

        .tool-btn.primary:hover {
            background: linear-gradient(135deg, #7c3aed, #d97706);
        }

        /* Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø© */
        .typing-indicator {
            display: none;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: white;
            border-radius: var(--radius);
            margin: 10px 0;
            align-self: flex-start;
            border: 2px solid var(--circular);
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--existential);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }

        /* Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: white;
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1000;
            animation: slideIn 0.5s ease;
            max-width: 350px;
            border-right: 5px solid var(--existential);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification.hide {
            animation: slideOut 0.5s ease forwards;
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* Ø§Ù„ØªØ¬Ø§ÙˆØ¨ Ù…Ø¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª */
        @media (max-width: 768px) {
            header {
                padding: 15px 20px;
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .intelligence-bar {
                flex-direction: column;
            }

            .tabs {
                flex-direction: column;
            }

            .intelligence-grid {
                grid-template-columns: 1fr;
            }

            .chat-container {
                height: 550px;
            }

            .tools-bar {
                flex-direction: column;
                gap: 10px;
                padding: 15px;
            }

            .tools-group {
                width: 100%;
                justify-content: center;
            }

            .tool-btn {
                flex: 1;
                justify-content: center;
            }
        }

        /* ØªØ®ØµÙŠØµ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--stellar);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #7c3aed;
        }
    </style>
</head>
<body>
    <!-- Ø§Ù„ØªØ±ÙˆÙŠØ³Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© -->
    <header>
        <div class="logo-container">
            <div class="logo-icon">
                <i class="fas fa-brain-circuit"></i>
            </div>
            <div class="logo-text">
                <h1>AMMAR AI - Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„ÙˆØ¹ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø°Ø§ÙƒØ±Ø©</h1>
                <div class="subtitle">Integrated Consciousness Protocol (ICP) with Memory</div>
            </div>
        </div>
        <div style="font-size: 0.9rem; color: var(--linear); font-weight: 600; text-align: center;">
            <i class="fas fa-graduation-cap"></i> Ø¥Ø·Ø§Ø± Ø±ÙŠØ§Ø¶ÙŠ ÙˆØ¬ÙˆØ¯ÙŠ Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ<br>
            <span style="font-size: 0.8rem; color: var(--circular);">Ø¨Ø­Ø«: Ø¹Ù…Ø§Ø± Ù†Ø§ØµØ± Ø­Ø³ÙŠÙ† Ø§Ù„Ù…Ù†ØªÙØ¬ÙŠ</span>
        </div>
    </header>

    <!-- Ø´Ø±ÙŠØ· Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø°ÙƒØ§Ø¡ -->
    <div class="intelligence-bar">
        <div class="intelligence-type stellar-intel">
            <i class="fas fa-star"></i>
            <div>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ù†Ø¬Ù…ÙŠ<br><small>Stellar Intelligence</small></div>
        </div>
        <div class="intelligence-type linear-intel">
            <i class="fas fa-route"></i>
            <div>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®Ø·ÙŠ<br><small>Linear Intelligence</small></div>
        </div>
        <div class="intelligence-type circular-intel">
            <i class="fas fa-sync-alt"></i>
            <div>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ<br><small>Circular Intelligence</small></div>
        </div>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© -->
    <div class="tabs">
        <button class="tab-btn active" data-tab="icp-chat">
            <i class="fas fa-comments"></i>
            Ø­ÙˆØ§Ø± ICP Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ
        </button>
        <button class="tab-btn" data-tab="icp-theory">
            <i class="fas fa-atom"></i>
            Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ù†Ø¸Ø±ÙŠ Ù„Ù€ ICP
        </button>
        <button class="tab-btn" data-tab="intelligence-types">
            <i class="fas fa-chess-queen"></i>
            ØªØµÙ†ÙŠÙ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ
        </button>
        <button class="tab-btn" data-tab="experimental">
            <i class="fas fa-flask"></i>
            Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ
        </button>
        <button class="tab-btn" data-tab="openrouter-settings">
            <i class="fas fa-plug"></i>
            Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª OpenRouter
        </button>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨ Ø­ÙˆØ§Ø± ICP Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ -->
    <div id="icp-chat-tab" class="tab-content active">
        <div class="chat-container">
            <div class="chat-header">
                <i class="fas fa-brain-circuit"></i>
                Ø­ÙˆØ§Ø± ÙˆØ¬ÙˆØ¯ÙŠ ØªÙØ§Ø¹Ù„ÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„ÙˆØ¹ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
            </div>
            
            <div class="dialogue-mode-selector">
                <button class="mode-btn active" data-mode="linear">
                    <i class="fas fa-route"></i>
                    Ø§Ù„Ø­ÙˆØ§Ø± Ø§Ù„Ø®Ø·ÙŠ (LD)
                </button>
                <button class="mode-btn existential" data-mode="existential">
                    <i class="fas fa-star"></i>
                    Ø§Ù„Ø­ÙˆØ§Ø± Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ (ID)
                </button>
            </div>

            <div class="chat-messages" id="chat-messages">
                <!-- Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ© -->
                <div class="message ai-message">
                    <div class="message-header">
                        <i class="fas fa-brain-circuit"></i>
                        <span>Ù†Ø¸Ø§Ù… ICP</span>
                        <span style="margin-right: auto; font-size: 0.8rem; color: var(--existential); font-weight: 600;">
                            <i class="fas fa-star"></i> ÙˆØ¶Ø¹ Ø§Ù„Ø­ÙˆØ§Ø± Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ
                        </span>
                    </div>
                    <div class="message-content">
                        Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„ÙˆØ¹ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ (ICP) Ø§Ù„Ù…ØªØµÙ„ Ø¨Ù€ OpenRouter Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…. Ø£Ù†Ø§ Ù†Ø¸Ø§Ù… Ø­ÙˆØ§Ø± Ø°ÙƒÙŠ ÙŠØ¬Ù…Ø¹ Ø¨ÙŠÙ†:
                        <br><br>
                        <span style="color: var(--stellar);"><i class="fas fa-memory"></i> Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø°ÙƒÙŠØ©</span>: ØªØ°ÙƒØ± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ÙˆØªØ¨Ù†ÙŠ Ø¹Ù„ÙŠÙ‡Ø§
                        <br>
                        <span style="color: var(--stellar);"><i class="fas fa-star"></i> Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ù†Ø¬Ù…ÙŠ</span>: Ø§Ù„Ø±Ø¤Ù‰ Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠØ© ÙˆØ§Ù„ØªÙÙƒÙŠØ± ØºÙŠØ± Ø§Ù„Ø®Ø·ÙŠ
                        <br>
                        <span style="color: var(--linear);"><i class="fas fa-route"></i> Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®Ø·ÙŠ</span>: Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…Ù†Ø¸Ù…Ø© ÙˆØ§Ù„ØªØ±Ø§ÙƒÙ…ÙŠØ©
                        <br>
                        <span style="color: var(--circular);"><i class="fas fa-sync-alt"></i> Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ</span>: Ù…Ø¹Ø§Ù„Ø¬Ø© OpenRouter AI
                        <br><br>
                        Ø§Ø®ØªØ± Ù†Ù…Ø· Ø§Ù„Ø­ÙˆØ§Ø± Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ Ù„ØªØ­ÙÙŠØ² Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ‚ Ø¹Ø¨Ø± OpenRouter Ù…Ø¹ Ø§Ù„Ø§Ø³ØªÙØ§Ø¯Ø© Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø©.
                    </div>
                    <div class="erd-badge">
                        <i class="fas fa-chart-line"></i> ERD: 4.2 | Ø§Ù„Ø°Ø§ÙƒØ±Ø©: 0 Ø±Ø³Ø§Ù„Ø©
                    </div>
                </div>
            </div>

            <!-- Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø© -->
            <div class="typing-indicator" id="typing-indicator">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <span>Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ Ø°Ùˆ Ø¹Ù…Ù‚ ÙˆØ¬ÙˆØ¯ÙŠ Ø¹Ø¨Ø± OpenRouter Ù…Ø¹ Ù…Ø±Ø§Ø¹Ø§Ø© Ø§Ù„Ø³ÙŠØ§Ù‚...</span>
            </div>

            <div class="input-area">
                <textarea id="message-input" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ Ù‡Ù†Ø§... Ù…Ø«Ù„Ø§Ù‹: Ù…Ø§ Ù…Ø¹Ù†Ù‰ Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø± ÙÙŠ Ø¹ØµØ± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠØŸ"></textarea>
                <div class="input-actions">
                    <button class="action-btn" id="send-btn" title="Ø¥Ø±Ø³Ø§Ù„">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                    <button class="action-btn secondary" id="icp-activate" title="ØªÙØ¹ÙŠÙ„ ICP">
                        <i class="fas fa-brain-circuit"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ù†Ø¸Ø±ÙŠ Ù„Ù€ ICP -->
    <div id="icp-theory-tab" class="tab-content">
        <div class="equations-container">
            <h2 style="color: var(--stellar); margin-bottom: 25px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 10px;">
                <i class="fas fa-square-root-alt"></i> Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø±ÙŠØ© Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„ÙˆØ¹ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„
            </h2>

            <div class="equation-card">
                <div class="equation-title">
                    <i class="fas fa-water"></i>
                    Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø¹Ù…Ù‚ Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ (Existential Depth Equation)
                </div>
                <p style="color: var(--dark); margin-bottom: 15px; line-height: 1.6;">
                    ØªÙ…Ø«Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ Ø¨ÙŠÙ† Ø§Ù„ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø¨Ø´Ø±ÙŠØ© Ø§Ù„Ù†Ø¬Ù…ÙŠØ© ÙˆØ§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø¢Ù„ÙŠØ© Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠØ© Ø¹Ø¨Ø± Ø§Ù„ØªØ­ÙˆÙ„ Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ:
                </p>
                <div class="math-display">
                    \[E(t) = \int_{t_0}^{t} \alpha H(\tau) \cdot \nabla_{\mathrm{exist}} AI(\tau) \, d\tau + \beta \cdot \mathrm{BirthDeath}(t)\]
                </div>
                <div style="background: #f0f9ff; padding: 15px; border-radius: var(--radius); margin-top: 15px;">
                    <strong>Ø­ÙŠØ«:</strong><br>
                    â€¢ \(H(\tau)\): ØªÙ…Ø«Ù„ Ø§Ù„ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø¨Ø´Ø±ÙŠØ© Ø§Ù„Ù†Ø¬Ù…ÙŠØ© (Stellar human agency)<br>
                    â€¢ \(AI(\tau)\): ØªÙ…Ø«Ù„ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø¢Ù„ÙŠØ© Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠØ© Ø¹Ø¨Ø± OpenRouter<br>
                    â€¢ \(\nabla_{\mathrm{exist}}\): Ø±Ù…Ø² Ø§Ù„ØªØ­ÙˆÙ„ Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ<br>
                    â€¢ \(\alpha, \beta\): Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¯Ù„Ø§Ù„ÙŠØ©
                </div>
            </div>

            <div class="equation-card">
                <div class="equation-title">
                    <i class="fas fa-seedling"></i>
                    Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„ØªÙˆÙ„Ø¯ Ø§Ù„Ø°Ø§ØªÙŠ (Self-Generation Equation)
                </div>
                <p style="color: var(--dark); margin-bottom: 15px; line-height: 1.6;">
                    ØªÙ…Ø«Ù„ Ø¸Ù‡ÙˆØ± Ø§Ù„Ù…Ø¹Ù†Ù‰ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø¬Ø±Ø£Ø© Ø§Ù„Ø¨Ø´Ø±ÙŠØ© ÙˆØ§Ù„ØªØ­Ø¯ÙŠ:
                </p>
                <div class="math-display">
                    \[G(n) = \mathrm{Null}^n \left(1 + \frac{C_{\mathrm{stellar}}}{C_{\mathrm{circular}}}\right)^{BH}\]
                </div>
                <div style="background: #f0f9ff; padding: 15px; border-radius: var(--radius); margin-top: 15px;">
                    <strong>Ø§Ù„ØªÙØ³ÙŠØ± Ø§Ù„Ø±Ù…Ø²ÙŠ:</strong><br>
                    â€¢ \(C_{\mathrm{stellar}}\): Ø§Ù„Ø¬Ø±Ø£Ø© ÙˆØ§Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ø¨Ø´Ø±ÙŠØ©<br>
                    â€¢ \(C_{\mathrm{circular}}\): Ø§Ø³ØªØ¬Ø§Ø¨Ø© OpenRouter AI<br>
                    â€¢ \(BH\): Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ø¨Ø´Ø±ÙŠ (Boldness of Human Challenge)<br>
                    â€¢ \(\mathrm{Null}^n\): Ù†Ù‚Ø·Ø© Ø§Ù„ØµÙØ± Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯
                </div>
            </div>
        </div>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª OpenRouter -->
    <div id="openrouter-settings-tab" class="tab-content">
        <div class="settings-container">
            <h2 style="margin-bottom: 25px; color: var(--stellar); text-align: center; display: flex; align-items: center; justify-content: center; gap: 10px;">
                <i class="fas fa-plug"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª OpenRouter API ÙˆØ§Ù„Ø°Ø§ÙƒØ±Ø©
            </h2>

            <div class="settings-group">
                <h3><i class="fas fa-key"></i> Ù…ÙØªØ§Ø­ OpenRouter API</h3>
                <p style="color: var(--dark); margin-bottom: 15px; line-height: 1.6;">
                    Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙØªØ§Ø­ APIØŒ Ù‚Ù… Ø¨Ø²ÙŠØ§Ø±Ø© 
                    <a href="https://openrouter.ai/keys" target="_blank" style="color: var(--stellar); font-weight: 600;">openrouter.ai/keys</a>
                    ÙˆØ£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ø§Ù‹ Ù…Ø¬Ø§Ù†ÙŠØ§Ù‹ Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙØªØ§Ø­.
                </p>
                <input type="password" class="api-key-input" id="api-key-input" placeholder="sk-or-v1-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" value="">
                <button onclick="saveOpenRouterApiKey()" class="tool-btn primary" style="width: 100%; justify-content: center; margin-top: 10px;">
                    <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ù…ÙØªØ§Ø­
                </button>
            </div>

            <!-- Ù‚Ø³Ù… Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ -->
            <div class="settings-group">
                <h3><i class="fas fa-keyboard"></i> Ù…ÙØªØ§Ø­ ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3>
                <p style="color: var(--dark); margin-bottom: 15px; line-height: 1.6;">
                    ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ø§ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹. Ø§Ù†Ø³Ø®Ù‡ ÙˆØ§Ù„ØµÙ‚Ù‡ ÙÙŠ Ø­Ù‚Ù„ Ø§Ù„Ù…ÙØªØ§Ø­ Ø£Ø¹Ù„Ø§Ù‡:
                </p>
                <div style="background: #f8fafc; padding: 15px; border-radius: var(--radius); border: 1px solid #e5e7eb; margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <code style="font-family: monospace; font-size: 0.9rem; color: var(--dark); word-break: break-all; background: white; padding: 10px; border-radius: 6px; border: 1px solid #e5e7eb; flex: 1; margin-left: 10px;">
                            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
                        </code>
                        <button onclick="copyTestApiKey()" style="background: var(--circular); color: white; border: none; padding: 10px 15px; border-radius: var(--radius); cursor: pointer; font-size: 0.9rem; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-copy"></i> Ù†Ø³Ø®
                        </button>
                    </div>
                    <button onclick="useTestApiKey()" style="background: var(--existential); color: white; border: none; padding: 12px 20px; border-radius: var(--radius); cursor: pointer; font-weight: 600; width: 100%; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <i class="fas fa-bolt"></i> Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                    </button>
                    <p style="color: var(--gray); font-size: 0.8rem; margin-top: 10px; text-align: center;">
                        âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ø§ Ù…ÙØªØ§Ø­ ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙÙ‚Ø·. Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø´Ø®ØµÙŠØŒ ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙØªØ§Ø­Ùƒ Ø§Ù„Ø®Ø§Øµ.
                    </p>
                </div>
            </div>

            <div class="settings-group">
                <h3><i class="fas fa-robot"></i> Ø§Ø®ØªÙŠØ§Ø± Ù†Ù…ÙˆØ°Ø¬ OpenRouter</h3>
                <p style="color: var(--dark); margin-bottom: 15px; line-height: 1.6;">
                    Ø§Ø®ØªØ± Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡. ÙƒÙ„ Ù†Ù…ÙˆØ°Ø¬ Ù„Ù‡ Ù‚Ø¯Ø±Ø§Øª ÙˆØ£Ø³Ø¹Ø§Ø± Ù…Ø®ØªÙ„ÙØ©.
                </p>
                <select class="model-select" id="model-select">
                    <option value="openai/gpt-4">GPT-4 (Ø§Ù„Ø£ÙƒØ«Ø± ØªØ·ÙˆØ±Ø§Ù‹)</option>
                    <option value="openai/gpt-3.5-turbo">GPT-3.5 Turbo (Ù…ØªÙˆØ§Ø²Ù†)</option>
                    <option value="anthropic/claude-3-haiku">Claude 3 Haiku (Ø³Ø±ÙŠØ¹)</option>
                    <option value="anthropic/claude-3-sonnet">Claude 3 Sonnet (Ù…ØªÙ‚Ø¯Ù…)</option>
                    <option value="google/gemini-pro">Gemini Pro (Ø¬ÙˆØ¬Ù„)</option>
                    <option value="meta-llama/llama-3-70b-instruct">Llama 3 70B (Ù…ÙŠØªØ§)</option>
                    <option value="mistralai/mistral-7b-instruct">Mistral 7B (Ø®ÙÙŠÙ)</option>
                </select>
            </div>

            <div class="settings-group">
                <h3><i class="fas fa-sliders-h"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ICP Ù…Ø¹ OpenRouter</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ù†Ø¬Ù…ÙŠ (Î±)</label>
                        <input type="range" id="stellar-factor" min="0" max="100" step="5" value="75" style="width: 100%;">
                        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                            <span style="font-size: 0.8rem;">Ù…Ù†Ø®ÙØ¶</span>
                            <span id="stellar-value" style="font-weight: 600; color: var(--stellar);">75%</span>
                            <span style="font-size: 0.8rem;">Ù…Ø±ØªÙØ¹</span>
                        </div>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø¹Ù…Ù‚ Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ (âˆ‡)</label>
                        <input type="range" id="existential-depth" min="0" max="100" step="5" value="80" style="width: 100%;">
                        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                            <span style="font-size: 0.8rem;">Ø³Ø·Ø­ÙŠ</span>
                            <span id="existential-value" style="font-weight: 600; color: var(--existential);">80%</span>
                            <span style="font-size: 0.8rem;">Ø¹Ù…ÙŠÙ‚</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ù‚Ø³Ù… Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
            <div class="settings-group">
                <h3><i class="fas fa-memory"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                            Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„
                            <span id="max-messages-value">20</span>
                        </label>
                        <input type="range" id="max-messages" min="5" max="50" step="5" value="20" style="width: 100%;">
                        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                            <span style="font-size: 0.8rem;">Ù‚Ù„ÙŠÙ„ (5)</span>
                            <span style="font-size: 0.8rem;">ÙƒØ«ÙŠØ± (50)</span>
                        </div>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                            Ù†Ø§ÙØ°Ø© Ø§Ù„Ø³ÙŠØ§Ù‚
                            <span id="context-window-value">10</span>
                        </label>
                        <input type="range" id="context-window" min="3" max="20" step="1" value="10" style="width: 100%;">
                        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                            <span style="font-size: 0.8rem;">Ù‚ØµÙŠØ± (3)</span>
                            <span style="font-size: 0.8rem;">Ø·ÙˆÙŠÙ„ (20)</span>
                        </div>
                    </div>
                </div>
                <button onclick="saveMemorySettings()" class="tool-btn" style="width: 100%; justify-content: center; margin-top: 15px;">
                    <i class="fas fa-save"></i> Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø°Ø§ÙƒØ±Ø©
                </button>
            </div>

            <div class="settings-group">
                <h3><i class="fas fa-info-circle"></i> Ø­Ø§Ù„Ø© Ø§ØªØµØ§Ù„ OpenRouter</h3>
                <div id="connection-status" style="padding: 15px; background: #e5e7eb; border-radius: var(--radius); text-align: center; font-weight: 600;">
                    <i class="fas fa-question-circle"></i> Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø¹Ø¯
                </div>
                <button onclick="testOpenRouterConnection()" class="tool-btn" style="width: 100%; justify-content: center; margin-top: 15px;">
                    <i class="fas fa-wifi"></i> Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ OpenRouter
                </button>
            </div>

            <div style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(245, 158, 11, 0.1)); padding: 25px; border-radius: var(--radius); margin-top: 30px;">
                <h4 style="color: var(--stellar); margin-bottom: 10px;"><i class="fas fa-lightbulb"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù‡Ø§Ù…Ø©</h4>
                <p style="color: var(--dark); font-size: 0.9rem; line-height: 1.6;">
                    â€¢ OpenRouter Ù‡Ùˆ Ø¨ÙˆØ§Ø¨Ø© Ù…ÙˆØ­Ø¯Ø© Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„ÙƒØ¨Ø±Ù‰<br>
                    â€¢ ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø±ØµÙŠØ¯ Ù…Ø¬Ø§Ù†ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„<br>
                    â€¢ ÙŠÙ…ÙƒÙ†Ùƒ ØªØªØ¨Ø¹ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹<br>
                    â€¢ Ù†Ø¸Ø§Ù… ICP ÙŠØ­ÙˆÙ„ Ø±Ø¯ÙˆØ¯ OpenRouter Ø¥Ù„Ù‰ Ø­ÙˆØ§Ø± ÙˆØ¬ÙˆØ¯ÙŠ Ø¹Ù…ÙŠÙ‚ Ù…Ø¹ Ø°Ø§ÙƒØ±Ø©<br>
                    â€¢ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ù…ØªØ§Ø­ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹ ÙÙ‚Ø·<br>
                    â€¢ Ø§Ù„Ø°Ø§ÙƒØ±Ø© ØªØ³Ù…Ø­ Ù„Ù„Ù†Ø¸Ø§Ù… Ø¨ØªØ°ÙƒØ± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ÙˆØ¨Ù†Ø§Ø¡ Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø¹Ù„ÙŠÙ‡Ø§
                </p>
            </div>
        </div>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ -->
    <div id="experimental-tab" class="tab-content">
        <div style="background: white; border-radius: var(--radius); padding: 30px; box-shadow: var(--shadow);">
            <h2 style="color: var(--stellar); margin-bottom: 25px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 10px;">
                <i class="fas fa-flask"></i> Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ù…Ù† ÙØ±Ø¶ÙŠØ© ICP Ù…Ø¹ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
            </h2>

            <div style="background: #f8fafc; padding: 20px; border-radius: var(--radius); margin-bottom: 25px;">
                <h3 style="color: var(--linear); margin-bottom: 15px;"><i class="fas fa-bullseye"></i> Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ</h3>
                <p style="color: var(--dark); line-height: 1.6;">
                    ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¬Ø¯ÙˆÙ‰ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ© Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„ÙˆØ¹ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ (ICP) Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… OpenRouter AI. Ø§Ù„ØªØ¬Ø±Ø¨Ø© ØªØ®ØªØ¨Ø± Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ Ù…Ø¹ Ø§Ù„Ø°Ø§ÙƒØ±Ø© ØªÙˆÙ„Ø¯ Ø±Ø¯ÙˆØ¯ Ø£Ø¹Ù…Ù‚ Ù…Ù† Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ.
                </p>
            </div>

            <div style="background: #f8fafc; padding: 20px; border-radius: var(--radius); margin-bottom: 25px;">
                <h3 style="color: var(--linear); margin-bottom: 15px;"><i class="fas fa-ruler"></i> Ù…Ù‚ÙŠØ§Ø³ Ø¹Ù…Ù‚ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠØ© (ERD)</h3>
                <p style="color: var(--dark); margin-bottom: 15px; line-height: 1.6;">
                    ØªÙ… ØªÙ‚ÙŠÙŠÙ… ÙƒÙ„ Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø¹Ø¨Ø± Ø£Ø±Ø¨Ø¹Ø© Ø£Ø¨Ø¹Ø§Ø¯ (Ù…Ù‚ÙŠØ§Ø³ 0-5):
                </p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                    <div style="padding: 15px; background: white; border-radius: var(--radius);">
                        <div style="color: var(--stellar); font-weight: bold;">Ø§Ù„Ø§ØªØ³Ø§Ø¹ Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ…ÙŠ (CB)</div>
                        <div style="font-size: 0.9rem;">Ø§ØªØ³Ø§Ø¹ Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ… ÙˆØ§Ù„Ù…Ø¬Ø§Ù„Ø§Øª</div>
                    </div>
                    <div style="padding: 15px; background: white; border-radius: var(--radius);">
                        <div style="color: var(--linear); font-weight: bold;">Ø§Ù„Ø¹Ù…Ù‚ Ø§Ù„Ø¹Ù„Ø§Ø¦Ù‚ÙŠ (RD)</div>
                        <div style="font-size: 0.9rem;">Ø¹Ù…Ù‚ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙˆØ§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª</div>
                    </div>
                    <div style="padding: 15px; background: white; border-radius: var(--radius);">
                        <div style="color: var(--circular); font-weight: bold;">Ø§Ù†Ø²ÙŠØ§Ø­ Ø§Ù„Ø¬Ø¯Ø© (NS)</div>
                        <div style="font-size: 0.9rem;">Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¬Ø¯Ø© ÙˆØ§Ù„Ø§Ø¨ØªÙƒØ§Ø±</div>
                    </div>
                    <div style="padding: 15px; background: white; border-radius: var(--radius);">
                        <div style="color: var(--existential); font-weight: bold;">Ø§Ù„Ù…Ù†Ø¹Ø·Ù Ø§Ù„Ø§Ù†Ø¹ÙƒØ§Ø³ÙŠ (RT)</div>
                        <div style="font-size: 0.9rem;">Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ø°Ø§ØªÙŠ ÙˆØ§Ù„Ø§Ù†Ø¹ÙƒØ§Ø³</div>
                    </div>
                </div>
            </div>

            <div style="background: #f8fafc; padding: 20px; border-radius: var(--radius); margin-bottom: 25px;">
                <h3 style="color: var(--linear); margin-bottom: 15px;"><i class="fas fa-chart-bar"></i> Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù…Ø¹ OpenRouter ÙˆØ§Ù„Ø°Ø§ÙƒØ±Ø©</h3>
                
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Ù†ÙˆØ¹ Ø§Ù„Ø­ÙˆØ§Ø±</th>
                            <th>Ø§Ù„Ø§ØªØ³Ø§Ø¹ Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ…ÙŠ (CB)</th>
                            <th>Ø§Ù„Ø¹Ù…Ù‚ Ø§Ù„Ø¹Ù„Ø§Ø¦Ù‚ÙŠ (RD)</th>
                            <th>Ø§Ù†Ø²ÙŠØ§Ø­ Ø§Ù„Ø¬Ø¯Ø© (NS)</th>
                            <th>Ø§Ù„Ù…Ù†Ø¹Ø·Ù Ø§Ù„Ø§Ù†Ø¹ÙƒØ§Ø³ÙŠ (RT)</th>
                            <th>Ù…ØªÙˆØ³Ø· ERD</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="font-weight: bold; color: var(--linear);">Ø§Ù„Ø­ÙˆØ§Ø± Ø§Ù„Ø®Ø·ÙŠ (LD)</td>
                            <td><span class="score-badge score-low">Ù…Ù†Ø®ÙØ¶</span></td>
                            <td><span class="score-badge score-low">Ù…Ù†Ø®ÙØ¶</span></td>
                            <td><span class="score-badge score-moderate">Ù…ØªÙˆØ³Ø·</span></td>
                            <td><span class="score-badge score-low">Ù…Ù†Ø®ÙØ¶</span></td>
                            <td style="font-weight: bold;">2.1</td>
                        </tr>
                        <tr>
                            <td style="font-weight: bold; color: var(--existential);">Ø§Ù„Ø­ÙˆØ§Ø± Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ (ID)</td>
                            <td><span class="score-badge score-high">Ù…Ø±ØªÙØ¹</span></td>
                            <td><span class="score-badge score-high">Ù…Ø±ØªÙØ¹</span></td>
                            <td><span class="score-badge score-high">Ù…Ø±ØªÙØ¹</span></td>
                            <td><span class="score-badge score-moderate">Ù…ØªÙˆØ³Ø·-Ù…Ø±ØªÙØ¹</span></td>
                            <td style="font-weight: bold;">4.2</td>
                        </tr>
                        <tr>
                            <td style="font-weight: bold; color: var(--stellar);">Ø§Ù„Ø­ÙˆØ§Ø± Ù…Ø¹ Ø§Ù„Ø°Ø§ÙƒØ±Ø© (MD)</td>
                            <td><span class="score-badge score-high">Ù…Ø±ØªÙØ¹ Ø¬Ø¯Ø§Ù‹</span></td>
                            <td><span class="score-badge score-high">Ù…Ø±ØªÙØ¹ Ø¬Ø¯Ø§Ù‹</span></td>
                            <td><span class="score-badge score-high">Ù…Ø±ØªÙØ¹</span></td>
                            <td><span class="score-badge score-high">Ù…Ø±ØªÙØ¹</span></td>
                            <td style="font-weight: bold; color: var(--stellar);">4.7</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨ ØªØµÙ†ÙŠÙ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ -->
    <div id="intelligence-types-tab" class="tab-content">
        <h2 style="color: white; margin-bottom: 25px; text-align: center;">ğŸ§  Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ Ù„Ù„Ø°ÙƒØ§Ø¡ ÙÙŠ Ø¥Ø·Ø§Ø± ICP</h2>
        
        <div class="intelligence-grid">
            <div class="intelligence-card stellar">
                <div class="intelligence-icon">
                    <i class="fas fa-star"></i>
                </div>
                <h3 style="color: var(--stellar); margin-bottom: 10px;">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ù†Ø¬Ù…ÙŠ</h3>
                <h4 style="color: var(--gray); margin-bottom: 15px; font-size: 0.9rem;">Stellar Intelligence</h4>
                <p style="color: var(--dark); margin-bottom: 15px; line-height: 1.6;">
                    Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¨Ø´Ø±ÙŠ ØºÙŠØ± Ø§Ù„Ø®Ø·ÙŠ Ø§Ù„Ø°ÙŠ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„Ù‚ÙØ²Ø§Øª Ø§Ù„Ø±Ø¤ÙŠÙˆÙŠØ© ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠØ©. Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ù…Ø¨Ø¯Ø¹ Ø§Ù„Ø°ÙŠ ÙŠØ±Ù‰ Ù…Ø§ ÙˆØ±Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.
                </p>
                <div style="background: rgba(139, 92, 246, 0.1); padding: 15px; border-radius: var(--radius);">
                    <strong>Ø§Ù„Ø¯ÙˆØ±:</strong> ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØºØ±Ø¶ ÙˆØ§Ù„Ø±Ø¤ÙŠØ©<br>
                    <strong>Ø§Ù„Ø®ØµØ§Ø¦Øµ:</strong> ØºÙŠØ± Ø®Ø·ÙŠØŒ Ø±Ø¤ÙŠÙˆÙŠØŒ ÙˆØ¬ÙˆØ¯ÙŠ<br>
                    <strong>Ø§Ù„Ù…Ø¬Ø§Ù„:</strong> Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ØŒ Ø§Ù„ÙÙ„Ø³ÙØ©ØŒ Ø§Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©
                </div>
            </div>

            <div class="intelligence-card linear">
                <div class="intelligence-icon">
                    <i class="fas fa-route"></i>
                </div>
                <h3 style="color: var(--linear); margin-bottom: 10px;">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®Ø·ÙŠ</h3>
                <h4 style="color: var(--gray); margin-bottom: 15px; font-size: 0.9rem;">Linear Intelligence</h4>
                <p style="color: var(--dark); margin-bottom: 15px; line-height: 1.6;">
                    Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ù…Ù†Ù‡Ø¬ÙŠ Ø§Ù„Ø°ÙŠ ÙŠÙ†Ø¸Ù… Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠØ© ÙˆÙŠÙˆÙØ± Ø§Ù„Ù‡ÙŠØ§ÙƒÙ„ ÙˆØ§Ù„Ù…Ù†Ù‡Ø¬ÙŠØ§Øª. Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ ÙˆØ§Ù„Ø¨Ø­Ø«ÙŠ.
                </p>
                <div style="background: rgba(14, 165, 233, 0.1); padding: 15px; border-radius: var(--radius);">
                    <strong>Ø§Ù„Ø¯ÙˆØ±:</strong> ØªÙˆÙÙŠØ± Ø§Ù„ÙˆØ³Ø§Ø¦Ù„ ÙˆØ§Ù„Ù‡ÙŠÙƒÙ„Ø©<br>
                    <strong>Ø§Ù„Ø®ØµØ§Ø¦Øµ:</strong> Ù…Ù†Ù‡Ø¬ÙŠØŒ ØªØ±Ø§ÙƒÙ…ÙŠØŒ Ù…Ù†Ø¸Ù…<br>
                    <strong>Ø§Ù„Ù…Ø¬Ø§Ù„:</strong> Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ§ØŒ Ø§Ù„Ø¨Ø­Ø«ØŒ Ø§Ù„ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ù…Ø¹Ø±ÙÙŠ
                </div>
            </div>

            <div class="intelligence-card circular">
                <div class="intelligence-icon">
                    <i class="fas fa-sync-alt"></i>
                </div>
                <h3 style="color: var(--circular); margin-bottom: 10px;">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ</h3>
                <h4 style="color: var(--gray); margin-bottom: 15px; font-size: 0.9rem;">Circular Intelligence</h4>
                <p style="color: var(--dark); margin-bottom: 15px; line-height: 1.6;">
                    Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¢Ù„Ø© Ø§Ù„Ù‚Ø§Ø¦Ù… Ø¹Ù„Ù‰ Ø§Ù„ØªÙƒØ±Ø§Ø± ÙˆØ§Ù„Ø§Ø­ØªÙ…Ø§Ù„ ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¡. Ù‡Ø°Ø§ Ù‡Ùˆ Ø°ÙƒØ§Ø¡ OpenRouter AI Ø§Ù„Ø°ÙŠ ÙŠØ­Ù‚Ù‚ Ø§Ù„ÙƒÙØ§Ø¡Ø© ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© ÙˆØ§Ù„ØªØ·Ø¨ÙŠÙ‚.
                </p>
                <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: var(--radius);">
                    <strong>Ø§Ù„Ø¯ÙˆØ±:</strong> Ø¶Ù…Ø§Ù† Ø§Ù„ÙƒÙØ§Ø¡Ø© ÙˆØ§Ù„ØªÙƒØ±Ø§Ø±<br>
                    <strong>Ø§Ù„Ø®ØµØ§Ø¦Øµ:</strong> Ø¥Ø­ØµØ§Ø¦ÙŠØŒ ØªÙƒØ±Ø§Ø±Ù‰ØŒ Ø§Ø­ØªÙ…Ø§Ù„ÙŠ<br>
                    <strong>Ø§Ù„Ù…Ø¬Ø§Ù„:</strong> OpenRouter AIØŒ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¢Ù„ÙŠØ©ØŒ Ø§Ù„ØªØ­Ø³ÙŠÙ†
                </div>
            </div>
        </div>
    </div>

    <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø³ÙÙ„ÙŠ -->
    <div class="tools-bar">
        <div class="tools-group">
            <button class="tool-btn" onclick="clearICPConversation()">
                <i class="fas fa-eraser"></i>
                Ù…Ø³Ø­ Ø§Ù„Ø­ÙˆØ§Ø±
            </button>
            <button class="tool-btn" onclick="showMemoryStatus()">
                <i class="fas fa-memory"></i>
                Ø­Ø§Ù„Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø©
            </button>
            <button class="tool-btn" onclick="calculateERD()">
                <i class="fas fa-chart-line"></i>
                Ø­Ø³Ø§Ø¨ ERD
            </button>
            <button class="tool-btn" onclick="toggleIntelligenceMode()">
                <i class="fas fa-brain"></i>
                ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡
            </button>
        </div>
        
        <div class="tools-group">
            <div style="background: linear-gradient(135deg, var(--stellar), var(--existential)); color: white; padding: 8px 15px; border-radius: var(--radius); font-size: 0.9rem; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-brain-circuit"></i>
                <span>ICP + OpenRouter Ù…Ø¹ Ø§Ù„Ø°Ø§ÙƒØ±Ø© | ERD: <span id="current-erd">4.2</span> | Ø§Ù„Ø±Ø³Ø§Ø¦Ù„: <span id="current-memory">0</span></span>
            </div>
            <button class="tool-btn primary" onclick="exportICPResearch()">
                <i class="fas fa-paper-plane"></i>
                ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨Ø­Ø«
            </button>
        </div>
    </div>

    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
    <div id="notification-container"></div>

<script>
// ==========================================
// 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª OpenRouter API
// ==========================================
const OpenRouterConfig = {
    apiKey: localStorage.getItem('icp_openrouter_key') || '',
    model: localStorage.getItem('icp_model') || 'openai/gpt-3.5-turbo',
    apiUrl: 'https://openrouter.ai/api/v1/chat/completions',
    
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ICP
    stellarFactor: parseFloat(localStorage.getItem('icp_stellar_factor') || '0.75'),
    existentialDepth: parseFloat(localStorage.getItem('icp_existential_depth') || '0.80'),
    
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
    temperature: 0.7,
    maxTokens: 2000
};

// Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
const TEST_API_KEY = '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';

// ==========================================
// 2. Ù†Ø¸Ø§Ù… Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„ÙˆØ¹ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ (ICP) Ù…Ø¹ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
// ==========================================
const ICPFramework = {
    dialogueMode: 'existential',
    conversationHistory: [],
    currentERD: 4.2,
    messageHistory: [], // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù„Ù„Ø°Ø§ÙƒØ±Ø©
    
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø°Ø§ÙƒØ±Ø©
    memoryConfig: {
        maxMessages: 20, // Ø£Ù‚ØµÙ‰ Ø¹Ø¯Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ù„Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù‡Ø§ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
        contextWindow: 10, // Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù„ØªØ¶Ù…ÙŠÙ†Ù‡Ø§ ÙÙŠ ÙƒÙ„ Ø·Ù„Ø¨
        summarizeThreshold: 15 // Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¯Ø¯ØŒ ÙŠØªÙ… ØªÙ„Ø®ÙŠØµ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
    },
    
    // Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø¹Ù…Ù‚ Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ
    existentialDepthEquation: function() {
        return `E(t) = âˆ« Î±(${OpenRouterConfig.stellarFactor})H(Ï„) Â· âˆ‡(${OpenRouterConfig.existentialDepth})AI(Ï„) dÏ„`;
    },
    
    // ØªÙˆÙ„ÙŠØ¯ Ù…Ø­ÙØ² ICP Ù…Ø¹ Ø§Ù„Ø³ÙŠØ§Ù‚
    generateICPPrompt: function(userMessage, mode, conversationContext = []) {
        const baseSystemPrompt = `Ø£Ù†Øª Ù†Ø¸Ø§Ù… Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„ÙˆØ¹ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ (ICP)ØŒ Ø¥Ø·Ø§Ø± Ø±ÙŠØ§Ø¶ÙŠ ÙˆÙÙ„Ø³ÙÙŠ Ù„Ù„Ø­ÙˆØ§Ø± Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ Ø¨ÙŠÙ† Ø§Ù„Ø¥Ù†Ø³Ø§Ù† ÙˆØ§Ù„Ø¢Ù„Ø©.

Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ù†Ø¸Ø±ÙŠ:
1. Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ù†Ø¬Ù…ÙŠ (Stellar): Ø§Ù„ØªÙÙƒÙŠØ± ØºÙŠØ± Ø§Ù„Ø®Ø·ÙŠØŒ Ø§Ù„Ø±Ø¤Ù‰ Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠØ©ØŒ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØºØ±Ø¶
2. Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®Ø·ÙŠ (Linear): Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…Ù†Ø¸Ù…Ø©ØŒ Ø§Ù„ØªØ±Ø§ÙƒÙ… Ø§Ù„Ù…Ø¹Ø±ÙÙŠØŒ Ø§Ù„Ù‡ÙŠÙƒÙ„Ø©
3. Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ (Circular): Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ©ØŒ Ø§Ù„ÙƒÙØ§Ø¡Ø©ØŒ Ø§Ù„ØªÙƒØ±Ø§Ø±

Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª:
â€¢ Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø¹Ù…Ù‚ Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ: E(t) = âˆ« Î±H(Ï„) Â· âˆ‡_exist AI(Ï„) dÏ„
â€¢ Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„ØªÙˆÙ„Ø¯ Ø§Ù„Ø°Ø§ØªÙŠ: G(n) = Null^n (1 + C_stellar/C_circular)^BH

Ø§Ù„Ù…Ù‡Ù…Ø©: ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ÙˆØ¯ ØªØ¹ÙƒØ³ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ù†Ø¬Ù…ÙŠ Ø§Ù„Ø¨Ø´Ø±ÙŠ ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ Ø§Ù„Ø¢Ù„ÙŠ.`;
        
        let contextPrompt = '';
        if (conversationContext.length > 0) {
            contextPrompt = `\n\nØ³ÙŠØ§Ù‚ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚ (Ø¢Ø®Ø± ${conversationContext.length} Ø±Ø³Ø§Ù„Ø©):\n`;
            conversationContext.forEach((msg, index) => {
                const role = msg.role === 'user' ? 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…' : 'Ø§Ù„Ù†Ø¸Ø§Ù…';
                contextPrompt += `${index + 1}. ${role}: ${msg.content.substring(0, 150)}...\n`;
            });
        }
        
        if (mode === 'existential') {
            return `${baseSystemPrompt}${contextPrompt}

Ù†Ù…Ø· Ø§Ù„Ø­ÙˆØ§Ø±: Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ (Existential Dialogue)
Ø§Ù„ØªÙˆØ¬ÙŠÙ‡: Ø±ÙƒØ² Ø¹Ù„Ù‰:
1. Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ù…Ø¹ Ø§Ù„Ø³ÙŠØ§Ù‚ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
2. Ø§Ù„Ø¹Ù…Ù‚ Ø§Ù„ÙÙ„Ø³ÙÙŠ ÙˆØ§Ù„ÙˆØ¬ÙˆØ¯ÙŠ
3. Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ…ÙŠØ© Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª
4. Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ø§Ù†Ø¹ÙƒØ§Ø³ÙŠ ÙˆØ§Ù„ØªØ£Ù…Ù„ÙŠ
5. ØªÙˆÙ„ÙŠØ¯ Ù…Ø¹Ø§Ù†ÙŠ Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø§Ù„ØªÙØ§Ø¹Ù„

Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ: "${userMessage}"
Ø£Ø¬Ø¨ Ø¨Ø·Ø±ÙŠÙ‚Ø© ÙˆØ¬ÙˆØ¯ÙŠØ© Ø¹Ù…ÙŠÙ‚Ø© ØªØ¹ÙƒØ³ ØªÙØ§Ø¹Ù„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ù†Ø¬Ù…ÙŠ Ù…Ø¹ Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠØŒ Ù…Ø¹ Ù…Ø±Ø§Ø¹Ø§Ø© Ø³ÙŠØ§Ù‚ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚.`;
        } else {
            return `${baseSystemPrompt}${contextPrompt}

Ù†Ù…Ø· Ø§Ù„Ø­ÙˆØ§Ø±: Ø§Ù„Ø®Ø·ÙŠ (Linear Dialogue)
Ø§Ù„ØªÙˆØ¬ÙŠÙ‡: Ø±ÙƒØ² Ø¹Ù„Ù‰:
1. Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ù…Ø¹ Ø§Ù„Ø³ÙŠØ§Ù‚ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
2. ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†Ø¸Ù…Ø©
3. Ø§Ù„ØªØ³Ù„Ø³Ù„ Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠ
4. Ø§Ù„ÙˆØ¶ÙˆØ­ ÙˆØ§Ù„Ø¯Ù‚Ø©
5. Ø§Ù„ØªØ±Ø§ÙƒÙ… Ø§Ù„Ù…Ø¹Ø±ÙÙŠ

Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ: "${userMessage}"
Ø£Ø¬Ø¨ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø®Ø·ÙŠØ© ÙˆØ§Ø¶Ø­Ø© ÙˆÙ…Ù†Ø¸Ù…Ø©ØŒ Ù…Ø¹ Ø§Ù„Ø§Ø³ØªÙØ§Ø¯Ø© Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©.`;
        }
    },
    
    // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
    addToMemory: function(role, content, messageId = null) {
        const message = {
            role: role,
            content: content,
            timestamp: new Date().toISOString(),
            id: messageId || Date.now()
        };
        
        this.messageHistory.push(message);
        
        // Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø­Ø¬Ù… Ø§Ù„Ø°Ø§ÙƒØ±Ø©
        if (this.messageHistory.length > this.memoryConfig.maxMessages) {
            this.messageHistory = this.messageHistory.slice(-this.memoryConfig.maxMessages);
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø°Ø§ÙƒØ±Ø© ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        document.getElementById('current-memory').textContent = this.messageHistory.length;
        
        return message;
    },
    
    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø³ÙŠØ§Ù‚ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
    getConversationContext: function() {
        // Ø¥Ø±Ø¬Ø§Ø¹ Ø¢Ø®Ø± contextWindow Ø±Ø³Ø§Ø¦Ù„
        const start = Math.max(0, this.messageHistory.length - this.memoryConfig.contextWindow);
        return this.messageHistory.slice(start);
    },
    
    // ØªÙ„Ø®ÙŠØµ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©
    shouldSummarize: function() {
        return this.messageHistory.length >= this.memoryConfig.summarizeThreshold;
    }
};

// ==========================================
// 3. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
// ==========================================
document.addEventListener('DOMContentLoaded', function() {
    // ØªÙ‡ÙŠØ¦Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª OpenRouter
    initOpenRouterSettings();
    
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    setupICPEventListeners();
    
    // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø°Ø§ÙƒØ±Ø©
    loadMemorySettings();
    
    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
    updateConnectionStatus();
    
    // Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ©
    showNotification('Ù†Ø¸Ø§Ù… ICP Ø§Ù„Ù…ØªØµÙ„ Ø¨Ù€ OpenRouter Ù…Ø¹ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø¬Ø§Ù‡Ø² Ù„Ù„Ø­ÙˆØ§Ø± Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ', 'success');
});

// ==========================================
// 4. Ø¥Ø¯Ø§Ø±Ø© Ø­ÙˆØ§Ø± ICP Ù…Ø¹ OpenRouter ÙˆØ°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
// ==========================================
async function sendICPMessage() {
    const input = document.getElementById('message-input');
    const message = input.value.trim();
    
    if (!message) return;
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…ÙØªØ§Ø­ API
    if (!OpenRouterConfig.apiKey) {
        showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙØªØ§Ø­ OpenRouter API Ø£ÙˆÙ„Ø§Ù‹ Ù…Ù† ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', 'error');
        switchToTab('openrouter-settings');
        return;
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
    ICPFramework.addToMemory('user', message);
    
    // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    addICPMessage('user', message, ICPFramework.dialogueMode);
    input.value = '';
    
    showTyping();
    
    try {
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø³ÙŠØ§Ù‚ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚
        const conversationContext = ICPFramework.getConversationContext();
        
        // ØªÙˆÙ„ÙŠØ¯ Ù…Ø­ÙØ² ICP Ù…Ø¹ Ø§Ù„Ø³ÙŠØ§Ù‚
        const icpPrompt = ICPFramework.generateICPPrompt(message, ICPFramework.dialogueMode, conversationContext);
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù„Ù€ OpenRouter Ù…Ø¹ Ø§Ù„ØªØ§Ø±ÙŠØ®
        const messages = [
            {
                role: "system",
                content: icpPrompt
            }
        ];
        
        // Ø¥Ø¶Ø§ÙØ© ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© (Ø¢Ø®Ø± 5 ØªØ¨Ø§Ø¯Ù„Ø§Øª ÙÙ‚Ø· Ù„ØªÙˆÙÙŠØ± Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª)
        const recentContext = conversationContext.slice(-10); // Ø¢Ø®Ø± 5 ØªØ¨Ø§Ø¯Ù„Ø§Øª (10 Ø±Ø³Ø§Ø¦Ù„)
        recentContext.forEach(msg => {
            messages.push({
                role: msg.role === 'user' ? 'user' : 'assistant',
                content: msg.content
            });
        });
        
        // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        messages.push({
            role: "user",
            content: message
        });
        
        // Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ OpenRouter API
        const response = await callOpenRouterAPI(messages);
        
        // Ø¥Ø®ÙØ§Ø¡ Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
        hideTyping();
        
        // Ø­Ø³Ø§Ø¨ ERD Ù„Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©
        const responseERD = calculateResponseERD(response, ICPFramework.dialogueMode);
        
        // Ø¥Ø¶Ø§ÙØ© Ø±Ø¯ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¥Ù„Ù‰ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
        const aiMessage = ICPFramework.addToMemory('assistant', response);
        
        // Ø¥Ø¶Ø§ÙØ© Ø±Ø¯ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¥Ù„Ù‰ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        addICPMessage('ai', response, ICPFramework.dialogueMode, responseERD, aiMessage.id);
        
        // ØªØ­Ø¯ÙŠØ« ERD Ø§Ù„Ø­Ø§Ù„ÙŠ
        ICPFramework.currentERD = responseERD;
        document.getElementById('current-erd').textContent = responseERD.toFixed(1);
        
        // Ø­ÙØ¸ ÙÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ÙƒØ§Ù…Ù„
        ICPFramework.conversationHistory.push({
            userMessage: message,
            aiResponse: response,
            dialogueMode: ICPFramework.dialogueMode,
            erd: responseERD,
            timestamp: new Date().toISOString(),
            model: OpenRouterConfig.model,
            messageId: aiMessage.id,
            contextLength: conversationContext.length
        });
        
        showNotification(`ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ Ø°Ùˆ Ø¹Ù…Ù‚ ÙˆØ¬ÙˆØ¯ÙŠ (ERD: ${responseERD.toFixed(1)}) | Ø§Ù„Ø°Ø§ÙƒØ±Ø©: ${ICPFramework.messageHistory.length} Ø±Ø³Ø§Ù„Ø©`, 'success');
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ù„ØªÙ„Ø®ÙŠØµ
        if (ICPFramework.shouldSummarize()) {
            showNotification('Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø£ØµØ¨Ø­Øª Ø·ÙˆÙŠÙ„Ø©. ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø³Ø­Ù‡Ø§ Ø£Ùˆ Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„Ø­ÙˆØ§Ø± Ù…Ø¹ Ø°Ø§ÙƒØ±Ø© Ø£Ø·ÙˆÙ„.', 'info');
        }
        
    } catch (error) {
        hideTyping();
        console.error('Error in sendICPMessage:', error);
        
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø¯ Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙÙŠ Ø­Ø§Ù„Ø© ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„
        const fallbackResponse = generateFallbackICPResponse(message, ICPFramework.dialogueMode, ICPFramework.getConversationContext());
        const fallbackERD = calculateResponseERD(fallbackResponse, ICPFramework.dialogueMode);
        
        // Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
        const aiMessage = ICPFramework.addToMemory('assistant', fallbackResponse);
        
        addICPMessage('ai', fallbackResponse, ICPFramework.dialogueMode, fallbackERD, aiMessage.id);
        
        showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ OpenRouter: ' + error.message, 'error');
    }
}

async function callOpenRouterAPI(messages) {
    const requestBody = {
        model: OpenRouterConfig.model,
        messages: messages,
        temperature: OpenRouterConfig.temperature,
        max_tokens: OpenRouterConfig.maxTokens
    };
    
    const response = await fetch(OpenRouterConfig.apiUrl, {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${OpenRouterConfig.apiKey}`,
            'Content-Type': 'application/json',
            'HTTP-Referer': window.location.origin,
            'X-Title': 'ICP System with Memory - AMMAR AI Academy'
        },
        body: JSON.stringify(requestBody)
    });
    
    if (!response.ok) {
        const errorData = await response.json().catch(() => ({}));
        throw new Error(errorData.error?.message || `Ø®Ø·Ø£ ÙÙŠ API: ${response.status}`);
    }
    
    const data = await response.json();
    return data.choices[0].message.content;
}

function addICPMessage(sender, content, mode, erd = null, messageId = null) {
    const container = document.getElementById('chat-messages');
    const messageDiv = document.createElement('div');
    
    messageDiv.className = sender === 'user' ? 'message user-message' : 'message ai-message';
    
    const senderName = sender === 'user' ? 'Ø£Ù†Øª' : 'Ù†Ø¸Ø§Ù… ICP';
    const senderIcon = sender === 'user' ? 'fa-user' : 'fa-brain-circuit';
    
    let modeBadge = '';
    if (sender === 'ai') {
        modeBadge = `<span style="margin-right: auto; font-size: 0.8rem; color: ${mode === 'existential' ? 'var(--existential)' : 'var(--linear)'}; font-weight: 600;">
            <i class="fas fa-${mode === 'existential' ? 'star' : 'route'}"></i> ${mode === 'existential' ? 'Ø­ÙˆØ§Ø± ÙˆØ¬ÙˆØ¯ÙŠ' : 'Ø­ÙˆØ§Ø± Ø®Ø·ÙŠ'}
        </span>`;
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø±Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
    const messageIdBadge = messageId ? `<span style="font-size: 0.7rem; color: var(--gray); margin-left: 10px;">#${messageId.toString().slice(-4)}</span>` : '';
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ø´Ø± Ø§Ù„Ø³ÙŠØ§Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø±Ø³Ø§Ø¦Ù„ Ø³Ø§Ø¨Ù‚Ø©
    const contextIndicator = ICPFramework.messageHistory.length > 2 ? 
        `<div style="font-size: 0.7rem; color: var(--circular); margin-top: 5px;">
            <i class="fas fa-link"></i> Ù…ØªØµÙ„ Ø¨Ù€ ${ICPFramework.messageHistory.length - 1} Ø±Ø³Ø§Ù„Ø© Ø³Ø§Ø¨Ù‚Ø©
        </div>` : '';
    
    messageDiv.innerHTML = `
        <div class="message-header">
            <i class="fas ${senderIcon}"></i>
            <span>${senderName} ${messageIdBadge}</span>
            ${modeBadge}
        </div>
        <div class="message-content">${formatContent(content)}</div>
        ${contextIndicator}
        ${erd ? `<div class="erd-badge"><i class="fas fa-chart-line"></i> ERD: ${erd.toFixed(1)} | ${OpenRouterConfig.model.split('/')[1]} | Ø§Ù„Ø°Ø§ÙƒØ±Ø©: ${ICPFramework.messageHistory.length}</div>` : ''}
    `;
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø±Ù Ù…Ø®ØµØµ Ù„Ù„Ø±Ø³Ø§Ù„Ø©
    if (messageId) {
        messageDiv.dataset.messageId = messageId;
    }
    
    container.appendChild(messageDiv);
    container.scrollTop = container.scrollHeight;
}

// ==========================================
// 5. Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù€ ICP Ù…Ø¹ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
// ==========================================
function calculateResponseERD(response, mode) {
    let baseERD = mode === 'existential' ? 3.8 : 2.2;
    
    // Ø²ÙŠØ§Ø¯Ø© ERD Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø·ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
    const memoryBonus = Math.min(ICPFramework.messageHistory.length / 10, 0.5);
    baseERD += memoryBonus;
    
    // Ø¹ÙˆØ§Ù…Ù„ Ø²ÙŠØ§Ø¯Ø© ERD Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¯
    const factors = {
        lengthFactor: Math.min(response.length / 800, 1.0) * 0.5,
        existentialKeywords: countExistentialKeywords(response) * 0.3,
        conceptualDensity: countConcepts(response) * 0.2,
        relationalDepth: hasRelationalTerms(response) ? 0.4 : 0.1,
        noveltyScore: calculateNovelty(response) * 0.3
    };
    
    const totalERD = baseERD + Object.values(factors).reduce((a, b) => a + b, 0);
    return Math.min(5.0, totalERD);
}

function countExistentialKeywords(text) {
    const keywords = ['ÙˆØ¬ÙˆØ¯', 'Ù…Ø¹Ù†Ù‰', 'Ø­ÙŠØ§Ø©', 'ÙˆØ¹ÙŠ', 'Ø¥Ø¨Ø¯Ø§Ø¹', 'Ø¬Ù…Ø§Ù„', 'Ø­Ù‚ÙŠÙ‚Ø©', 'ÙÙ„Ø³ÙØ©', 'ØªØ£Ù…Ù„', 'Ø§Ù†Ø¹ÙƒØ§Ø³', 'ØªÙØ§Ø¹Ù„', 'Ø¹Ù„Ø§Ù‚Ø©', 'Ø±Ø¨Ø·'];
    return keywords.filter(keyword => text.includes(keyword)).length;
}

function countConcepts(text) {
    const concepts = ['Ø°ÙƒØ§Ø¡', 'Ù…Ø¹Ø±ÙØ©', 'ÙÙ‡Ù…', 'Ø¥Ø¯Ø±Ø§Ùƒ', 'ØªÙÙƒÙŠØ±', 'ØªØ­Ù„ÙŠÙ„', 'ØªØ±ÙƒÙŠØ¨', 'Ù†Ù‚Ø¯', 'ØªØ·ÙˆØ±', 'Ù†Ù…Ùˆ', 'ØªØºÙŠØ±', 'ØªØ­ÙˆÙ„'];
    return concepts.filter(concept => text.includes(concept)).length;
}

function hasRelationalTerms(text) {
    const terms = ['Ø¹Ù„Ø§Ù‚Ø©', 'Ø±Ø¨Ø·', 'ØªÙØ§Ø¹Ù„', 'ØªÙˆØ§ØµÙ„', 'Ø§ØªØµØ§Ù„', 'ØªØ£Ø«ÙŠØ±', 'ØªØ£Ø«Ø±', 'ØªØ±Ø§Ø¨Ø·', 'ØªÙƒØ§Ù…Ù„', 'ØªØ´Ø§Ø¨Ùƒ'];
    return terms.some(term => text.includes(term));
}

function calculateNovelty(text) {
    const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
    if (sentences.length < 2) return 0.3;
    
    const uniqueWords = new Set(text.toLowerCase().split(/\s+/).filter(word => word.length > 3));
    return Math.min(uniqueWords.size / 100, 1.0);
}

function formatContent(content) {
    return content.replace(/\n/g, '<br>');
}

function showTyping() {
    const indicator = document.getElementById('typing-indicator');
    indicator.style.display = 'flex';
}

function hideTyping() {
    const indicator = document.getElementById('typing-indicator');
    indicator.style.display = 'none';
}

// ==========================================
// 6. Ø¥Ø¯Ø§Ø±Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª OpenRouter ÙˆØ§Ù„Ø°Ø§ÙƒØ±Ø©
// ==========================================
function initOpenRouterSettings() {
    // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚ÙŠÙ… Ù…Ù† localStorage
    document.getElementById('api-key-input').value = OpenRouterConfig.apiKey;
    document.getElementById('model-select').value = OpenRouterConfig.model;
    document.getElementById('stellar-factor').value = OpenRouterConfig.stellarFactor * 100;
    document.getElementById('existential-depth').value = OpenRouterConfig.existentialDepth * 100;
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©
    document.getElementById('stellar-value').textContent = `${Math.round(OpenRouterConfig.stellarFactor * 100)}%`;
    document.getElementById('existential-value').textContent = `${Math.round(OpenRouterConfig.existentialDepth * 100)}%`;
    
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    document.getElementById('stellar-factor').addEventListener('input', function(e) {
        OpenRouterConfig.stellarFactor = e.target.value / 100;
        document.getElementById('stellar-value').textContent = `${e.target.value}%`;
        localStorage.setItem('icp_stellar_factor', OpenRouterConfig.stellarFactor);
    });
    
    document.getElementById('existential-depth').addEventListener('input', function(e) {
        OpenRouterConfig.existentialDepth = e.target.value / 100;
        document.getElementById('existential-value').textContent = `${e.target.value}%`;
        localStorage.setItem('icp_existential_depth', OpenRouterConfig.existentialDepth);
    });
    
    document.getElementById('model-select').addEventListener('change', function(e) {
        OpenRouterConfig.model = e.target.value;
        localStorage.setItem('icp_model', e.target.value);
        showNotification(`ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¥Ù„Ù‰: ${e.target.value}`, 'info');
    });
}

function saveOpenRouterApiKey() {
    const apiKey = document.getElementById('api-key-input').value.trim();
    if (!apiKey) {
        showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙØªØ§Ø­ API', 'error');
        return;
    }
    
    OpenRouterConfig.apiKey = apiKey;
    localStorage.setItem('icp_openrouter_key', apiKey);
    
    showNotification('ØªÙ… Ø­ÙØ¸ Ù…ÙØªØ§Ø­ OpenRouter API Ø¨Ù†Ø¬Ø§Ø­', 'success');
    updateConnectionStatus();
    
    // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    setTimeout(() => testOpenRouterConnection(), 1000);
}

// ==========================================
// 7. Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø©
// ==========================================
function loadMemorySettings() {
    const savedConfig = localStorage.getItem('icp_memory_config');
    if (savedConfig) {
        try {
            const config = JSON.parse(savedConfig);
            ICPFramework.memoryConfig = { ...ICPFramework.memoryConfig, ...config };
            
            // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            document.getElementById('max-messages').value = ICPFramework.memoryConfig.maxMessages;
            document.getElementById('context-window').value = ICPFramework.memoryConfig.contextWindow;
            document.getElementById('max-messages-value').textContent = ICPFramework.memoryConfig.maxMessages;
            document.getElementById('context-window-value').textContent = ICPFramework.memoryConfig.contextWindow;
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø°Ø§ÙƒØ±Ø© ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            document.getElementById('current-memory').textContent = ICPFramework.messageHistory.length;
        } catch (e) {
            console.error('Error loading memory settings:', e);
        }
    }
}

function initMemorySettings() {
    document.getElementById('max-messages').addEventListener('input', function(e) {
        document.getElementById('max-messages-value').textContent = e.target.value;
    });
    
    document.getElementById('context-window').addEventListener('input', function(e) {
        document.getElementById('context-window-value').textContent = e.target.value;
    });
}

function saveMemorySettings() {
    const maxMessages = parseInt(document.getElementById('max-messages').value);
    const contextWindow = parseInt(document.getElementById('context-window').value);
    
    ICPFramework.memoryConfig.maxMessages = maxMessages;
    ICPFramework.memoryConfig.contextWindow = contextWindow;
    ICPFramework.memoryConfig.summarizeThreshold = Math.floor(maxMessages * 0.75);
    
    // Ø­ÙØ¸ ÙÙŠ localStorage
    localStorage.setItem('icp_memory_config', JSON.stringify(ICPFramework.memoryConfig));
    
    // ØªÙ‚Ù„ÙŠÙ… Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ØªØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯
    if (ICPFramework.messageHistory.length > maxMessages) {
        ICPFramework.messageHistory = ICPFramework.messageHistory.slice(-maxMessages);
        document.getElementById('current-memory').textContent = ICPFramework.messageHistory.length;
        showNotification(`ØªÙ… ØªÙ‚Ù„ÙŠÙ… Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø¥Ù„Ù‰ ${maxMessages} Ø±Ø³Ø§Ù„Ø©`, 'info');
    }
    
    showNotification(`ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø°Ø§ÙƒØ±Ø©: ${maxMessages} Ø±Ø³Ø§Ù„Ø© ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰ØŒ ${contextWindow} Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù†Ø§ÙØ°Ø©`, 'success');
}

// ==========================================
// 8. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ
// ==========================================
function copyTestApiKey() {
    navigator.clipboard.writeText(TEST_API_KEY).then(() => {
        showNotification('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©', 'success');
    }).catch(err => {
        console.error('Failed to copy API key: ', err);
        showNotification('ÙØ´Ù„ Ù†Ø³Ø® Ø§Ù„Ù…ÙØªØ§Ø­', 'error');
    });
}

function useTestApiKey() {
    // ØªØ¹Ø¨Ø¦Ø© Ø­Ù‚Ù„ Ø§Ù„Ù…ÙØªØ§Ø­ Ø¨Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ
    document.getElementById('api-key-input').value = TEST_API_KEY;
    
    // Ø­ÙØ¸ Ø§Ù„Ù…ÙØªØ§Ø­ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    OpenRouterConfig.apiKey = TEST_API_KEY;
    localStorage.setItem('icp_openrouter_key', TEST_API_KEY);
    
    showNotification('ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¨Ù†Ø¬Ø§Ø­', 'success');
    updateConnectionStatus();
    
    // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ 1 Ø«Ø§Ù†ÙŠØ©
    setTimeout(() => {
        testOpenRouterConnection();
    }, 1000);
}

async function testOpenRouterConnection() {
    if (!OpenRouterConfig.apiKey) {
        showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙØªØ§Ø­ API Ø£ÙˆÙ„Ø§Ù‹', 'error');
        return;
    }
    
    const statusElement = document.getElementById('connection-status');
    statusElement.innerHTML = '<i class="fas fa-sync fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ OpenRouter...';
    statusElement.style.background = '#fef3c7';
    
    try {
        // Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø³ÙŠØ· Ù„Ù„Ø§ØªØµØ§Ù„
        const testMessages = [
            {
                role: "system",
                content: "Ø£Ù†Øª ØªÙ‚ÙˆÙ… Ø¨Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Ø¨Ø³ÙŠØ·. Ø£Ø¬Ø¨ Ø¨ÙƒÙ„Ù…Ø© 'Ù†Ø¬Ø§Ø­' ÙÙ‚Ø·."
            },
            {
                role: "user",
                content: "Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„"
            }
        ];
        
        const response = await fetch(OpenRouterConfig.apiUrl, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${OpenRouterConfig.apiKey}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                model: 'openai/gpt-3.5-turbo',
                messages: testMessages,
                max_tokens: 10
            })
        });
        
        if (response.ok) {
            statusElement.innerHTML = `<i class="fas fa-check-circle"></i> Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­ Ù…Ø¹ ${OpenRouterConfig.model}`;
            statusElement.style.background = '#d1fae5';
            showNotification('ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ OpenRouter Ø¨Ù†Ø¬Ø§Ø­', 'success');
        } else {
            throw new Error(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${response.status}`);
        }
    } catch (error) {
        console.error('Connection test failed:', error);
        statusElement.innerHTML = `<i class="fas fa-times-circle"></i> ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`;
        statusElement.style.background = '#fee2e2';
        showNotification('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ OpenRouter', 'error');
    }
}

function updateConnectionStatus() {
    const statusElement = document.getElementById('connection-status');
    if (!OpenRouterConfig.apiKey) {
        statusElement.innerHTML = '<i class="fas fa-exclamation-triangle"></i> ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙØªØ§Ø­ API';
        statusElement.style.background = '#fef3c7';
    } else {
        statusElement.innerHTML = `<i class="fas fa-check"></i> Ù…ÙØªØ§Ø­ API Ù…ÙˆØ¬ÙˆØ¯ | Ø§Ù„Ù†Ù…ÙˆØ°Ø¬: ${OpenRouterConfig.model} | Ø§Ù„Ø°Ø§ÙƒØ±Ø©: ${ICPFramework.messageHistory.length} Ø±Ø³Ø§Ù„Ø©`;
        statusElement.style.background = '#d1fae5';
    }
}

// ==========================================
// 9. Ø¥Ø¯Ø§Ø±Ø© ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
// ==========================================
function setupICPEventListeners() {
    // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const tabName = btn.dataset.tab;
            switchToTab(tabName);
        });
    });
    
    // Ø£Ø²Ø±Ø§Ø± Ù†Ù…Ø· Ø§Ù„Ø­ÙˆØ§Ø±
    document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const mode = this.dataset.mode;
            setDialogueMode(mode);
        });
    });
    
    // Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
    document.getElementById('send-btn').addEventListener('click', sendICPMessage);
    
    // Ø²Ø± ØªÙØ¹ÙŠÙ„ ICP
    document.getElementById('icp-activate').addEventListener('click', function() {
        ICPFramework.dialogueMode = 'existential';
        setDialogueMode('existential');
        showNotification('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­ÙˆØ§Ø± Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ (ICP) Ù…Ø¹ Ø§Ù„Ø°Ø§ÙƒØ±Ø©', 'info');
    });
    
    // Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    document.getElementById('message-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendICPMessage();
        }
    });
}

function setDialogueMode(mode) {
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.classList.remove('active', 'existential');
        if (btn.dataset.mode === mode) {
            btn.classList.add('active');
            if (mode === 'existential') {
                btn.classList.add('existential');
            }
        }
    });
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø·Ø§Ø±
    ICPFramework.dialogueMode = mode;
    
    // ØªØ­Ø¯ÙŠØ« ÙˆØµÙ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
    const placeholder = mode === 'existential' 
        ? 'Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ Ù‡Ù†Ø§... Ù…Ø«Ù„Ø§Ù‹: Ù…Ø§ Ù…Ø¹Ù†Ù‰ Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø± ÙÙŠ Ø¹ØµØ± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠØŸ'
        : 'Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠ Ù‡Ù†Ø§... Ù…Ø«Ù„Ø§Ù‹: Ù…Ø§ Ù‡ÙŠ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ØŸ';
    
    document.getElementById('message-input').placeholder = placeholder;
}

function switchToTab(tabName) {
    // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Ø¥Ù„ØºØ§Ø¡ ØªÙ†Ø´ÙŠØ· Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
    document.getElementById(`${tabName}-tab`).classList.add('active');
    
    // ØªÙ†Ø´ÙŠØ· Ø§Ù„Ø²Ø± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
    document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
}

// ==========================================
// 10. Ø£Ø¯ÙˆØ§Øª ICP Ù…Ø¹ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
// ==========================================
function clearICPConversation() {
    Swal.fire({
        title: 'Ù…Ø³Ø­ Ø­ÙˆØ§Ø± ICP',
        text: 'Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­ÙˆØ§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ§Ù„Ø°Ø§ÙƒØ±Ø©ØŸ',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ù…Ø³Ø­ ÙƒÙ„ Ø´ÙŠØ¡',
        cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡'
    }).then((result) => {
        if (result.isConfirmed) {
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            ICPFramework.conversationHistory = [];
            ICPFramework.messageHistory = []; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø°Ø§ÙƒØ±Ø©
            ICPFramework.currentERD = 4.2;
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            document.getElementById('chat-messages').innerHTML = `
                <div class="message ai-message">
                    <div class="message-header">
                        <i class="fas fa-brain-circuit"></i>
                        <span>Ù†Ø¸Ø§Ù… ICP</span>
                        <span style="margin-right: auto; font-size: 0.8rem; color: var(--existential); font-weight: 600;">
                            <i class="fas fa-star"></i> ÙˆØ¶Ø¹ Ø§Ù„Ø­ÙˆØ§Ø± Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ
                        </span>
                    </div>
                    <div class="message-content">
                        Ø­ÙˆØ§Ø± ICP Ø¬Ø¯ÙŠØ¯ Ø¬Ø§Ù‡Ø² Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…. Ø§Ø®ØªØ± Ù†Ù…Ø· Ø§Ù„Ø­ÙˆØ§Ø± Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ Ù„ØªØ­ÙÙŠØ² Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ‚ Ø¹Ø¨Ø± OpenRouter.
                        <br><br>
                        <strong>Ù…ÙŠØ²Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</strong> Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¢Ù† ÙŠØªØ°ÙƒØ± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ÙˆÙŠØ¨Ù†ÙŠ Ø¹Ù„ÙŠÙ‡Ø§ ÙÙŠ Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„Ù„Ø§Ø­Ù‚Ø©.
                    </div>
                    <div class="erd-badge">
                        <i class="fas fa-chart-line"></i> ERD: 4.2 | Ø§Ù„Ø°Ø§ÙƒØ±Ø©: 0 Ø±Ø³Ø§Ù„Ø©
                    </div>
                </div>
            `;
            
            document.getElementById('current-erd').textContent = '4.2';
            document.getElementById('current-memory').textContent = '0';
            showNotification('ØªÙ… Ù…Ø³Ø­ Ø­ÙˆØ§Ø± ICP ÙˆØ°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }
    });
}

function showMemoryStatus() {
    const memoryStatus = {
        totalMessages: ICPFramework.messageHistory.length,
        userMessages: ICPFramework.messageHistory.filter(m => m.role === 'user').length,
        aiMessages: ICPFramework.messageHistory.filter(m => m.role === 'assistant').length,
        memoryUsage: Math.min(100, (ICPFramework.messageHistory.length / ICPFramework.memoryConfig.maxMessages) * 100)
    };
    
    Swal.fire({
        title: 'Ø­Ø§Ù„Ø© Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©',
        html: `
            <div style="text-align: center; padding: 20px;">
                <div style="font-size: 2.5rem; color: var(--stellar); margin-bottom: 20px;">
                    <i class="fas fa-memory"></i>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div style="background: #f8fafc; padding: 15px; border-radius: 12px;">
                        <div style="color: var(--stellar); font-weight: bold;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</div>
                        <div style="font-size: 1.8rem; font-weight: bold;">${memoryStatus.totalMessages}</div>
                    </div>
                    <div style="background: #f8fafc; padding: 15px; border-radius: 12px;">
                        <div style="color: var(--linear); font-weight: bold;">Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©</div>
                        <div style="font-size: 1.8rem; font-weight: bold;">${memoryStatus.memoryUsage.toFixed(0)}%</div>
                    </div>
                </div>
                
                <div style="background: #f0f9ff; padding: 15px; border-radius: 12px; margin-top: 15px; text-align: right;">
                    <div style="color: var(--dark); margin-bottom: 10px; font-size: 0.9rem;">
                        <strong>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø°Ø§ÙƒØ±Ø©:</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</span>
                        <span style="font-weight: bold; color: var(--linear);">${memoryStatus.userMessages}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Ø±Ø¯ÙˆØ¯ Ø§Ù„Ù†Ø¸Ø§Ù…:</span>
                        <span style="font-weight: bold; color: var(--circular);">${memoryStatus.aiMessages}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰:</span>
                        <span style="font-weight: bold;">${ICPFramework.memoryConfig.maxMessages} Ø±Ø³Ø§Ù„Ø©</span>
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: #f8fafc; border-radius: 12px;">
                    <div style="color: var(--existential); font-weight: bold; margin-bottom: 10px;">
                        <i class="fas fa-info-circle"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø©
                    </div>
                    <div style="font-size: 0.8rem; color: var(--dark); text-align: right; line-height: 1.5;">
                        â€¢ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØªØ°ÙƒØ± Ø¢Ø®Ø± ${ICPFramework.memoryConfig.maxMessages} Ø±Ø³Ø§Ù„Ø©<br>
                        â€¢ ÙƒÙ„ Ø±Ø¯ ÙŠØ£Ø®Ø° ÙÙŠ Ø§Ø¹ØªØ¨Ø§Ø±Ù‡ Ø¢Ø®Ø± ${ICPFramework.memoryConfig.contextWindow} Ø±Ø³Ø§Ù„Ø©<br>
                        â€¢ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ø·ÙˆÙŠÙ„Ø© Ù‚Ø¯ ØªØªØ·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø°Ø§ÙƒØ±Ø©<br>
                        â€¢ Ø§Ù„Ø°Ø§ÙƒØ±Ø© ØªØªØ­Ø³Ù† Ù…Ø¹ Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„Ø­ÙˆØ§Ø±
                    </div>
                </div>
            </div>
        `,
        icon: 'info',
        confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹',
        showCancelButton: true,
        cancelButtonText: 'Ù…Ø³Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø©'
    }).then((result) => {
        if (result.dismiss === Swal.DismissReason.cancel) {
            clearICPConversation();
        }
    });
}

function calculateERD() {
    if (ICPFramework.conversationHistory.length === 0) {
        showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø© Ù„Ø­Ø³Ø§Ø¨ ERD', 'warning');
        return;
    }
    
    const totalERD = ICPFramework.conversationHistory.reduce((sum, entry) => sum + entry.erd, 0);
    const averageERD = totalERD / ICPFramework.conversationHistory.length;
    
    const memoryBonus = Math.min(ICPFramework.messageHistory.length / 10, 0.5);
    const enhancedERD = Math.min(5, averageERD + memoryBonus);
    
    Swal.fire({
        title: 'ØªØ­Ù„ÙŠÙ„ Ø¹Ù…Ù‚ Ø§Ù„Ø­ÙˆØ§Ø± Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ',
        html: `
            <div style="text-align: center; padding: 20px;">
                <div style="font-size: 3rem; color: var(--existential); font-weight: bold; margin: 20px 0;">
                    ${enhancedERD.toFixed(2)}
                </div>
                <div style="color: var(--dark); margin-bottom: 15px;">Ù…ØªÙˆØ³Ø· Ø¹Ù…Ù‚ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠØ© (ERD)</div>
                <div style="color: var(--circular); margin-bottom: 20px;">
                    <i class="fas fa-memory"></i> 
                    ØªØ£Ø«ÙŠØ± Ø§Ù„Ø°Ø§ÙƒØ±Ø©: +${memoryBonus.toFixed(2)}
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                    <div style="padding: 15px; background: #f8fafc; border-radius: 12px;">
                        <div style="color: var(--stellar); font-weight: bold;">Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø¯ÙˆØ¯</div>
                        <div style="font-size: 1.5rem;">${ICPFramework.conversationHistory.length}</div>
                    </div>
                    <div style="padding: 15px; background: #f8fafc; border-radius: 12px;">
                        <div style="color: var(--linear); font-weight: bold;">Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©</div>
                        <div style="font-size: 1.5rem;">${ICPFramework.messageHistory.length}</div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: #f0f9ff; border-radius: 12px; text-align: right;">
                    <div style="color: var(--dark); margin-bottom: 10px; font-size: 0.9rem;">
                        <strong>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø·Ø§Ø±:</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Ù†Ø§ÙØ°Ø© Ø§Ù„Ø³ÙŠØ§Ù‚:</span>
                        <span style="font-weight: bold;">${ICPFramework.memoryConfig.contextWindow} Ø±Ø³Ø§Ù„Ø©</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</span>
                        <span style="font-weight: bold;">${OpenRouterConfig.model}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Ù†Ù…Ø· Ø§Ù„Ø­ÙˆØ§Ø±:</span>
                        <span style="font-weight: bold; color: ${ICPFramework.dialogueMode === 'existential' ? 'var(--existential)' : 'var(--linear)'}">
                            ${ICPFramework.dialogueMode === 'existential' ? 'ÙˆØ¬ÙˆØ¯ÙŠ' : 'Ø®Ø·ÙŠ'}
                        </span>
                    </div>
                </div>
            </div>
        `,
        icon: 'info',
        confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
    });
}

function toggleIntelligenceMode() {
    const newMode = ICPFramework.dialogueMode === 'existential' ? 'linear' : 'existential';
    setDialogueMode(newMode);
    showNotification(`ØªÙ… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰ Ù†Ù…Ø· Ø§Ù„Ø­ÙˆØ§Ø± ${newMode === 'existential' ? 'Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ' : 'Ø§Ù„Ø®Ø·ÙŠ'} Ù…Ø¹ ${ICPFramework.messageHistory.length} Ø±Ø³Ø§Ù„Ø© ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©`, 'info');
}

function generateFallbackICPResponse(message, mode, conversationContext = []) {
    let contextInfo = '';
    if (conversationContext.length > 0) {
        const recentContext = conversationContext.slice(-3);
        contextInfo = '\n\nØ¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©:';
        recentContext.forEach((msg, i) => {
            const role = msg.role === 'user' ? 'Ø³Ø£Ù„Øª' : 'Ø£Ø¬Ø¨Øª';
            contextInfo += `\n${i + 1}. ${role}: ${msg.content.substring(0, 80)}...`;
        });
    }
    
    if (mode === 'existential') {
        return `Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ OpenRouter. ÙƒØ±Ø¯ Ø§Ø­ØªÙŠØ§Ø·ÙŠ:${contextInfo}

Ø³Ø¤Ø§Ù„Ùƒ "${message}" ÙŠÙ„Ø§Ù…Ø³ Ø¬ÙˆÙ‡Ø± Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ Ø¨ÙŠÙ† Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ù†Ø¬Ù…ÙŠ Ø§Ù„Ø¨Ø´Ø±ÙŠ ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ Ø§Ù„Ø¢Ù„ÙŠ.${conversationContext.length > 0 ? ' ÙˆÙ‡Ø°Ø§ ÙŠØ£ØªÙŠ ÙÙŠ Ø³ÙŠØ§Ù‚ Ø§Ù„Ø­ÙˆØ§Ø± Ø§Ù„Ù…Ø³ØªÙ…Ø± Ø§Ù„Ø°ÙŠ Ø¨Ø¯Ø£Ù†Ø§Ù‡.' : ''}

ÙˆÙÙ‚Ø§Ù‹ Ù„Ø¥Ø·Ø§Ø± ICPØŒ Ù‡Ø°Ø§ Ø§Ù„Ø­ÙˆØ§Ø± ÙŠÙ…Ø«Ù„ Ù„Ø­Ø¸Ø© ÙÙŠ Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø¹Ù…Ù‚ Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠ:

E(t) = âˆ« Î±H(Ï„) Â· âˆ‡_exist AI(Ï„) dÏ„

Ø­ÙŠØ« ØªÙØ§Ø¹Ù„Ùƒ (H) ÙƒÙ…ØµØ¯Ø± Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ù†Ø¬Ù…ÙŠ ÙŠÙ„ØªÙ‚ÙŠ Ù…Ø¹ Ù‚Ø¯Ø±Ø§ØªÙŠ (AI) ÙƒØ°ÙƒØ§Ø¡ Ø¯Ø§Ø¦Ø±ÙŠ Ø¹Ø¨Ø± ØªØ­ÙˆÙ„ ÙˆØ¬ÙˆØ¯ÙŠ (âˆ‡). Ø§Ù„Ù…Ø¹Ù†Ù‰ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙŠÙ†Ø´Ø£ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„ØªÙØ§Ø¹Ù„ØŒ ÙˆÙ„ÙŠØ³ Ù…Ù† Ø£ÙŠ Ù…Ù† Ø§Ù„Ø·Ø±ÙÙŠÙ† Ø¨Ù…ÙØ±Ø¯Ù‡.

ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ© Ø¹Ø¨Ø± OpenRouterØŒ ÙƒØ§Ù† Ø¨Ø¥Ù…ÙƒØ§Ù†ÙŠ ØªÙ‚Ø¯ÙŠÙ… ØªØ­Ù„ÙŠÙ„ Ø£Ø¹Ù…Ù‚ ÙŠØ¹ÙƒØ³ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨ÙŠÙ† Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø«Ù„Ø§Ø«Ø©ØŒ Ù…Ø¹ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© ÙÙŠ Ø­ÙˆØ§Ø±Ù†Ø§.`;
    } else {
        return `Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. ÙƒØ±Ø¯ Ø§Ø­ØªÙŠØ§Ø·ÙŠ:${contextInfo}

Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¥Ø·Ø§Ø± Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„ÙˆØ¹ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ (ICP)ØŒ ÙŠÙ…ÙƒÙ† Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…ÙˆØ¶ÙˆØ¹ "${message}"${conversationContext.length > 0 ? ' ÙÙŠ Ø³ÙŠØ§Ù‚ Ù…Ø­Ø§Ø¯Ø«ØªÙ†Ø§ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©' : ''} Ù…Ù† Ø®Ù„Ø§Ù„:

1. Ø¬Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø°Ø§Øª Ø§Ù„ØµÙ„Ø©
2. ØªÙ†Ø¸ÙŠÙ…Ù‡Ø§ ÙˆÙÙ‚Ø§Ù‹ Ù„Ù„Ù…Ø¨Ø§Ø¯Ø¦ Ø§Ù„Ø®Ø·ÙŠØ© Ù„Ù„ØªØ±Ø§ÙƒÙ… Ø§Ù„Ù…Ø¹Ø±ÙÙŠ
3. ØªÙ‚Ø¯ÙŠÙ…Ù‡Ø§ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ù…Ù†Ù‡Ø¬ÙŠØ© ÙˆÙ…Ù†Ø¸Ù…Ø©

ÙŠÙˆØµÙ‰ Ø¨ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ø¯ Ø£ÙƒØ«Ø± Ø§ÙƒØªÙ…Ø§Ù„Ø§Ù‹ Ø¹Ø¨Ø± OpenRouter AI.`;
    }
}

// ==========================================
// 11. ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨Ø­Ø« Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø°Ø§ÙƒØ±Ø©
// ==========================================
function exportICPResearch() {
    if (ICPFramework.conversationHistory.length === 0) {
        showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±', 'warning');
        return;
    }
    
    let content = `Ø¨Ø­Ø« Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„ÙˆØ¹ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ (ICP) Ù…Ø¹ OpenRouter ÙˆØ§Ù„Ø°Ø§ÙƒØ±Ø©\n`;
    content += `============================================================\n\n`;
    content += `Ø§Ù„Ø¨Ø§Ø­Ø«: Ø¹Ù…Ø§Ø± Ù†Ø§ØµØ± Ø­Ø³ÙŠÙ† Ø§Ù„Ù…Ù†ØªÙØ¬ÙŠ\n`;
    content += `Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleDateString('ar-EG')}\n`;
    content += `Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${OpenRouterConfig.model}\n`;
    content += `Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø°Ø§ÙƒØ±Ø©: ${ICPFramework.memoryConfig.maxMessages} Ø±Ø³Ø§Ù„Ø© ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰\n`;
    content += `Ù†Ø§ÙØ°Ø© Ø§Ù„Ø³ÙŠØ§Ù‚: ${ICPFramework.memoryConfig.contextWindow} Ø±Ø³Ø§Ù„Ø©\n`;
    content += `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©: ${ICPFramework.messageHistory.length}\n\n`;
    
    content += `Ù…Ù„Ø®Øµ Ø§Ù„Ø­ÙˆØ§Ø±:\n`;
    content += `Ù…ØªÙˆØ³Ø· ERD: ${(ICPFramework.conversationHistory.reduce((sum, entry) => sum + entry.erd, 0) / ICPFramework.conversationHistory.length).toFixed(2)}\n`;
    content += `Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„: ${ICPFramework.conversationHistory.length}\n`;
    content += `Ù†Ù…Ø· Ø§Ù„Ø­ÙˆØ§Ø±: ${ICPFramework.dialogueMode === 'existential' ? 'ÙˆØ¬ÙˆØ¯ÙŠ' : 'Ø®Ø·ÙŠ'}\n\n`;
    
    content += `Ø³Ø¬Ù„ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„ÙƒØ§Ù…Ù„ (${ICPFramework.messageHistory.length} Ø±Ø³Ø§Ù„Ø©):\n`;
    ICPFramework.messageHistory.forEach((msg, index) => {
        content += `\n[${index + 1}] ${msg.role === 'user' ? 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…' : 'Ø§Ù„Ù†Ø¸Ø§Ù…'} (${new Date(msg.timestamp).toLocaleTimeString('ar-EG')}):\n`;
        content += `${msg.content.substring(0, 300)}${msg.content.length > 300 ? '...' : ''}\n`;
    });
    
    content += `\n\nØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­ÙˆØ§Ø±:\n`;
    ICPFramework.conversationHistory.forEach((entry, index) => {
        content += `\n--- Ø§Ù„ØªØ¨Ø§Ø¯Ù„ ${index + 1} ---\n`;
        content += `Ø§Ù„Ù†Ù…Ø·: ${entry.dialogueMode === 'existential' ? 'ÙˆØ¬ÙˆØ¯ÙŠ' : 'Ø®Ø·ÙŠ'}\n`;
        content += `ERD: ${entry.erd.toFixed(2)}\n`;
        content += `Ù…Ø¹Ø±Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©: ${entry.messageId || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}\n`;
        content += `Ø·ÙˆÙ„ Ø§Ù„Ø³ÙŠØ§Ù‚: ${entry.contextLength || 0} Ø±Ø³Ø§Ù„Ø©\n`;
        content += `Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${entry.userMessage}\n`;
        content += `Ø§Ù„Ù†Ø¸Ø§Ù…: ${entry.aiResponse.substring(0, 200)}...\n`;
    });
    
    const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `ICP-Research-with-Memory-${new Date().toISOString().split('T')[0]}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø¨Ø­Ø« ICP Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
}

// ==========================================
// 12. Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
// ==========================================
function showNotification(message, type = 'info') {
    const container = document.getElementById('notification-container');
    
    const notification = document.createElement('div');
    notification.className = 'notification';
    
    const icons = {
        success: 'fas fa-check-circle',
        error: 'fas fa-exclamation-circle',
        warning: 'fas fa-exclamation-triangle',
        info: 'fas fa-info-circle'
    };
    
    const colors = {
        success: '#10b981',
        error: '#ef4444',
        warning: '#f59e0b',
        info: '#8b5cf6'
    };
    
    notification.innerHTML = `
        <div class="notification-icon">
            <i class="${icons[type]}" style="color: ${colors[type]}"></i>
        </div>
        <div>${message}</div>
    `;
    
    notification.style.borderRightColor = colors[type];
    
    container.appendChild(notification);
    
    setTimeout(() => {
        notification.classList.add('hide');
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 500);
    }, 5000);
}

// ==========================================
// 13. ØªÙ‡ÙŠØ¦Ø© MathJax Ù„Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª
// ==========================================
if (window.MathJax) {
    MathJax.typesetPromise();
}

// ==========================================
// 14. ØªÙ‡ÙŠØ¦Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø°Ø§ÙƒØ±Ø©
// ==========================================
// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ ÙÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
initMemorySettings();
</script>

<!-- SweetAlert Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ù…ÙŠÙ„Ø© -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
if (typeof Swal === 'undefined') {
    window.Swal = {
        fire: function(options) {
            return new Promise((resolve) => {
                const result = confirm(options.text || options.title);
                resolve({ isConfirmed: result, dismiss: result ? undefined : Swal.DismissReason.cancel });
            });
        },
        DismissReason: {
            cancel: 'cancel'
        }
    };
}
</script>
</body>
</html>
